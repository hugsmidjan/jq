(function($){$.fn.imgPopper=function(b){b=$.extend({fadeInSpeed:250,fadeOutSpeed:200,imgFadeSpeed:false,disableIeFading:0,setContainerWidth:0,curtainColor:'#000000',curtainOpacity:'0.7',easeIn:'swing',easeOut:'swing',yOffset:0,imgClose:false},b);var c='li.next, li.prev',_closeSelectors='div.ipopup-container li.close a, div.ipopup-curtain, div.ipopup-container',_isOpen=false,_hrefElms=this,_ypos,_langIs=$('html').attr('lang')=='is',_nextText=_langIs?'NÃ¦sta':'Next',_prevText=_langIs?'Fyrri':'Previous',_closeText=_langIs?'Loka':'Close',_imageText=_langIs?'Mynd':'Image',_ofTotalText=_langIs?'af':'of',_curtainTemp='<div class="ipopup-curtain"></div>',_popupTemp='<div class="ipopup-container">'+'<div class="ipopup-container-wrapper">'+'<a class="focustarget" style="position:absolute;left:auto;right:9999px;" href="#">.</a>'+'<div class="image">'+'<span class="img"><img src="%{img}" alt="%{alt}" /></span>'+'<strong class="title">%{title}</strong>'+'<div class="desc">%{alt}</div>'+'</div>'+'<div class="paging">'+'<div class="status">'+'<strong>'+_imageText+'</strong> '+'<span><b>%{num}</b> '+_ofTotalText+' %{total}</span>'+'</div>'+'<ul class="stepper">'+'<li class="next"><a href="#">'+_nextText+'</a></li>'+'<li class="prev"><a href="#">'+_prevText+'</a></li>'+'<li class="close"><a href="#">'+_closeText+'</a></small></li>'+'</ul>'+'</div>'+'</div>'+'</div>';if(b.disableIeFading&&$.browser.msie&&parseInt($.browser.version,10)<9){b.fadeInSpeed=0;b.fadeOutSpeed=0};_hrefElms.bind('click',function(e){var i=_hrefElms.index(this),_img=$('img',this)[0],_makeHTML=$.inject(_popupTemp,{img:$(this).attr('href'),title:_img.title,alt:_img.alt,num:i+1,total:_hrefElms.length}),_popup=$(_makeHTML).hide(),_curtain=$(_curtainTemp).hide(),setWidth=function(){var a=_popup.find('img');a.each(function(){$(this).bind('load readystatechange',function(){_popup.find('div.ipopup-container-wrapper').css('width',a.outerWidth())});this.src+=''})};if(!_isOpen){$('body').append(_curtain).append(_popup);_ypos=$(document).scrollTop()+b.yOffset;_curtain.css({'background-color':b.curtainColor,opacity:'0','display':'block'}).animate({opacity:b.curtainOpacity},(b.fadeInSpeed/2),b.easeIn,function(){_popup.css('top',_ypos).fadeIn(b.fadeInSpeed,b.easeIn).find('div.ipopup-container-wrapper').bind('click',function(e){if(!b.imgClose){e.stopPropagation()}}).setFocus();if(b.setContainerWidth){setWidth()}});_isOpen=true}else{$('body').append(_popup);_popup.css('top',_ypos).find('img').hide().fadeIn(b.imgFadeSpeed||b.fadeInSpeed).end().show().find('div.ipopup-container-wrapper').bind('click',function(e){if(!b.imgClose){e.stopPropagation()}});if(b.setContainerWidth){setWidth()}}$(c,_popup).each(function(j){var a=i+(j?-1:1);if(a<0||a>=_hrefElms.length){$(this).addClass('nav-end').find('a').removeAttr('href')}else{$(this).bind('click',function(e){_popup.remove();_hrefElms.eq(a).trigger('click');return false})}});$(_closeSelectors).bind('click',function(e){_popup.fadeOut(b.fadeOutSpeed,function(){_curtain.fadeOut(b.fadeOutSpeed,function(){_popup.remove();$('.ipopup-curtain').remove();_hrefElms.focus()},b.easeOut)},b.easeOut);_isOpen=false;return false});$(window).keyup(function(e){if(e.keyCode==27){_curtain.trigger('click')}if(e.keyCode==37){$('.paging .prev',_popup).not('.nav-end').trigger('click')}if(e.keyCode==39){$('.paging .next',_popup).not('.nav-end').trigger('click')}});return false});return this}})(jQuery);

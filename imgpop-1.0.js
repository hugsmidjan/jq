// $.fn.imgPopper 1.0  -- (c) 2009 Hugsmiðjan ehf.
(function(a){a.fn.imgPopper=function(b){b=a.extend({fadeInSpeed:250,fadeOutSpeed:200,imgFadeSpeed:false,disableIeFading:0,setContainerWidth:0,curtainColor:'#000000',curtainOpacity:'0.7',easeIn:'swing',easeOut:'swing',yOffset:0,imgClose:false},b);var q='li.next, li.prev',r='div.ipopup-container li.close a, div.ipopup-curtain, div.ipopup-container',j=false,g=this,k,h=a('html').attr('lang')=='is',s=h?'Næsta':'Next',t=h?'Fyrri':'Previous',u=h?'Loka':'Close',v=h?'Mynd':'Image',w=h?'af':'of',x='<div class="ipopup-curtain"></div>',y='<div class="ipopup-container"><div class="ipopup-container-wrapper"><a class="focustarget" style="position:absolute;left:auto;right:9999px;" href="#">.</a><div class="image"><span class="img"><img src="%{img}" alt="%{alt}" /></span><strong class="title">%{title}</strong><div class="desc">%{alt}</div></div><div class="paging"><div class="status"><strong>'+v+'</strong> <span><b>%{num}</b> '+w+' %{total}</span></div><ul class="stepper"><li class="next"><a href="#">'+s+'</a></li><li class="prev"><a href="#">'+t+'</a></li><li class="close"><a href="#">'+u+'</a></small></li></ul></div></div></div>';if(b.disableIeFading&&9>parseInt((/MSIE ([\w.]+)/.exec(navigator.userAgent)||[])[1],10)){b.fadeInSpeed=0;b.fadeOutSpeed=0};var e=a(x).hide();g.bind('click',function(A){var m=g.index(this),n=a(this).find('img').length?a('img',this)[0]:'',z=a.inject(y,{img:a(this).attr('href'),title:n.title||'',alt:n.alt||'',num:m+1,total:g.length}),c=a(z).hide(),o=function(){var d=c.find('img');d.each(function(){a(this).bind('load readystatechange',function(){c.find('div.ipopup-container-wrapper').css('width',d.outerWidth())});this.src+=''})};if(!j){a('body').append(e).append(c);k=a(document).scrollTop()+b.yOffset;e.css({'background-color':b.curtainColor,opacity:'0','display':'block'}).animate({opacity:b.curtainOpacity},(b.fadeInSpeed/2),b.easeIn,function(){c.css('top',k).fadeIn(b.fadeInSpeed,b.easeIn).find('div.ipopup-container-wrapper').bind('click',function(d){if(!b.imgClose){d.stopPropagation()}});if(b.setContainerWidth){o()}});j=true}else{a('body').append(c);c.css('top',k).find('img').hide().fadeIn(b.imgFadeSpeed||b.fadeInSpeed).end().show().find('div.ipopup-container-wrapper').bind('click',function(d){if(!b.imgClose){d.stopPropagation()}});if(b.setContainerWidth){o()}}a(q,c).each(function(i){var f=m+(i?-1:1);if(f<0||f>=g.length){a(this).addClass('nav-end').find('a').removeAttr('href')}else{a(this).bind('click',function(d){c.remove();a(window).unbind('keyup',l);g.eq(f).trigger('click');return false})}});a(r).bind('click',function(d){c.fadeOut(b.fadeOutSpeed,b.easeOut,function(){e.fadeOut(b.fadeOutSpeed,b.easeOut,function(){a('body > div.ipopup-curtain, body > div.ipopup-container').remove();a(window).unbind('keyup',l)})});j=false;return false});var l=function(d){var i=d.keyCode;if(i==27){e.trigger('click')}if(i==37){var f=a('.paging .prev',c);f.is('.nav-end')?e.trigger('click'):f.trigger('click')}if(i==39){var p=a('.paging .next',c);p.is('.nav-end')?e.trigger('click'):p.trigger('click')}};a(window).bind('keyup',l);return false});return this}})(jQuery);

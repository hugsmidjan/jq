/* $.fn.videoLinks 1.0  -- (c) 2011-2015 Hugsmi√∞jan ehf. @preserve */
!function(e){var t='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',a='<iframe width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" scrolling="no" title="%{vidTitle}" allowfullscreen></iframe>',i='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',o=function(e,t){var a=t?e/4*3:e/16*9;return Math.round(a)},l=function(){var l,d,c,m,v,u=e(this),n=u.data("playvideo_data"),s=n.videoHref,f=n.type,p="auto"!==n.cfg.vidWidth?n.cfg.vidWidth:n.contElm.width(),h="auto"!==n.cfg.vidHeight?n.cfg.vidHeight:o(p,n.cfg.aspect4x3),y="",w="",g=0,b="iframe";if("youtube"===f||"youtu"===f)c="youtube"===f?s.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):s.match(/\.be\/(.+)$/),c=c&&c[1],m=s.match(/[?&]list=([^&?\/]+)/),m=m&&"list="+m[1]+"&",m&&!c&&(c="videoseries"),y=n.cfg.autostart?"&autoplay=1":"",w=n.cfg.autoHide===!0?"":"&autohide="+n.cfg.autoHide,d=r+"//www.youtube.com/embed/"+c+"?"+m+"rel=0&wmode=transparent"+y+w+n.cfg.filePlayerExtraParams,g=30;else if("vimeo"===f)c=s.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i),c=c&&c[1],y=n.cfg.autostart?"&autoplay=1":"",d=r+"//player.vimeo.com/video/"+c+"?title=1&amp;byline=0&amp;portrait=0"+y+n.cfg.filePlayerExtraParams;else if("facebook"===f)c=s.match(/(?:\/v\/|[?&]v=)(\d{10,20})/),c=c&&c[1],d=r+"//www.facebook.com/video/embed?video_id="+c;else if("file"===f){var P=document.createElement("video"),E=!!P.canPlayType&&P.canPlayType("video/mp4").replace(/no/,""),x=!!P.canPlayType&&P.canPlayType("video/quicktime").replace(/no/,"");E&&/\.(mp4|m4v)(\?|$)/i.test(s)?(d=s,b="video",y=n.cfg.autostart?"autoplay":"",v="mp4"):x&&/\.mov(\?|$)/i.test(s)?(d=s,b="video",y=n.cfg.autostart?"autoplay":"",v="quicktime"):(y=n.cfg.autostart?"&autostart=true":"",d=n.cfg.filePlayerUrl+s+y+n.cfg.filePlayerExtraParams,b=n.cfg.filePlayerFrame,h+=n.cfg.filePlayerHeight)}else d=s;"iframe"===b?u.html(e.inject(a,{vidurl:d,vidwi:p,vidhe:h,vidTitle:n.vidCapt})):"video"===b?u.html(e.inject(i,{vidurl:d,vidwi:p,vidhe:h,auto:y})):"flash"===b&&u.html(e.inject(t,{vidurl:d,vidwi:p,vidhe:h})),n.cfg.useCaption&&u.append('<span class="videocaption">'+n.vidCapt+"</span>"),"flash"!==b&&"auto"===n.cfg.vidWidth&&e(window).on("resize",function(){l=n.contElm.width(),l!==p&&(p=l,p=n.contElm.width(),h=o(p,n.cfg.aspect4x3)+g,u.find("iframe,video").attr("height",h).attr("width",p))})},r=document.location.protocol;r="file:"===r?"http:":r,e.fn.videoLinks=function(t){var a=this;return a.length&&(t=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,autoHide:!0,filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},t)),a.map(function(){var a=e(this),i=a.attr("href"),o=t.type||/\.youtube\.com/i.test(i)&&"youtube"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(i)&&"file"||/vimeo\.com/i.test(i)&&"vimeo"||/youtu\.be/i.test(i)&&"youtu"||/facebook\.com/i.test(i)&&"facebook"||void 0,r={cfg:t,videoHref:i,type:o,vidCapt:a.text()},d=a.wrap('<span class="videoblock" />').parent();for(r.contElm=e(d);r.contElm[0]&&"inline"===r.contElm.css("display");)r.contElm=e(r.contElm.parent());return d.data("playvideo_data",r).run(l),a.remove(),d[0]})}}(jQuery);

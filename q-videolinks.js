/* $.fn.videoLinks 1.0  -- (c) 2011-2015 Hugsmi√∞jan ehf. @preserve */
!function(e){var t='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',a='<iframe width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" scrolling="no" title="%{vidTitle}" allowfullscreen></iframe>',i='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',o='<blockquote class="%{class}" %{attributes} style="%{styles}"><a href="%{vidurl}"></a></blockquote>',l=function(e,t){var a=t?e/4*3:e/16*9;return Math.round(a)},r=function(){var r,d,s,n,m,u=e(this),v=u.data("playvideo_data"),p=v.videoHref,f=v.type,h="auto"!==v.cfg.vidWidth?v.cfg.vidWidth:v.contElm.width(),g="auto"!==v.cfg.vidHeight?v.cfg.vidHeight:l(h,v.cfg.aspect4x3),y="",w="",b=0,P="iframe";if("youtube"===f||"youtu"===f)s="youtube"===f?p.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):p.match(/\.be\/(.+)$/),s=s&&s[1],n=p.match(/[?&]list=([^&?\/]+)/),n=n&&"list="+n[1]+"&",n&&!s&&(s="videoseries"),y=v.cfg.autostart?"&autoplay=1":"",w=v.cfg.autoHide===!0?"":"&autohide="+v.cfg.autoHide,d=c+"//www.youtube.com/embed/"+s+"?"+n+"rel=0&wmode=transparent"+y+w+v.cfg.filePlayerExtraParams,b=30;else if("vimeo"===f)s=p.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i),s=s&&s[1],y=v.cfg.autostart?"&autoplay=1":"",d=c+"//player.vimeo.com/video/"+s+"?title=1&amp;byline=0&amp;portrait=0"+y+v.cfg.filePlayerExtraParams;else if("facebook"===f)/\/videos\//.test(p)?(y=v.cfg.autostart?"&autoplay=true":"",d=c+"//www.facebook.com/v2.6/plugins/video.php?href="+encodeURIComponent(p)+"&locale="+v.cfg.locale+"&show_text=false"+y):(s=p.match(/(?:\/v\/|\/videos\/|[?&]v=)(\d{10,20})/),s=s&&s[1],d=c+"//www.facebook.com/video/embed?video_id="+s);else if("instagram"===f)P="blockquote",d=p,u.data("load-script",{scripttoken:"instgrm",scripturl:"//platform.instagram.com/"+v.cfg.locale+"/embeds.js",onload:"window.instgrm.Embeds.process()"});else if("file"===f){var k=document.createElement("video"),x=!!k.canPlayType&&k.canPlayType("video/mp4").replace(/no/,""),E=!!k.canPlayType&&k.canPlayType("video/quicktime").replace(/no/,"");x&&/\.(mp4|m4v)(\?|$)/i.test(p)?(d=p,P="video",y=v.cfg.autostart?"autoplay":"",m="mp4"):E&&/\.mov(\?|$)/i.test(p)?(d=p,P="video",y=v.cfg.autostart?"autoplay":"",m="quicktime"):(y=v.cfg.autostart?"&autostart=true":"",d=v.cfg.filePlayerUrl+p+y+v.cfg.filePlayerExtraParams,P=v.cfg.filePlayerFrame,g+=v.cfg.filePlayerHeight)}else d=p;"iframe"===P?u.html(e.inject(a,{vidurl:d,vidwi:h,vidhe:g,vidTitle:v.vidCapt})):"video"===P?u.html(e.inject(i,{vidurl:d,vidwi:h,vidhe:g,auto:y})):"blockquote"===P?u.html(e.inject(o,{vidurl:d,class:"instagram-media",attributes:'data-instgrm-captioned data-instgrm-version="7"',styles:"margin:1px;padding:0;border:0;max-width:658px;width:calc(100% - 2px);"})):"flash"===P&&u.html(e.inject(t,{vidurl:d,vidwi:h,vidhe:g})),v.cfg.useCaption&&v.vidCapt.length>0&&"instagram"!==P&&u.append('<span class="videocaption">'+v.vidCapt+"</span>"),"flash"!==P&&"instagram"!==f&&"auto"===v.cfg.vidWidth&&e(window).on("resize",function(){r=v.contElm.width(),r!==h&&(h=r,h=v.contElm.width(),g=l(h,v.cfg.aspect4x3)+b,u.find("iframe,video").attr("height",g).attr("width",h))});var H=u.data("load-script");H&&setTimeout(function(){if(window[H.scripttoken]){var t=new Function(H.onload);t.apply(null)}else{var a=document.createElement("script");a.async=!0,a.defer=!0,a.src=H.scripturl,a.onload=H.onload,e("head").append(a)}},10)},c=document.location.protocol;c="file:"===c?"http:":c,e.fn.videoLinks=function(t){var a=this;return a.length&&(t=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,autoHide:!0,locale:"en_US",filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},t)),a.map(function(){var a=e(this),i=a.attr("href"),o=t.type||/\.youtube\.com/i.test(i)&&"youtube"||/youtu\.be/i.test(i)&&"youtu"||/vimeo\.com/i.test(i)&&"vimeo"||/facebook\.com/i.test(i)&&"facebook"||/instagram\.com/i.test(i)&&"instagram"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(i)&&"file"||void 0,l={cfg:t,videoHref:i,type:o,vidCapt:a.text().trim()},c=a.wrap('<span class="videoblock" />').parent();for(l.contElm=e(c);l.contElm[0]&&"inline"===l.contElm.css("display");)l.contElm=e(l.contElm.parent());return c.data("playvideo_data",l).run(r),a.remove(),c[0]})}}(jQuery);

// $.fn.videoLinks 1.0  -- (c) 2011 Hugsmi√∞jan ehf.
!function(e){var t='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',a='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',i='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',o=function(e,t){var a=t?3*(e/4):9*(e/16);return Math.round(a)},l=function(){var l,d,c,u,v=e(this),m=v.data("playvideo_data"),n=m.videoHref,f=m.type,s="auto"!==m.cfg.vidWidth?m.cfg.vidWidth:m.contElm.width(),p="auto"!==m.cfg.vidHeight?m.cfg.vidHeight:o(s,m.cfg.aspect4x3),h="",y="",w=0,g="iframe";if("youtube"===f||"youtu"===f)c="youtube"===f?n.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):n.match(/\.be\/(.+)$/),c=c&&c[1],h=m.cfg.autostart?"&autoplay=1":"",y=m.cfg.autoHide===!0?"":"&autohide="+m.cfg.autoHide,d=r+"//www.youtube.com/embed/"+c+"?rel=0"+h+y,w=30;else if("vimeo"===f)c=n.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i),c=c&&c[1],h=m.cfg.autostart?"&autoplay=1":"",d=r+"//player.vimeo.com/video/"+c+"?title=1&amp;byline=0&amp;portrait=0"+h;else if("facebook"===f)c=n.match(/(?:\/v\/|[?&]v=)(\d{10,20})/),c=c&&c[1],d=r+"//www.facebook.com/video/embed?video_id="+c;else if("file"===f){var b=document.createElement("video"),P=!!b.canPlayType&&b.canPlayType("video/mp4").replace(/no/,""),E=!!b.canPlayType&&b.canPlayType("video/quicktime").replace(/no/,"");P&&/\.(mp4|m4v)(\?|$)/i.test(n)?(d=n,g="video",h=m.cfg.autostart?"autoplay":"",u="mp4"):E&&/\.mov(\?|$)/i.test(n)?(d=n,g="video",h=m.cfg.autostart?"autoplay":"",u="quicktime"):(h=m.cfg.autostart?"&autostart=true":"",d=m.cfg.filePlayerUrl+n+h+m.cfg.filePlayerExtraParams,g=m.cfg.filePlayerFrame,p+=m.cfg.filePlayerHeight)}else d=n;"iframe"===g?v.html(e.inject(a,{vidurl:d,vidwi:s,vidhe:p})):"video"===g?v.html(e.inject(i,{vidurl:d,vidwi:s,vidhe:p,auto:h})):"flash"===g&&v.html(e.inject(t,{vidurl:d,vidwi:s,vidhe:p})),m.cfg.useCaption&&v.append('<span class="videocaption">'+m.vidCapt+"</span>"),"flash"!==g&&"auto"===m.cfg.vidWidth&&e(window).on("resize",function(){l=m.contElm.width(),l!==s&&(s=l,s=m.contElm.width(),p=o(s,m.cfg.aspect4x3)+w,v.find("iframe,video").attr("height",p).attr("width",s))})},r=document.location.protocol;r="file:"===r?"http:":r,e.fn.videoLinks=function(t){var a=this;return a.length&&(t=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,autoHide:!0,filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},t)),a.map(function(){var a=e(this),i=a.attr("href"),o=t.type||/\.youtube\.com/i.test(i)&&"youtube"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(i)&&"file"||/vimeo\.com/i.test(i)&&"vimeo"||/youtu\.be/i.test(i)&&"youtu"||/facebook\.com/i.test(i)&&"facebook"||void 0,r={cfg:t,videoHref:i,type:o,vidCapt:a.text()},d=a.wrap('<span class="videoblock" />').parent();for(r.contElm=e(d);r.contElm[0]&&"inline"===r.contElm.css("display");)r.contElm=e(r.contElm.parent());return d.data("playvideo_data",r).run(l),a.remove(),d[0]})}}(jQuery);

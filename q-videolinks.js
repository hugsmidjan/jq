// $.fn.videoLinks 1.0  -- (c) 2011 Hugsmi√∞jan ehf.
(function(i){var r='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',s='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',q=function(g,f){var c=f?(g/4)*3:(g/16)*9;return Math.round(c)},t=function(f){var c=i(this),a=c.data('playvideo_data'),d=a.videoHref,e=a.type,h=a.vidWidth!='auto'?a.vidWidth:c.closest('div, p').width(),p,j=a.vidHeight!='auto'?a.vidHeight:q(h,a.aspect4x3),k,b,l,n=0,o=false;if(e=='youtube'||e=='youtu'){b=e=='youtube'?d.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):d.match(/\.be\/(.+)$/);b=b&&b[1];l=a.autostart?'&autoplay=1':'';k=m+'//www.youtube.com/embed/'+b+'?rel=0'+l;n=30;o=true}else if(e=='vimeo'){b=d.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i);b=b&&b[1];l=a.autostart?'&autoplay=1':'';k=m+'//player.vimeo.com/video/'+b+'?title=1&amp;byline=0&amp;portrait=0'+l;o=true}else if(e=='facebook'){b=d.match(/(?:\/v\/|[?&]v=)(\d{10,20})/);b=b&&b[1];k=m+'//www.facebook.com/v/'+b}else if(e=='file'){l=a.autostart?'&autostart=true':'';k='/bitar/common/media/mediaplayer.swf?file='+d+l;n=20}j=j+n;if(o){c.html(i.inject(s,{vidurl:k,vidwi:h,vidhe:j}))}else{c.html(i.inject(r,{vidurl:k,vidwi:h,vidhe:j}))}c.append('<span class="videocaption">'+a.vidCapt+'</span>');if(o&&a.vidWidth=='auto'){i(window).on('resize',function(g){p=c.closest('div, p').width();if(p!=h){h=p;h=c.closest('div, p').width();j=q(h,a.aspect4x3)+n;c.find('iframe').attr('height',j).attr('width',h)}})}},m=document.location.protocol;m=m=='file:'?'http:':m;i.fn.videoLinks=function(d){var e=this;if(e.length){d=i.extend({vidWidth:'auto',vidHeight:'auto',aspect4x3:false},d);e.each(function(){var g=i(this),f=g.attr('href'),c=(/\.youtube\.com/i.test(f)&&'youtube')||(/\.(flv|mp4|m4v)(\?|$)/i.test(f)&&'file')||(/vimeo\.com/i.test(f)&&'vimeo')||(/youtu\.be/i.test(f)&&'youtu')||(/facebook\.com/i.test(f)&&'facebook')||undefined,a={videoHref:f,type:c,vidCapt:g.text(),vidWidth:d.vidWidth,vidHeight:d.vidHeight,autostart:!!d.autostart,aspect4x3:d.aspect4x3};if(c){g.wrap('<span class="videoblock" />').parent().data('playvideo_data',a).run(t);g.remove()}})}return e}})(jQuery);

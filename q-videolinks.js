// $.fn.videoLinks 1.0  -- (c) 2011 Hugsmi√∞jan ehf.
(function(h){var r='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',s='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',t='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',p=function(d,a){var b=a?(d/4)*3:(d/16)*9;return Math.round(b)},u=function(){var d=h(this),a=d.data('playvideo_data'),b=a.videoHref,e=a.type,f=a.vidWidth!=='auto'?a.vidWidth:a.contElm.width(),i,g=a.vidHeight!=='auto'?a.vidHeight:p(f,a.aspect4x3),j,c,q,k='',n=0,l='iframe';if(e==='youtube'||e==='youtu'){c=e==='youtube'?b.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):b.match(/\.be\/(.+)$/);c=c&&c[1];k=a.autostart?'&autoplay=1':'';j=m+'//www.youtube.com/embed/'+c+'?rel=0'+k;n=30}else if(e==='vimeo'){c=b.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i);c=c&&c[1];k=a.autostart?'&autoplay=1':'';j=m+'//player.vimeo.com/video/'+c+'?title=1&amp;byline=0&amp;portrait=0'+k}else if(e==='facebook'){c=b.match(/(?:\/v\/|[?&]v=)(\d{10,20})/);c=c&&c[1];j=m+'//www.facebook.com/video/embed?video_id='+c}else if(e==='file'){var o=document.createElement('video'),v=!!o.canPlayType&&o.canPlayType('video/mp4').replace(/no/,''),w=!!o.canPlayType&&o.canPlayType('video/quicktime').replace(/no/,'');if(v&&/\.(mp4|m4v)(\?|$)/i.test(b)){j=b;l='video';k=a.autostart?'autoplay':'';q='mp4'}else if(w&&/\.mov(\?|$)/i.test(b)){j=b;l='video';k=a.autostart?'autoplay':'';q='quicktime'}else{k=a.autostart?'&autostart=true':'';j='/bitar/common/media/mediaplayer.swf?file='+b+k;n=20;l='flash'}}else{j=b}g=g+n;if(l=='iframe'){d.html(h.inject(s,{vidurl:j,vidwi:f,vidhe:g}))}else if(l=='video'){d.html(h.inject(t,{vidurl:j,vidwi:f,vidhe:g,auto:k}))}else if(l=='flash'){d.html(h.inject(r,{vidurl:j,vidwi:f,vidhe:g}))}d.append('<span class="videocaption">'+a.vidCapt+'</span>');if(l!='flash'&&a.vidWidth==='auto'){h(window).on('resize',function(){i=a.contElm.width();if(i!==f){f=i;f=a.contElm.width();g=p(f,a.aspect4x3)+n;d.find('iframe,video').attr('height',g).attr('width',f)}})}},m=document.location.protocol;m=m==='file:'?'http:':m;h.fn.videoLinks=function(i){var g=this;if(g.length){i=h.extend({vidWidth:'auto',vidHeight:'auto',aspect4x3:false},i);g.each(function(){var d=h(this),a=d.attr('href'),b=(/\.youtube\.com/i.test(a)&&'youtube')||(/\.(flv|mp4|m4v|mov)(\?|$)/i.test(a)&&'file')||(/vimeo\.com/i.test(a)&&'vimeo')||(/youtu\.be/i.test(a)&&'youtu')||(/facebook\.com/i.test(a)&&'facebook')||undefined,e={videoHref:a,type:b,vidCapt:d.text(),vidWidth:i.vidWidth,vidHeight:i.vidHeight,autostart:!!i.autostart,aspect4x3:i.aspect4x3};if(b){var f=d.wrap('<span class="videoblock" />').parent();e.contElm=h(f);while(e.contElm[0]&&e.contElm.css('display')==='inline'){e.contElm=h(e.contElm.parent())}f.data('playvideo_data',e).run(u);d.remove()}})}return g}})(jQuery);

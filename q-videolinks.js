/* $.fn.videoLinks 1.0  -- (c) 2011-2015 Hugsmi√∞jan ehf. @preserve */
!function(e){var t=function(e,t){var a=t?e/4*3:e/16*9;return Math.round(a)},a=function(){var a,o,l,r,c,d=e(this),s=d.data("playvideo_data"),n=s.videoHref,m=s.type,u="auto"!==s.cfg.vidWidth?s.cfg.vidWidth:s.contElm.width(),v="auto"!==s.cfg.vidHeight?s.cfg.vidHeight:t(u,s.cfg.aspect4x3),p="",f="",h=0,y="iframe";if("youtube"===m||"youtu"===m)l=(l="youtube"===m?n.match(/(?:embed\/|watch\/?\?v=)([^&?/]+)/i):n.match(/\.be\/(.+)$/))&&l[1],(r=(r=n.match(/[?&]list=([^&?/]+)/))&&"list="+r[1]+"&"||"")&&!l&&(l="videoseries"),p=s.cfg.autostart?"&autoplay=1":"",f=!0===s.cfg.autoHide?"":"&autohide="+s.cfg.autoHide,o=i+"//www.youtube-nocookie.com/embed/"+l+"?"+r+"rel=0&wmode=transparent"+p+f+s.cfg.filePlayerExtraParams,h=30;else if("vimeo"===m)l=(l=n.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i))&&l[1],p=s.cfg.autostart?"&autoplay=1":"",o=i+"//player.vimeo.com/video/"+l+"?title=1&amp;byline=0&amp;portrait=0"+p+s.cfg.filePlayerExtraParams;else if("facebook"===m)/\/videos\//.test(n)?(p=s.cfg.autostart?"&autoplay=true":"",o=i+"//www.facebook.com/v2.6/plugins/video.php?href="+encodeURIComponent(n)+"&locale="+s.cfg.locale+"&show_text=false"+p):(l=(l=n.match(/(?:\/v\/|\/videos\/|[?&]v=)(\d{10,20})/))&&l[1],o=i+"//www.facebook.com/video/embed?video_id="+l);else if("instagram"===m)y="blockquote",o=n,d.data("load-script",{scripttoken:"instgrm",scripturl:"//platform.instagram.com/"+s.cfg.locale+"/embeds.js",onload:"window.instgrm.Embeds.process()"});else if("file"===m){var g=document.createElement("video"),w=!!g.canPlayType&&g.canPlayType("video/mp4").replace(/no/,""),b=!!g.canPlayType&&g.canPlayType("video/quicktime").replace(/no/,"");w&&/\.(mp4|m4v)(\?|$)/i.test(n)?(o=n,y="video",p=s.cfg.autostart?"autoplay":"",c="mp4"):b&&/\.mov(\?|$)/i.test(n)?(o=n,y="video",p=s.cfg.autostart?"autoplay":"",c="quicktime"):(p=s.cfg.autostart?"&autostart=true":"",o=s.cfg.filePlayerUrl+n+p+s.cfg.filePlayerExtraParams,y=s.cfg.filePlayerFrame,v+=s.cfg.filePlayerHeight)}else o=n;"iframe"===y?d.html(e.inject('<iframe width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" scrolling="no" title="%{vidTitle}" allow="autoplay; encrypted-media" allowfullscreen></iframe>',{vidurl:o,vidwi:u,vidhe:v,vidTitle:s.vidCapt})):"video"===y?d.html(e.inject('<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',{vidurl:o,vidwi:u,vidhe:v,auto:p,mime:c})):"blockquote"===y?d.html(e.inject('<blockquote class="%{class}" %{attributes} style="%{styles}"><a href="%{vidurl}"></a></blockquote>',{vidurl:o,class:"instagram-media",attributes:'data-instgrm-captioned data-instgrm-version="7"',styles:"margin:1px;padding:0;border:0;max-width:658px;width:calc(100% - 2px);"})):"flash"===y&&d.html(e.inject('<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',{vidurl:o,vidwi:u,vidhe:v})),s.cfg.useCaption&&s.vidCapt.length>0&&"instagram"!==y&&d.append('<span class="videocaption">'+s.vidCapt+"</span>"),"flash"!==y&&"instagram"!==m&&"auto"===s.cfg.vidWidth&&e(window).on("resize.videolinks",function(){(a=s.contElm.width())!==u&&(u=a,u=s.contElm.width(),v=t(u,s.cfg.aspect4x3)+h,d.find("iframe,video").attr("height",v).attr("width",u))});var k=d.data("load-script");k&&setTimeout(function(){if(window[k.scripttoken])new Function(k.onload).apply(null);else{var t=document.createElement("script");t.async=!0,t.defer=!0,t.src=k.scripturl,t.onload=k.onload,e("head").append(t)}},10)},i=document.location.protocol;i="file:"===i?"http:":i,e.fn.videoLinks=function(t){var i=this;return i.length&&(t=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,autoHide:!0,locale:"en_US",filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},t)),i.map(function(){var i=e(this),o=i.attr("href"),l=t.type||/\.youtube\.com/i.test(o)&&"youtube"||/youtu\.be/i.test(o)&&"youtu"||/vimeo\.com/i.test(o)&&"vimeo"||/facebook\.com/i.test(o)&&"facebook"||/instagram\.com/i.test(o)&&"instagram"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(o)&&"file"||void 0,r={cfg:t,videoHref:o,type:l,vidCapt:i.text().trim()},c=i.wrap('<span class="videoblock" />').parent();for(r.contElm=e(c);r.contElm[0]&&"inline"===r.contElm.css("display");)r.contElm=e(r.contElm.parent());return c.data("playvideo_data",r).run(a),i.remove(),c[0]})}}(jQuery);

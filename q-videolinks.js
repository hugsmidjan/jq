// $.fn.videoLinks 1.0  -- (c) 2011 Hugsmi√∞jan ehf.
(function(i){var p='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',q='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',o=function(c,a){var e=a?(c/4)*3:(c/16)*9;return Math.round(e)},r=function(){var c=i(this),a=c.data('playvideo_data'),e=a.videoHref,f=a.type,d=a.vidWidth!=='auto'?a.vidWidth:a.contElm.width(),g,h=a.vidHeight!=='auto'?a.vidHeight:o(d,a.aspect4x3),j,b,k,m=0,n=false;if(f==='youtube'||f==='youtu'){b=f==='youtube'?e.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):e.match(/\.be\/(.+)$/);b=b&&b[1];k=a.autostart?'&autoplay=1':'';j=l+'//www.youtube.com/embed/'+b+'?rel=0'+k;m=30;n=true}else if(f==='vimeo'){b=e.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i);b=b&&b[1];k=a.autostart?'&autoplay=1':'';j=l+'//player.vimeo.com/video/'+b+'?title=1&amp;byline=0&amp;portrait=0'+k;n=true}else if(f==='facebook'){b=e.match(/(?:\/v\/|[?&]v=)(\d{10,20})/);b=b&&b[1];j=l+'//www.facebook.com/v/'+b}else if(f==='file'){k=a.autostart?'&autostart=true':'';j='/bitar/common/media/mediaplayer.swf?file='+e+k;m=20}h=h+m;if(n){c.html(i.inject(q,{vidurl:j,vidwi:d,vidhe:h}))}else{c.html(i.inject(p,{vidurl:j,vidwi:d,vidhe:h}))}c.append('<span class="videocaption">'+a.vidCapt+'</span>');if(n&&a.vidWidth==='auto'){i(window).on('resize',function(){g=a.contElm.width();if(g!==d){d=g;d=a.contElm.width();h=o(d,a.aspect4x3)+m;c.find('iframe').attr('height',h).attr('width',d)}})}},l=document.location.protocol;l=l==='file:'?'http:':l;i.fn.videoLinks=function(g){var h=this;if(h.length){g=i.extend({vidWidth:'auto',vidHeight:'auto',aspect4x3:false},g);h.each(function(){var c=i(this),a=c.attr('href'),e=(/\.youtube\.com/i.test(a)&&'youtube')||(/\.(flv|mp4|m4v)(\?|$)/i.test(a)&&'file')||(/vimeo\.com/i.test(a)&&'vimeo')||(/youtu\.be/i.test(a)&&'youtu')||(/facebook\.com/i.test(a)&&'facebook')||undefined,f={videoHref:a,type:e,vidCapt:c.text(),vidWidth:g.vidWidth,vidHeight:g.vidHeight,autostart:!!g.autostart,aspect4x3:g.aspect4x3};if(e){var d=c.wrap('<span class="videoblock" />').parent();do{f.contElm=d}while(f.contElm.css('display')==='inline');d.data('playvideo_data',f).run(r);c.remove()}})}return h}})(jQuery);

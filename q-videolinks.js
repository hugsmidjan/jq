/* $.fn.videoLinks 1.0  -- (c) 2011-2015 Hugsmi√∞jan ehf. @preserve */
!function(f){function h(e,t){return Math.round("4x3"===t?e/4*3:"9x16"===t?e/9*16:e/16*9)}function l(){var s,e,m,t,a,i=f(this),o=i.data("playvideo_data"),l=o.videoHref,r=o.type,c="auto"!==o.cfg.vidWidth?o.cfg.vidWidth:o.contElm.width(),u="auto"!==o.cfg.vidHeight?o.cfg.vidHeight:h(c,o.cfg.aspect),d="",v=0,n="iframe",p=("youtube"===r||"youtu"===r?(t=(t="youtube"===r?l.match(/(?:embed\/|watch\/?\?v=)([^&?/]+)/i):l.match(/\.be\/(.+)$/))&&t[1],e=(e=l.match(/[?&]list=([^&?/]+)/))&&"list="+e[1]+"&"||"",d=o.cfg.autostart?"&autoplay=1":"",a=!0===o.cfg.autoHide?"":"&autohide="+o.cfg.autoHide,e=g+"//www.youtube-nocookie.com/embed/"+(t=e&&!t?"videoseries":t)+"?"+e+"rel=0&modestbranding=1&wmode=transparent"+d+a+o.cfg.filePlayerExtraParams,v=30):"vimeo"===r?e=/\/event\//.test(l)?/\/embed\//.test(l)?l:(t=(t=l.match(/\/event\/([0-9a-z]{5,8})\/?/i))&&t[1],g+"//vimeo.com/event/"+t+"/embed/"+o.cfg.filePlayerExtraParams):(t=(t=l.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i))&&t[1],d=o.cfg.autostart?"&autoplay=1":"",g+"//player.vimeo.com/video/"+t+"?title=1&amp;byline=0&amp;portrait=0"+d+o.cfg.filePlayerExtraParams):"facebook"===r?e=/\/videos\//.test(l)?(d=o.cfg.autostart?"&autoplay=true":"",g+"//www.facebook.com/v6.0/plugins/video.php?href="+encodeURIComponent(l)+"&locale="+o.cfg.locale+"&show_text=false"+d):(t=(t=l.match(/(?:\/v\/|\/videos\/|[?&]v=)(\d{10,20})/))&&t[1],g+"//www.facebook.com/video/embed?video_id="+t):"instagram"===r?(n="blockquote",e=l,i.data("load-script",{scripttoken:"instgrm",scripturl:"//platform.instagram.com/"+o.cfg.locale+"/embeds.js",onload:"window.instgrm.Embeds.process()"})):"file"===r?(t=!!(a=document.createElement("video")).canPlayType&&a.canPlayType("video/mp4").replace(/no/,""),a=!!a.canPlayType&&a.canPlayType("video/quicktime").replace(/no/,""),t&&/\.(mp4|m4v)(\?|$)/i.test(l)?(e=l,n="video",d=o.cfg.autostart?"autoplay":"",m="mp4"):a&&/\.mov(\?|$)/i.test(l)?(e=l,n="video",d=o.cfg.autostart?"autoplay":"",m="quicktime"):(d=o.cfg.autostart?"&autostart=true":"",e=o.cfg.filePlayerUrl+l+d+o.cfg.filePlayerExtraParams,n=o.cfg.filePlayerFrame,u+=o.cfg.filePlayerHeight)):e=l,"iframe"===n?i.html(f.inject('<iframe width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" scrolling="no" title="%{vidTitle}" allow="autoplay; encrypted-media" allowfullscreen></iframe>',{vidurl:e,vidwi:c,vidhe:u,vidTitle:o.vidCapt})):"video"===n?i.html(f.inject('<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto} controlslist="nodownload"><source src="%{vidurl}" type="video/%{mime}"></source></video>',{vidurl:e,vidwi:c,vidhe:u,auto:d,mime:m})):"blockquote"===n?i.html(f.inject('<blockquote class="%{class}" %{attributes} style="%{styles}"><a href="%{vidurl}"></a></blockquote>',{vidurl:e,class:"instagram-media",attributes:'data-instgrm-captioned data-instgrm-version="7"',styles:"margin:1px;padding:0;border:0;max-width:658px;width:calc(100% - 2px);"})):"flash"===n&&i.html(f.inject('<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',{vidurl:e,vidwi:c,vidhe:u})),o.cfg.useCaption&&0<o.vidCapt.length&&"instagram"!==n&&i.append('<span class="videocaption">'+o.vidCapt+"</span>"),"flash"!==n&&"instagram"!==r&&"auto"===o.cfg.vidWidth&&f(window).on("resize.videolinks",function(){(s=o.contElm.width())!==c&&(c=s,c=o.contElm.width(),u=h(c,o.cfg.aspect)+v,i.find("iframe,video").attr("height",u).attr("width",c))}),i.data("load-script"));p&&setTimeout(function(){var e;window[p.scripttoken]?new Function(p.onload).apply(null):((e=document.createElement("script")).async=!0,e.defer=!0,e.src=p.scripturl,e.onload=p.onload,f("head").append(e))},10)}var g="file:"===(g=document.location.protocol)?"http:":g;f.fn.videoLinks=function(o){return this.length&&(o=f.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect:"16x9",useCaption:!0,type:null,autoHide:!0,locale:"en_US",filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},o)).aspect4x3&&(o.aspect="4x3"),this.map(function(){var e=f(this),t=e.attr("href"),a=o.type||/\.youtube\.com/i.test(t)&&"youtube"||/youtu\.be/i.test(t)&&"youtu"||/vimeo\.com/i.test(t)&&"vimeo"||/facebook\.com/i.test(t)&&"facebook"||/instagram\.com/i.test(t)&&"instagram"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(t)&&"file"||void 0,i={cfg:o,videoHref:t,type:a,vidCapt:e.text().trim()},t=e.wrap('<span class="videoblock" />').parent();for(i.contElm=f(t);i.contElm[0]&&"inline"===i.contElm.css("display");)i.contElm=f(i.contElm.parent());return t.data("playvideo_data",i).run(l),e.remove(),t[0]})}}(jQuery);

/* $.fn.videoLinks 1.0  -- (c) 2011-2015 Hugsmi√∞jan ehf. @preserve */
!function(e){var a='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',t='<iframe width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" scrolling="no" allowfullscreen></iframe>',i='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',o=function(e,a){var t=a?e/4*3:e/16*9;return Math.round(t)},r=function(){var r,c,d,m,v=e(this),u=v.data("playvideo_data"),n=u.videoHref,f=u.type,s="auto"!==u.cfg.vidWidth?u.cfg.vidWidth:u.contElm.width(),p="auto"!==u.cfg.vidHeight?u.cfg.vidHeight:o(s,u.cfg.aspect4x3),h="",y="",w=0,g="iframe";if("youtube"===f||"youtu"===f)d="youtube"===f?n.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):n.match(/\.be\/(.+)$/),d=d&&d[1],h=u.cfg.autostart?"&autoplay=1":"",y=u.cfg.autoHide===!0?"":"&autohide="+u.cfg.autoHide,c=l+"//www.youtube.com/embed/"+d+"?rel=0&wmode=transparent"+h+y+u.cfg.filePlayerExtraParams,w=30;else if("vimeo"===f)d=n.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i),d=d&&d[1],h=u.cfg.autostart?"&autoplay=1":"",c=l+"//player.vimeo.com/video/"+d+"?title=1&amp;byline=0&amp;portrait=0"+h+u.cfg.filePlayerExtraParams;else if("facebook"===f)d=n.match(/(?:\/v\/|[?&]v=)(\d{10,20})/),d=d&&d[1],c=l+"//www.facebook.com/video/embed?video_id="+d;else if("file"===f){var b=document.createElement("video"),P=!!b.canPlayType&&b.canPlayType("video/mp4").replace(/no/,""),E=!!b.canPlayType&&b.canPlayType("video/quicktime").replace(/no/,"");P&&/\.(mp4|m4v)(\?|$)/i.test(n)?(c=n,g="video",h=u.cfg.autostart?"autoplay":"",m="mp4"):E&&/\.mov(\?|$)/i.test(n)?(c=n,g="video",h=u.cfg.autostart?"autoplay":"",m="quicktime"):(h=u.cfg.autostart?"&autostart=true":"",c=u.cfg.filePlayerUrl+n+h+u.cfg.filePlayerExtraParams,g=u.cfg.filePlayerFrame,p+=u.cfg.filePlayerHeight)}else c=n;"iframe"===g?v.html(e.inject(t,{vidurl:c,vidwi:s,vidhe:p})):"video"===g?v.html(e.inject(i,{vidurl:c,vidwi:s,vidhe:p,auto:h})):"flash"===g&&v.html(e.inject(a,{vidurl:c,vidwi:s,vidhe:p})),u.cfg.useCaption&&v.append('<span class="videocaption">'+u.vidCapt+"</span>"),"flash"!==g&&"auto"===u.cfg.vidWidth&&e(window).on("resize",function(){r=u.contElm.width(),r!==s&&(s=r,s=u.contElm.width(),p=o(s,u.cfg.aspect4x3)+w,v.find("iframe,video").attr("height",p).attr("width",s))})},l=document.location.protocol;l="file:"===l?"http:":l,e.fn.videoLinks=function(a){var t=this;return t.length&&(a=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,autoHide:!0,filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},a)),t.map(function(){var t=e(this),i=t.attr("href"),o=a.type||/\.youtube\.com/i.test(i)&&"youtube"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(i)&&"file"||/vimeo\.com/i.test(i)&&"vimeo"||/youtu\.be/i.test(i)&&"youtu"||/facebook\.com/i.test(i)&&"facebook"||void 0,l={cfg:a,videoHref:i,type:o,vidCapt:t.text()},c=t.wrap('<span class="videoblock" />').parent();for(l.contElm=e(c);l.contElm[0]&&"inline"===l.contElm.css("display");)l.contElm=e(l.contElm.parent());return c.data("playvideo_data",l).run(r),t.remove(),c[0]})}}(jQuery);


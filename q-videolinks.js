// $.fn.videoLinks 1.0  -- (c) 2011 Hugsmi√∞jan ehf.
!function(e){var t='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',a='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',i='<video width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" controls %{auto}><source src="%{vidurl}" type="video/%{mime}"></source></video>',o=function(e,t){var a=t?e/4*3:e/16*9;return Math.round(a)},l=function(){var l,c,d,v,m=e(this),u=m.data("playvideo_data"),n=u.videoHref,s=u.type,f="auto"!==u.cfg.vidWidth?u.cfg.vidWidth:u.contElm.width(),p="auto"!==u.cfg.vidHeight?u.cfg.vidHeight:o(f,u.cfg.aspect4x3),h="",y=0,w="iframe";if("youtube"===s||"youtu"===s)d=n.match("youtube"===s?/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i:/\.be\/(.+)$/),d=d&&d[1],h=u.cfg.autostart?"&autoplay=1":"",c=r+"//www.youtube.com/embed/"+d+"?rel=0"+h,y=30;else if("vimeo"===s)d=n.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i),d=d&&d[1],h=u.cfg.autostart?"&autoplay=1":"",c=r+"//player.vimeo.com/video/"+d+"?title=1&amp;byline=0&amp;portrait=0"+h;else if("facebook"===s)d=n.match(/(?:\/v\/|[?&]v=)(\d{10,20})/),d=d&&d[1],c=r+"//www.facebook.com/video/embed?video_id="+d;else if("file"===s){var g=document.createElement("video"),b=!!g.canPlayType&&g.canPlayType("video/mp4").replace(/no/,""),P=!!g.canPlayType&&g.canPlayType("video/quicktime").replace(/no/,"");b&&/\.(mp4|m4v)(\?|$)/i.test(n)?(c=n,w="video",h=u.cfg.autostart?"autoplay":"",v="mp4"):P&&/\.mov(\?|$)/i.test(n)?(c=n,w="video",h=u.cfg.autostart?"autoplay":"",v="quicktime"):(h=u.cfg.autostart?"&autostart=true":"",c=u.cfg.filePlayerUrl+n+h+u.cfg.filePlayerExtraParams,w=u.cfg.filePlayerFrame,p+=u.cfg.filePlayerHeight)}else c=n;"iframe"===w?m.html(e.inject(a,{vidurl:c,vidwi:f,vidhe:p})):"video"===w?m.html(e.inject(i,{vidurl:c,vidwi:f,vidhe:p,auto:h})):"flash"===w&&m.html(e.inject(t,{vidurl:c,vidwi:f,vidhe:p})),u.cfg.useCaption&&m.append('<span class="videocaption">'+u.vidCapt+"</span>"),"flash"!==w&&"auto"===u.cfg.vidWidth&&e(window).on("resize",function(){l=u.contElm.width(),l!==f&&(f=l,f=u.contElm.width(),p=o(f,u.cfg.aspect4x3)+y,m.find("iframe,video").attr("height",p).attr("width",f))})},r=document.location.protocol;r="file:"===r?"http:":r,e.fn.videoLinks=function(t){var a=this;return a.length&&(t=e.extend({autostart:!1,vidWidth:"auto",vidHeight:"auto",aspect4x3:!1,useCaption:!0,type:null,filePlayerUrl:"/bitar/common/media/mediaplayer.swf?file=",filePlayerExtraParams:"",filePlayerHeight:20,filePlayerFrame:"flash"},t)),a.map(function(){var a=e(this),i=a.attr("href"),o=t.type||/\.youtube\.com/i.test(i)&&"youtube"||/\.(flv|mp4|m4v|mov)(\?|$)/i.test(i)&&"file"||/vimeo\.com/i.test(i)&&"vimeo"||/youtu\.be/i.test(i)&&"youtu"||/facebook\.com/i.test(i)&&"facebook"||void 0,r={cfg:t,videoHref:i,type:o,vidCapt:a.text()},c=a.wrap('<span class="videoblock" />').parent();for(r.contElm=e(c);r.contElm[0]&&"inline"===r.contElm.css("display");)r.contElm=e(r.contElm.parent());return c.data("playvideo_data",r).run(l),a.remove(),c[0]})}}(jQuery);

(function(c,S){c.fn.log=function(){window.console&&console.log(this);return this};var K=function(a){window.console&&console.log(a);return a};var L=function(f){var f=c(f).filter('table').eq(0);if(!f.find('thead').length){var d=f.find('tbody'),g=c('<thead />').insertBefore(d[0]),i=d.find('tr'),j;i.each(function(a){var b=c(this),e=b.find('td');if((b.find('th').length&&(!e.length||a===0))||w(e)){b.appendTo(g);return}return false})}};var s=function(){},x=c.beget||function(a,b){s.prototype=a;return b?c.extend(new s,b):new s},w=function(a){return!c(a).clone().find('>b, >strong').remove().end().text().replace(/\s/g,'')},y=function(a){a=c(a);return{cols:parseInt('0'+a.attr('colspan'),10)||1,rows:parseInt('0'+a.attr('rowspan'),10)||1}},M=function(a){c(this).data(l).input.val('').trigger('change').trigger('focus');a.stopPropagation()},N=function(a){this.select()},O=function(a){var b=c(this);b.closest('td, th').toggleClass(K(b.data(l).cfg.fieldFocusClass),a.type=='focus')},t=function(b,e,f){c(b).each(function(){var a=c(this);if(e.hideRowClass){a.toggleClass(e.hideRowClass,f)}else if(f){a.css('display','')}else{a.hide()}})},z=function(a,b){t(a,b,1)},P=function(a,b){t(a,b,0)},Q=function(a){var b=c(this),e=b.data(l);clearTimeout(e._0);if(a.type=='change'){A(b)}else{e._0=setTimeout(function(){A(b)},e.cfg.delay)}},A=function(f){var d=f.val(),g=f.data(l),i=g.lastValue,j=g.table,h=g.cfg,m=g.btn,k=h.activeColClass,n;delete g._0;if(d&&!i){n=1;if(!h.multiFilter){g.allInputs.not(f).each(function(a){var b=this,e=c(b).data(l);if(b.value){this.value=e.lastValue='';B(j,e.idx,k,0)}})}}else if(!d&&i){n=1}g.lastValue=d;if(n){B(j,g.idx,k,!!d)}if(d!=i){R(g)}j.useCellMapCache=0},R=function(j){C(j.table);var h=j.cfg,m=j.table.find('tbody'),k=m.find('tr'),n;if(h.isStickyRow){k=k.filter(function(){var a=c(this).filter(h.isStickyRow);z(a,h);return!a.length})}if(h.isHideRow){k=k.filter(function(){var a=c(this).filter(h.isHideRow);P(a,h);return!a.length})}j.allInputs.each(function(f){var d=c(this),g=d.data(l);if(g.lastValue){n=1;var i=c.trim(this.value);i=h.matchCase?i:i.toLowerCase();k.each(function(){var a=c(this),b=a.data(u),e=b[f];t(a,h,(e&&h.cellMatches(e,i,g)))});k=k.filter(':visible')}});if(!n){z(m.find('tr'),h)}j.table.toggleClass(h.activeTableClass,n).trigger('filter.filterTable')},C=function(j){if(!j.useCellMapCache){var h=[];c(j).find('tr').each(function(){var f=c(this),d=0,g,i=[];f.data(u,i).children().each(function(){while(h[d]){h[d++]--}var a=this,b=y(a),e=b.cols;i[d]=a;while(e--){h[d]=b.rows-1;d++}});i.length=d});j.useCellMapCache=1}},B=function(a,b,e,f){C(a);var d=c(a).find('tr'),g=d.map(function(){return c(this).data(u)[b]||null});g.toggleClass(e,f)},T,U,V,W,X,l='filterTable',u=l+'-cellMap',q=!0;c.fn.filterTable=function(o){if(this.length){var D=this.filter('table').add(this.find('table'));if(D.length){o=x(arguments.callee.defaults,o);var E=E||c(o.filterRow),F=F||c(o.inputField).bind('focus',N).bind('focus blur',O).bind('change keyup',Q),G=G||c(o.clearBtn).bind('click',M),v=v||c(o.filterCell),H=H||v.clone(q).empty().append(F);D.each(function(){L(this);var i=c(this),j=i.find('tbody tr'),h=i.find('thead'),m=h.find('tr'),k=E.clone(q),n,I=!m.length,J={cfg:o,table:i},p=[],r=[];m=I?j.eq(0):m;m.each(function(){var d=0;c('>*',this).each(function(a,b){while(r[d]){r[d++]--}var e=y(b),f=e.cols;p[d]=b;while(f--){p[d]=p[d]||b;r[d]=e.rows-1;d++}})});p=c(p).each(function(a){var b=c(this);if(r[a]){b.attr('rowspan',m.length)}var e=G.clone(q),f=x(J,{idx:a,btn:e}),d=(b.filter(o.includeCols).length||I)?H:v,g=d.clone(q).appendTo(k).find('input').data(l,f).after(e);e.data(l,{input:g})});J.allInputs=k.find('input');k.appendTo(h)})}}return this};c.fn.filterTable.defaults={filterRow:'<tr class="filters" />',filterCell:'<td>&nbsp;</td>',inputField:'<input />',clearBtn:'<span class="clearfilter" />',activeTableClass:'filters-active',fieldFocusClass:'filter-focus',activeColClass:'filter-col',includeCols:function(){return c(this).is('th')||w(this)},cellMatches:function(a,b,e){var f=c(a).text()||'',d=e.cfg,g;f=d.matchCase?f:f.toLowerCase();g=f.indexOf(b);return d.substrSearch?g>-1:!g},substrSearch:true,delay:200,minChars:1}})(jQuery);
!function(t,e){var a=8>parseInt((/MSIE ([\w.]+)/.exec(navigator.userAgent)||[])[1],10),i=function(e,a){var e=t(e).filter("table").eq(0);if(!a.thead&&!e.find("thead").length){var i=e.find("tbody"),n=t("<thead />").insertBefore(i[0]),l=i.find("tr");l.each(function(e){var a=t(this),i=a.find("td");return a.find("th").length&&(!i.length||0===e)||s(i)?void a.appendTo(n):!1})}},n=function(){},l=t.beget||function(e,a){return n.prototype=e,a?t.extend(new n,a):new n},s=function(e){return!t(e).clone().find(">b, >strong").remove().end().text().replace(/\s/g,"")},r=function(e){return e=t(e),{cols:parseInt("0"+e.attr("colspan"),10)||1,rows:parseInt("0"+e.attr("rowspan"),10)||1}},c=function(e){t(this).data(y).input.val("").trigger("change").trigger("focus"),e.stopPropagation()},o=function(t){this.select()},f=function(e){var a=t(this);a.closest("td, th").toggleClass(a.data(y).cfg.fieldFocusClass,"focus"==e.type)},d=function(e,a,i){t(e).each(function(){var e=t(this);a.hideRowClass?e.toggleClass(a.hideRowClass,i):i?e.css("display",""):e.hide()})},h=function(t,e){d(t,e,1)},u=function(t,e){d(t,e,0)},p=function(e){var a=t(this),i=a.data(y);clearTimeout(i._searchThread),"change"==e.type?g(a):i._searchThread=setTimeout(function(){g(a)},i.cfg.delay)},g=function(e){var a=e.val(),i=e.data(y),n=i.lastValue,l=(i.table,i.cfg),s=(i.btn,l.activeColClass);delete i._searchThread,a&&!n&&(l.multiFilter||i.allInputs.not(e).each(function(e){var a=this,n=t(a).data(y);a.value&&(this.value=n.lastValue="",C(i,n.idx,s,0))})),i.lastValue=a,C(i,i.idx,s,a.length>=l.minChars),a!=n&&v(i),i.table_head.useCellMapCache=0},v=function(e){b(e);var a,i=e.cfg,n=e.table.find("tbody"),l=n.find("tr");i.isStickyRow&&(l=l.filter(function(){var e=t(this).filter(i.isStickyRow);return h(e,i),!e.length})),i.isHideRow&&(l=l.filter(function(){var e=t(this).filter(i.isHideRow);return u(e,i),!e.length})),e.allInputs.each(function(e){var n=t(this),s=n.data(y);if(s.lastValue){a=1;var r=t.trim(this.value);r=i.matchCase?r:r.toLowerCase(),r=r.length>=i.minChars?r:"",l.each(function(){var a=t(this),l=a.data(m),c=l[e];d(a,i,c&&i.cellMatches(c,r,s,n.is("select")))}),l=l.filter(":visible")}}),a||h(n.find("tr"),i),e.table_head.closest("table").toggleClass(i.activeTableClass,a),e.table.trigger("filter.filterTable")},b=function(e){var a=e.table_head;if(!a.useCellMapCache){var i=[];a.find("tr").each(function(){var e=t(this),a=0,n=[];e.data(m,n).children().each(function(){for(;i[a];)i[a++]--;var t=this,e=r(t),l=e.cols;for(n[a]=t;l--;)i[a]=e.rows-1,a++}),n.length=a}),a.useCellMapCache=1}},C=function(e,a,i,n){b(e);var l=e.table_head.find("tr"),s=l.map(function(){return t(this).data(m)[a]||null});s.toggleClass(i,n)},w=function(e){var a=e.data().filterTable,i=[],n="is"===t.lang&&"function"==typeof i.sortISL?"sortISL":"sort";t(a.table).find("tbody tr").each(function(){var e=t.trim(t(this).find("td:eq("+a.idx+")").text());e.length&&i.push(e)}),i=t.uniqueArray(i[n](),!0);for(var l=0;l<i.length;l++)e.append("<option>"+i[l]+"</option>")},y="filterTable",m=y+"-cellMap",T=!0;t.fn.filterTable=function(e){if(this.length){var n=this.filter("table").add(this.find("table"));if(n.length){e=l(arguments.callee.defaults,e);var s=t(e.filterRow),d=t(e.inputField).bind("focus",o).bind("focus blur",f).bind("change keyup",p),h=t(e.selectField).bind("focus blur",f).bind("change keyup",p),u=t(e.clearBtn).bind("click",c),g=t(e.filterCell),v=g.clone(T).empty().append(d),b=g.clone(T).empty().append(h);n.each(function(){i(this,e);var n=t(this),c=n.find("tbody tr"),o=e.thead?t(e.thead):n.find("thead"),f=o.find("tr"),d=s.clone(T),h=!f.length,p={cfg:e,table:n,table_head:t(n.add(e.thead))},C=[],m=[];if(f=h?c.eq(0):f,f.each(function(){var e=0;t(">*",this).each(function(i,n){for(;m[e];)m[e++]--;var l=r(n),s=l.cols;for(a&&t(n).attr("rowspan",l.rows),C[e]=n;s--;)C[e]=C[e]||n,m[e]=l.rows-1,e++})}),C=t(C).each(function(a){var i=t(this),n=i.is("."+e.selectFilterClass);m[a]&&i.attr("rowspan",f.length);var s=u.clone(T),r=l(p,{idx:a,btn:s}),c=(!i.filter(e.includeCols).length&&!h||n?(i.filter(e.includeCols).length||h)&&n?b:g:v).clone(T),o=c.appendTo(d).find("input, select").data(y,r).after(s);n&&w(o),s.data(y,{input:o})}),p.allInputs=d.find("input, select"),d.appendTo(o),e.fixColWidths){var x=[],I=0;d.find(">*").each(function(e){var a=parseInt(t(this).width(),10);x[e]=a,I+=a}).each(function(e){t(this).css({width:100*x[e]/I+"%"})})}})}}return this},t.fn.filterTable.defaults={fixColWidths:!0,filterRow:'<tr class="filters" />',filterCell:"<td>&nbsp;</td>",inputField:"<input />",selectField:'<select><option value=""></option></select>',clearBtn:'<span class="clearfilter"/>',activeTableClass:"filters-active",fieldFocusClass:"filter-focus",activeColClass:"filter-col",selectFilterClass:"select-filter",includeCols:function(){return t(this).is("th")||s(this)},cellMatches:function(e,a,i,n){var l,s=t(e).text()||"",r=i.cfg;return s=r.matchCase?s:s.toLowerCase(),l=n?t.trim(s)===t.trim(a)?1:-1:s.indexOf(a),r.substrSearch?l>-1:!l},substrSearch:!0,minChars:2,delay:300}}(jQuery);
// $.fn.filterTable 1.0  -- (c) 2009-2014 HugsmiÃ°jan ehf.
(function(t,e){var a=8>parseInt((/MSIE ([\w.]+)/.exec(navigator.userAgent)||[])[1],10);var i=function(e,a){var e=t(e).filter("table").eq(0);if(!a.thead&&!e.find("thead").length){var i=e.find("tbody"),n=t("<thead />").insertBefore(i[0]),l=i.find("tr"),s;l.each(function(e){var a=t(this),i=a.find("td");if(a.find("th").length&&(!i.length||e===0)||r(i)){a.appendTo(n);return}return false})}};var n=function(){},l=t.beget||function(e,a){n.prototype=e;return a?t.extend(new n,a):new n},r=function(e){return!t(e).clone().find(">b, >strong").remove().end().text().replace(/\s/g,"")},s=function(e){e=t(e);return{cols:parseInt("0"+e.attr("colspan"),10)||1,rows:parseInt("0"+e.attr("rowspan"),10)||1}},f=function(e){t(this).data(w).input.val("").trigger("change").trigger("focus");e.stopPropagation()},c=function(t){this.select()},o=function(e){var a=t(this);a.closest("td, th").toggleClass(a.data(w).cfg.fieldFocusClass,e.type=="focus")},h=function(e,a,i){t(e).each(function(){var e=t(this);if(a.hideRowClass){e.toggleClass(a.hideRowClass,i)}else if(i){e.css("display","")}else{e.hide()}})},u=function(t,e){h(t,e,1)},d=function(t,e){h(t,e,0)},v=function(e){var a=t(this),i=a.data(w);clearTimeout(i._searchThread);if(e.type=="change"){p(a)}else{i._searchThread=setTimeout(function(){p(a)},i.cfg.delay)}},p=function(e){var a=e.val(),i=e.data(w),n=i.lastValue,l=i.table,r=i.cfg,s=i.btn,f=r.activeColClass,c;delete i._searchThread;if(a&&!n){c=1;if(!r.multiFilter){i.allInputs.not(e).each(function(e){var a=this,n=t(a).data(w);if(a.value){this.value=n.lastValue="";C(i,n.idx,f,0)}})}}else if(!a&&n){c=1}i.lastValue=a;if(c){C(i,i.idx,f,!!a)}if(a!=n){g(i)}i.table_head.useCellMapCache=0},g=function(e){b(e);var a=e.cfg,i=e.table.find("tbody"),n=i.find("tr"),l;if(a.isStickyRow){n=n.filter(function(){var e=t(this).filter(a.isStickyRow);u(e,a);return!e.length})}if(a.isHideRow){n=n.filter(function(){var e=t(this).filter(a.isHideRow);d(e,a);return!e.length})}e.allInputs.each(function(e){var i=t(this),r=i.data(w);if(r.lastValue){l=1;var s=t.trim(this.value);s=a.matchCase?s:s.toLowerCase();n.each(function(){var i=t(this),n=i.data(y),l=n[e];h(i,a,l&&a.cellMatches(l,s,r))});n=n.filter(":visible")}});if(!l){u(i.find("tr"),a)}e.table_head.closest("table").toggleClass(a.activeTableClass,l);e.table.trigger("filter.filterTable")},b=function(e){var a=e.table_head;if(!a.useCellMapCache){var i=[];a.find("tr").each(function(){var e=t(this),a=0,n,l=[];e.data(y,l).children().each(function(){while(i[a]){i[a++]--}var t=this,e=s(t),n=e.cols;l[a]=t;while(n--){i[a]=e.rows-1;a++}});l.length=a});a.useCellMapCache=1}},C=function(e,a,i,n){b(e);var l=e.table_head.find("tr");var r=l.map(function(){return t(this).data(y)[a]||null});r.toggleClass(i,n)},w="filterTable",y=w+"-cellMap",T=!0;t.fn.filterTable=function(e){if(this.length){var n=this.filter("table").add(this.find("table"));if(n.length){e=l(arguments.callee.defaults,e);var r=t(e.filterRow);var h=t(e.inputField).bind("focus",c).bind("focus blur",o).bind("change keyup",v);var u=t(e.clearBtn).bind("click",f);var d=t(e.filterCell);var p=d.clone(T).empty().append(h);n.each(function(){i(this,e);var n=t(this),f=n.find("tbody tr"),c=e.thead?t(e.thead):n.find("thead"),o=c.find("tr"),h=r.clone(T),v,g=!o.length,b={cfg:e,table:n,table_head:t(n.add(e.thead))},C=[],y=[];o=g?f.eq(0):o;o.each(function(){var e=0;t(">*",this).each(function(i,n){while(y[e]){y[e++]--}var l=s(n),r=l.cols;a&&t(n).attr("rowspan",l.rows);C[e]=n;while(r--){C[e]=C[e]||n;y[e]=l.rows-1;e++}})});C=t(C).each(function(a){var i=t(this);if(y[a]){i.attr("rowspan",o.length)}var n=u.clone(T),r=l(b,{idx:a,btn:n}),s=(i.filter(e.includeCols).length||g?p:d).clone(T),f=s.appendTo(h).find("input").data(w,r).after(n);n.data(w,{input:f})});b.allInputs=h.find("input");h.appendTo(c);if(e.fixColWidths){var m=[],x=0;h.find(">*").each(function(e){var a=parseInt(t(this).width(),10);m[e]=a;x+=a}).each(function(e){t(this).width(100*m[e]/x+"%")})}})}}return this};t.fn.filterTable.defaults={fixColWidths:true,filterRow:'<tr class="filters" />',filterCell:"<td>&nbsp;</td>",inputField:"<input />",clearBtn:'<span class="clearfilter"/>',activeTableClass:"filters-active",fieldFocusClass:"filter-focus",activeColClass:"filter-col",includeCols:function(){return t(this).is("th")||r(this)},cellMatches:function(e,a,i){var n=t(e).text()||"",l=i.cfg,r;n=l.matchCase?n:n.toLowerCase();r=n.indexOf(a);return l.substrSearch?r>-1:!r},substrSearch:true,delay:300}})(jQuery);

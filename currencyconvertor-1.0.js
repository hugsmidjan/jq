// $.fn.currencyConvertor 1.0  -- (c) 2010 HugsmiÃ°jan ehf.
(function(e,t,l,a){l="currencyConvertor";a=' class="empty" />';e[l]={};t=e[l].config={rateCellSel:"td",emptyHeadCellTmpl:"<th"+a,emptyCellTmpl:"<td"+a,inputCellTmpl:'<td class="fi_txt"><input type="text" /></td>',inputSel:".fi_txt input",milleSep:true,decimals:2,decimalsThreshold:5,startAmount:1e3};e.fn[l]=function(a){a=e.extend({},t,a);var i=this,n=a.lang||this.closest("[lang]").attr("lang"),r=a.inputSel;i.delegate(r,"focusin",function(){e(this).select()}).delegate(r,"keyup",function(){var t=this,r=e(t).data(l);if(this.value!==r.V){r.V=this.value;var s=e.prettyNum.read(t,n);if(s!==r.v){var p=t.selectionStart;var u=t.selectionEnd;t.value=e.prettyNum.make(t,{trail:true,lang:n,milleSep:a.milleSep});t.setSelectionRange&&t.setSelectionRange(p,u);r.v=s;var d=s*r.F;i.find("input").each(function(){if(this!==t){var a=e(this).data(l),i=a.v=d/a.F;this.value=a.V=e.prettyNum.make(i,a.PN)}})}}}).delegate(r,"focusout",function(){var t=e(this).data(l);this.value=t.V=e.prettyNum.make(t.v,t.PN)}).find("tr").each(function(){var t=e(this);if(t.parent().is("thead, tfoot")){t.append(a.emptyHeadCellTmpl)}else{var i=0,s=0;t.find(a.rateCellSel).each(function(){i+=e.prettyNum.read(this,n)||0;s++});i=i/s;if(i){var p={F:i,PN:{lang:n,decimals:i>=a.decimalsThreshold?a.decimals:0,milleSep:a.milleSep},v:a.startAmount/i},u=p.V=e.prettyNum.make(p.v,p.PN);t.append(a.inputCellTmpl).find(r).data(l,p).val(u)}else{t.append(a.emptyCell)}}});return i}})(jQuery);

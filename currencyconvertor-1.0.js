// encoding: utf-8
// $.fn.currencyConvertor 1.0  -- (c) 2010 HugsmiÃ°jan ehf. 
(function(b,l,f,i){f='currencyConvertor';i=' class="empty" />';b[f]={};l=b[f].config={rateCellSel:'td',emptyHeadCellTmpl:'<th'+i,emptyCellTmpl:'<td'+i,inputCellTmpl:'<td class="fi_txt"><input type="text" /></td>',inputSel:'.fi_txt input',milleSep:true,decimals:2,decimalsThreshold:5,startAmount:1000};b.fn[f]=function(a){a=b.extend({},l,a);var j=this,g=a.lang||this.closest('[lang]').attr('lang'),k=a.inputSel,n={lang:g,decimals:a.decimals};j.delegate(k,'focus',function(c){b(this).select()}).delegate(k,'keyup',function(d){var e=this,h=b(e).data(f);if(this.value!=h.V){h.V=this.value;var m=b.prettyNum.read(e,g)*h.F;e.value=b.prettyNum.make(e,g,{trail:true,milleSep:a.milleSep});j.find('input').each(function(){if(this!=e){var c=b(this).data(f);this.value=b.prettyNum.make(m/c.F,g,{decimals:c.D,milleSep:a.milleSep})}})}}).find('tr').each(function(){var c=b(this);if(c.parent().is('thead, tfoot')){c.append(a.emptyHeadCellTmpl)}else{var d=0,e=0;c.find(a.rateCellSel).each(function(){d+=b.prettyNum.read(this,g)||0;e++});d=d/e;if(d){var h={F:d,D:d>=a.decimalsThreshold?a.decimals:0};c.append(a.inputCellTmpl).find(k).data(f,h).val(b.prettyNum.make(a.startAmount/d,g,{decimals:h.D,milleSep:a.milleSep}))}else{c.append(a.emptyCell)}}});return j}})(jQuery);

// encoding: utf-8
// $.fn.currencyConvertor 1.0  -- (c) 2010 HugsmiÃ°jan ehf. 
(function(a,n,f,j){f='currencyConvertor';j=' class="empty" />';a[f]={};n=a[f].config={rateCellSel:'td',emptyHeadCellTmpl:'<th'+j,emptyCellTmpl:'<td'+j,inputCellTmpl:'<td class="fi_txt"><input type="text" /></td>',inputSel:'.fi_txt input',milleSep:true,decimals:2,decimalsThreshold:5,startAmount:1000};a.fn[f]=function(b){b=a.extend({},n,b);var k=this,h=b.lang||this.closest('[lang]').attr('lang'),i=b.inputSel,p={lang:h,decimals:b.decimals};k.delegate(i,'focusin',function(d){a(this).select()}).delegate(i,'keyup',function(l){var e=this,g=a(e).data(f);if(this.value!=g.V){g.V=this.value;var m=a.prettyNum.read(e,h);if(m!=g.v){g.v=m;var o=m*g.F;e.value=a.prettyNum.make(e,{trail:true,lang:h,milleSep:b.milleSep});k.find('input').each(function(){if(this!=e){var d=a(this).data(f),c=d.v=o/d.F;this.value=d.V=a.prettyNum.make(c,d.PN)}})}}}).delegate(i,'focusout',function(d){var c=a(this).data(f);this.value=c.V=a.prettyNum.make(c.v,c.PN)}).find('tr').each(function(){var d=a(this);if(d.parent().is('thead, tfoot')){d.append(b.emptyHeadCellTmpl)}else{var c=0,l=0;d.find(b.rateCellSel).each(function(){c+=a.prettyNum.read(this,h)||0;l++});c=c/l;if(c){var e={F:c,PN:{lang:h,decimals:c>=b.decimalsThreshold?b.decimals:0,milleSep:b.milleSep},v:b.startAmount/c},g=e.V=a.prettyNum.make(e.v,e.PN);d.append(b.inputCellTmpl).find(i).data(f,e).val(g)}else{d.append(b.emptyCell)}}});return k}})(jQuery);

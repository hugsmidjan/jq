// $.fn.currencyConvertor 1.0  -- (c) 2015 HugsmiÃ°jan ehf.
!function(t,e,l,a){l="currencyConvertor",a=' class="empty" />',t[l]={},e=t[l].config={rateCellSel:"td",emptyHeadCellTmpl:"<th"+a,emptyCellTmpl:"<td"+a,inputCellTmpl:'<td class="fi_txt"><input type="text" /></td>',inputSel:".fi_txt input",milleSep:!0,decimals:2,decimalsThreshold:5,startAmount:1e3},t.fn[l]=function(a){a=t.extend({},e,a);var i=this,n=a.lang||this.closest("[lang]").attr("lang"),p=a.inputSel;return i.on("focusin",p,function(){t(this).select()}).on("keyup",p,function(){var e=this,p=t(e).data(l);if(this.value!==p.V){p.V=this.value;var r=t.prettyNum.read(e,n);if(r!==p.v){t(e).liveVal(t.prettyNum.make(e,{trail:!0,lang:n,milleSep:a.milleSep})),p.v=r;var s=r*p.F;i.find("input").each(function(){if(this!==e){var a=t(this).data(l),i=a.v=s/a.F;this.value=a.V=t.prettyNum.make(i,a.PN)}})}}}).on("focusout",p,function(){var e=t(this).data(l);this.value=e.V=t.prettyNum.make(e.v,e.PN)}).find("tr").each(function(){var e=t(this);if(e.parent().is("thead, tfoot"))e.append(a.emptyHeadCellTmpl);else{var i=0,r=0;if(e.find(a.rateCellSel).each(function(){i+=t.prettyNum.read(this,n)||0,r++}),i/=r){var s={F:i,PN:{lang:n,decimals:i>=a.decimalsThreshold?a.decimals:0,milleSep:a.milleSep},v:a.startAmount/i},u=s.V=t.prettyNum.make(s.v,s.PN);e.append(a.inputCellTmpl).find(p).data(l,s).val(u)}else e.append(a.emptyCell)}}),i}}(jQuery);

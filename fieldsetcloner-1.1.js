/* $.fieldsetCloner 1.1  -- (c) 2018 Hugsmiðjan ehf.  @preserve */
!function(e,t){e.fn.fieldsetCloner=t=function(l){return this.each(function(){var s=e(this),o=t.i18n[s.closest("[lang]").attr("lang")]||t.i18n.en,d=e.extend({},t.defaults,o,l);d.rowName=(s.attr(d.rowNameSel||"")||s.find(d.rowNameSel).eq(0).text()||d.rowName).replace(/:/g,""),d.$protoFS=s.clone(!!d.cloneEvents).each(function(){var t=e.trim(this.className);t&&(t=(t+" ").replace(/\s+/g,"-"+d.cloneClass+" ")+t),t+=" "+d.cloneClass,this.className=t}),d.$delBtn=d.addDelBtn&&e(d.delBtnTemplate.replace(/%\{className\}/g,d.delBtnClass).replace(/%\{label\}/g,d.delBtnLabel).replace(/%\{tooltip\}/g,d.delBtnTitle+d.rowName)).on("click",function(t){t.preventDefault();var l=e(this).data("$fsclnr"),n=l.attr("data-num");a(d,n),l.slideUp(d.showSpeed,function(){l.remove()}),d.cloneMax&&d.usedNums.length<d.cloneMax&&r.show(),"appendTo"===d.$place&&l.find("."+d.addBtnClass)[d.$place](l.prev())}),d.$place={after:"insertAfter",bottom:"appendTo"}[d.buttonPlacement]||"insertAfter",d.usedNums=[(d.initialCloneNo<10?"0":"")+d.initialCloneNo],d.cloneMax=parseInt(s.attr(d.cloneMaxSel||""),10)||null;var r=e(d.addBtnTemplate.replace(/%\{className\}/g,d.addBtnClass).replace(/%\{label\}/g,d.addBtnLabel+d.rowName).replace(/%\{tooltip\}/g,d.addBtnTitle+d.rowName))[d.$place](s);r.on("click",function(e){e.preventDefault();var t,a="appendTo"===d.$place,l=a?r.parent():r.prev();d.cloneMax&&d.usedNums.length===d.cloneMax&&r.hide(),a&&r.detach(),t=n(d).hide().insertAfter(l)[d.showFunc](d.showSpeed),a&&r[d.$place](t),d.afterClone&&d.afterClone(t)})})},t.defaults={buttonPlacement:"after",addBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',addBtnClass:"addrow",cloneClass:"clone",cloneSep:"-",cloneClassAttributes:!0,initialCloneNo:0,showFunc:"slideDown",showSpeed:"fast",delBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',delBtnClass:"delrow",attrsToInc:["id","for","name"]},t.i18n={en:{addBtnLabel:"Add ",addBtnTitle:"Add new ",delBtnLabel:"Delete",delBtnTitle:"Delete this ",rowName:"row"},is:{addBtnLabel:"Bæta við ",addBtnTitle:"Bæta við auka ",delBtnLabel:"Eyða",delBtnTitle:"Eyða þessari ",rowName:"röð"}};var a=function(e,t){var a=e.usedNums.indexOf("0"+t);e.usedNums.splice(a,1)},l=function(e){for(var t=e.initialCloneNo;t<e.initialCloneNo+100&&(t++,-1!==e.usedNums.indexOf("0"+t)););return e.usedNums.push("0"+t),e.usedNums=e.usedNums.sort(),t},n=function(e){var t,a,n=e.attrsToInc,s=e.$protoFS.clone(!!e.cloneEvents),o=l(e);return s.attr("data-num",o),e.$delBtn&&e.$delBtn.clone(!0).data("$fsclnr",s).appendTo(s.find(e.delBtnAppendTo).add(s).last()),(t=s[0].id)&&(a=t.match(/^(.*)(\d+)(\D*)$/),s[0].id=a?a[1]+(parseInt(a[2],10)+o)+a[3]:t+e.cloneSep+o),s.find("*").each(function(){for(var l=this,s=0;s<n.length;s++)(t=l.getAttribute(n[s]))&&(a=t.match(/^(.*)(\d+)(\D*)$/),l.setAttribute(n[s],a?a[1]+(parseInt(a[2],10)+o)+a[3]:t+e.cloneSep+o))}),s}}(window.jQuery);

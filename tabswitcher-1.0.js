//encoding: utf-8
// $.fn.tabSwitcher/.makeTabbox  1.0  -- (c) 2009 Hugsmiðjan ehf.
(function(a){var s,L,M=false,t={},u={},o,l='tabswitcher',v=function(c){var e=a('#'+c);var d=e.data(l);var b=d.config;d.tab.removeClass(b.currentTabClass);if(b.currentTabTag){d.tab.find(b.currentTabTag).zap()}if(b.cssHide){e.addClass(b.hiddenPaneClass)}else{e.hide()}if(b.openTabId==c){delete b.openTabId}delete t[c];d.block.trigger('Tabclose',c);e.trigger('Panelclose',c)},B=function(c){var e=a('#'+c);var d=e.data(l);var b=d.config;d.tab.addClass(b.currentTabClass);if(b.currentTabTag&&!a(b.currentTabTag,d.link).length){d.link.wrapInner('<'+b.currentTabTag+'/>')}if(b.cssHide){e.removeClass(b.hiddenPaneClass)}else{e.show()}b.openTabId=c;t[c]=true;d.block.trigger('Tabopen',c);e.trigger('Panelopen',c)},C=function(c){var e=a(c.target).closest('a[href*="#"]')[0];if(e){var d=a.getFrag(e.href);if(d&&u[d]&&!a(e).data(l+'Link')){a.tabSwitcher.switchTo(d);c.preventDefault()}}},D=function(c){a.tabSwitcher.switchTo(this);c.preventDefault()},w=function(c){a(this).parent().data(l).tab.setFocus();return false},E=function(c){c.target!==this&&a.tabSwitcher.switchTo(this.id,true)},p=null,x={},N=function(c){var e=a.getFrag();if(p!=e&&x[e]){tabSwitcher.switchTo(e,true);p=e}},O=function(){};a.extend({tabSwitcher:{version:1.0,fixInitScroll:true,cookieName:'tabswitcher',cookiePath:'/',cookieTTL:1200,defaultConfig:{tabSelector:'li',stripActiveClass:'tabs-active',currentTabClass:'current',currentTabTag:'strong',paneClass:'tabpane',hiddenPaneClass:'tabpane-hidden',cssHide:false,showFirst:true,setCookie:true,setFragment:true,monitorFragment:false,focusLinkTemplate:'<a href="#" class="focustarget">.</a>',returnLinkTemplate:'<a href="#" class="stream">.</a>',en:{backLinkText:'Back to '},is:{backLinkText:'Til baka í '}},switchTo:function(c,e){var d=c.href?a.getFrag(c.href):c,b=a('#'+d),h=b.data(l),i=h.config,f=i.openTabId;if(i){h.block.trigger('Tabswitch',{from:f,to:d});if(i.openTabId!=d){if(i.openTabId){v(i.openTabId)}B(d)}if(!e){if(i.setFragment){p=d;a.setFrag(d)}if(h.focusLink){a.setFocus(h.focusLink)}}h.block.trigger('Tabswitched',{from:f,to:d})}}}});a.fn.tabSwitcher=function(F){var G=a.getFrag();o=[[],[],[],[]];this.each(function(){var y=a(this),g=a.extend({},a.tabSwitcher.defaultConfig,F),H=a(g.tabSelector,this),q,m='',j=0;g.tabs={};g.tabBlock=this;H.each(function(e,d){q=q||a('a[href*="#"]');var b={tab:a(d)},h=b.link=(d.tagName=='A')?b.tab:a('a',d),i=(h.closest('[lang]').attr('lang')||'en').substr(0,2);b.lang=g[i]?i:'en';b.config=g;b.block=y;var f=a.getFrag(h.attr('href')),k=a(f?'#'+f:[]);k.data(l,b);if(k.length){k.addClass(g.paneClass);var n=g[b.lang].backLinkText+b.tab.text();if(g.focusLinkTemplate){b.focusLink=a(g.focusLinkTemplate).attr('title',n).bind('click',w).prependTo(k)}if(g.returnLinkTemplate){b.returnLink=a(g.returnLinkTemplate).attr('title',n).bind('click',w).appendTo(k)}if(!e&&!m&&g.showFirst){m=f;j=1}if(j<2&&b.tab.hasClass(g.currentTabClass)){m=f;j=2}if(j<3&&g.setCookie&&s&&a.inArray(s,f)>-1){m=f;j=3}if(j<4&&G==f){a(window).scrollTop(0);m=f;j=4}b.tab.bind('click',function(c){return false});v(f);u[f]=true;if(g.monitorFragment){x[f]=true}k.bind('Tabswitch',E);q.filter('[href$="#'+f+'"]').data(l+'Link',1).bind('click',D)}});y.addClass(g.stripActiveClass);if(m){o[j-1].unshift(m)}if(a.tabSwitcher.fixInitScroll&&j==4&&!g.setFragment){document.location.hash=''}});for(var r=0;r<4;r++){var I=o[r];for(var z=0,A;(A=I[z]);z++){a.tabSwitcher.switchTo(A,true)}}a(document).bind('click',C);return this};var J=a.fn.makeTabbox=function(b){b=a.beget(K,b);var h=[],i=this;if(i.length>=b.min){h=a(b.boxTempl).addClass(b.boxClass);var f=b.tabContSel?a(b.tabContSel,h):h,k=i.eq(0).parent(),n=k.closest('[lang]').attr('lang')||'';k.attr('lang',n);i.each(function(){var c=a(this);c.aquireId(b.defaultId);var e=b.makeTab(c,b).appendTo(f),d=c.closest('[lang]').attr('lang');d&&d!=n&&e.attr('lang',d)}).eq(0).before(h)}return this.pushStack(h)},K=J.defaults={min:2,defaultId:'tab1',tabContSel:'ul',titleSel:'h1, h2, h3',boxClass:'tab-box',boxTempl:'<div><ul class="tabs" /></div>',tabTempl:'<li><a href="#%{id}" title="%{title}">%{title}</a></li>',makeTab:function(c,e){return a(a.inject(e.tabTempl,{id:c[0].id,title:c.find(e.titleSel).eq(0).text()}))}}})(jQuery);

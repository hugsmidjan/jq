//encoding: utf-8
// $.fn.tabSwitcher/.makeTabbox  1.0  -- (c) 2009 Hugsmi√∞jan ehf. 
(function(a){var s,I,J=false,t={},u={},o,k='tabswitcher',v=function(c){var e=a('#'+c);var d=e.data(k);var b=d.config;d.tab.removeClass(b.currentTabClass);if(b.currentTabTag){var g=d.tab.find(b.currentTabTag);if(g.length){var f=d.link[0];while(g[0].firstChild){f.appendChild(g[0].firstChild)}g.remove()}}if(b.cssHide){e.addClass(b.hiddenPaneClass)}else{e.hide()}if(b.openTabId==c){delete b.openTabId}delete t[c];d.block.trigger('Tabclose',c);e.trigger('Panelclose',c)},A=function(c){var e=a('#'+c);var d=e.data(k);var b=d.config;d.tab.addClass(b.currentTabClass);if(b.currentTabTag&&!a(b.currentTabTag,d.link).length){d.link.wrapInner('<'+b.currentTabTag+'/>')}if(b.cssHide){e.removeClass(b.hiddenPaneClass)}else{e.show()}b.openTabId=c;t[c]=true;d.block.trigger('Tabopen',c);e.trigger('Panelopen',c)},B=function(c){var e=a(c.target).closest('a[href*="#"]')[0];if(e){var d=a.getFrag(e.href);if(d&&u[d]&&!a(e).data(k+'Link')){a.tabSwitcher.switchTo(d);c.preventDefault()}}},C=function(c){a.tabSwitcher.switchTo(this);c.preventDefault()},w=function(c){a(this).parent().data(k).tab.setfocus();return false},D=function(c){c.target!==this&&a.tabSwitcher.switchTo(this.id,true)},p=null,x={},K=function(c){var e=a.getFrag();if(p!=e&&x[e]){tabSwitcher.switchTo(e,true);p=e}},L=function(){};a.extend({tabSwitcher:{version:1.0,fixInitScroll:true,cookieName:'tabswitcher',cookiePath:'/',cookieTTL:1200,defaultConfig:{tabSelector:'li',stripActiveClass:'tabs-active',currentTabClass:'current',currentTabTag:'strong',paneClass:'tabpane',hiddenPaneClass:'tabpane-hidden',cssHide:false,showFirst:true,setCookie:true,setFragment:true,monitorFragment:false,focusLinkTemplate:'<a href="#" class="focustarget">.</a>',returnLinkTemplate:'<a href="#" class="stream">.</a>',en:{backLinkText:'Back to '}},i18n:function(c,e){return c},switchTo:function(c,e){var d=c.href?a.getFrag(c.href):c,b=a('#'+d),g=b.data(k),f=g.config,i=f.openTabId;if(f){g.block.trigger('Tabswitch',{from:i,to:d});if(f.openTabId!=d){if(f.openTabId){v(f.openTabId)}A(d)}if(!e){if(f.setFragment){p=d;a.setFrag(d)}if(g.focusLink){a.setFocus(g.focusLink)}}g.block.trigger('Tabswitched',{from:i,to:d})}}}});a.fn.tabSwitcher=function(E){var F=a.getFrag();o=[[],[],[],[]];this.each(function(){var m=a(this),h=a.extend({},a.tabSwitcher.defaultConfig,E),G=a(h.tabSelector,this),q,l='',j=0;h.tabs={};h.tabBlock=this;G.each(function(e,d){q=q||a('a[href*="#"]');var b={tab:a(d)},g=b.link=(d.tagName=='A')?b.tab:a('a',d);b.lang=g.closest('[lang]').attr('lang')||'en';b.config=h;b.block=m;var f=a.getFrag(g.attr('href')),i=a(f?'#'+f:[]);i.data(k,b);if(i.length){i.addClass(h.paneClass);var n=a.tabSwitcher.i18n(h.en.backLinkText,b.lang)+b.tab.text();if(h.focusLinkTemplate){b.focusLink=a(h.focusLinkTemplate).attr('title',n).bind('click',w).prependTo(i)}if(h.returnLinkTemplate){b.returnLink=a(h.returnLinkTemplate).attr('title',n).bind('click',w).appendTo(i)}if(!e&&!l&&h.showFirst){l=f;j=1}if(j<2&&b.tab.hasClass(h.currentTabClass)){l=f;j=2}if(j<3&&h.setCookie&&s&&a.inArray(s,f)>-1){l=f;j=3}if(j<4&&F==f){a(window).scrollTop(0);l=f;j=4}b.tab.bind('click',function(c){return false});v(f);u[f]=true;if(h.monitorFragment){x[f]=true}i.bind('Tabswitch',D);q.filter('[href$="#'+f+'"]').data(k+'Link',1).bind('click',C)}});m.addClass(h.stripActiveClass);if(l){o[j-1].unshift(l)}if(a.tabSwitcher.fixInitScroll&&j==4&&!h.setFragment){document.location.hash=''}});for(var r=0;r<4;r++){var H=o[r];for(var y=0,z;(z=H[y]);y++){a.tabSwitcher.switchTo(z,true)}}a(document).bind('click',B);return this};a.fn.makeTabbox=function(b){b=a.extend({min:2,defaultId:'tab1',tabContSel:'ul',titleSel:'h1, h2, h3',boxTempl:'<div class="tab-box"><ul class="tabs" /></div>',tabTempl:'<li><a href="#%{id}" title="%{title}">%{title}</a></li>',makeTab:function(c,e){return a(a.inject(e.tabTempl,{id:c[0].id,title:c.find(e.titleSel).eq(0).text()}))}},b);var g=[],f=this;if(f.length>=b.min){g=a(b.boxTempl);var i=b.tabContSel?a(b.tabContSel,g):g,n=f.eq(0).parent(),m=n.closest('[lang]').attr('lang')||'';n.attr('lang',m);f.each(function(){var c=a(this);c.aquireId(b.defaultId);var e=b.makeTab(c,b).appendTo(i),d=c.closest('[lang]').attr('lang');d&&d!=m&&e.attr('lang',d)}).eq(0).before(g)}return this.pushStack(g)}})(jQuery);

//encoding: utf-8
(function($){var m,_hashTarget,_inEventPhase=false,_openTabs={},_allTabIds={},_tabsToOpen,getHash=function(a){return(''+a).replace(/^.*#/,'')},closePanel=function(a){var b=$('#'+a);var d=b.data('tabswitcher');var c=d.config;d.tab.removeClass(c.currentTabClass);if(c.currentTabTag){var w=d.tab.find(c.currentTabTag);if(w.length){var p=d.link[0];while(w[0].firstChild){p.appendChild(w[0].firstChild)}w.remove()}}if(c.cssHide){b.addClass(c.hiddenPaneClass)}else{b.hide()}if(c.openTabId==a){delete c.openTabId}delete _openTabs[a];d.block.trigger('Tabclose',a);b.trigger('Panelclose',a)},openPanel=function(a){var b=$('#'+a);var d=b.data('tabswitcher');var c=d.config;d.tab.addClass(c.currentTabClass);if(c.currentTabTag&&!$(c.currentTabTag,d.link).length){d.link.wrapInner('<'+c.currentTabTag+'/>')}if(c.cssHide){b.removeClass(c.hiddenPaneClass)}else{b.show()}c.openTabId=a;_openTabs[a]=true;d.block.trigger('Tabopen',a);b.trigger('Panelopen',a)},crossReferenceMonitor=function(e){if(e.target){var l=(e.target.tagName=='A')?$(e.target):$(e.target).parents('a');if(l.length&&l[0].href&&l[0].href.indexOf('#')){var a=getHash(l.attr('href'));if(_allTabIds[a]){$.tabSwitcher.switchTo(a,true);return false}}}},_lastSetFragment=null,_fragmentsToMonitor={},monitorFragment=function(e){var a=document.location.hash.substr(1);if(_lastSetFragment!=a&&_fragmentsToMonitor[a]){tabSwitcher.switchTo(a,true);_lastSetFragment=a}},startFragmentMonitoring=function(){};$.extend({tabSwitcher:{version:1.0,fixInitScroll:true,cookieName:'tabswitcher',cookiePath:'/',cookieTTL:1200,defaultConfig:{tabSelector:'li',stripActiveClass:'tabs-active',currentTabClass:'current',currentTabTag:'strong',paneClass:'tabpane',hiddenPaneClass:'tabpane-hidden',cssHide:false,showFirst:true,setCookie:true,setFragment:true,monitorFragment:false,focusLinkTemplate:'<a href="#" class="focustarget">.</a>',returnLinkTemplate:'<a href="#" class="stream">.</a>',en:{backLinkText:'Back to '}},i18n:function(a,b){return a},switchTo:function(a,b){var e=getHash(a.href||a),panel=$('#'+e),d=panel.data('tabswitcher'),c=d.config,from=c.openTabId;if(c){d.block.trigger('Tabswitch',{from:from,to:e});if(c.openTabId!=e){if(c.openTabId){closePanel(c.openTabId)}openPanel(e)}if(!b){if(c.setFragment){_lastSetFragment=e;$.setHash(e)}if(d.focusLink){d.focusLink.trigger('focus')}}d.block.trigger('Tabswitched',{from:from,to:e})}}}});$.fn.tabSwitcher=function(k){_tabsToOpen=[[],[],[],[]];this.each(function(){var h=$(this),_conf=$.extend({},$.tabSwitcher.defaultConfig,k),tabs=$(_conf.tabSelector,this),openTabId='',openLevel=0;_conf.tabs={};_conf.tabBlock=this;tabs.each(function(i,t){var c={tab:$(t)};c.link=(t.tagName=='A')?c.tab:$('a',t);c.lang=c.link.add(c.link.parents()).filter('[lang]').attr('lang')||'en';c.config=_conf;c.block=h;var d=getHash(c.link.attr('href')),panel=$('#'+d);panel.data('tabswitcher',c);var f=function(e){var a=getHash($(this).attr('href'));var b=$('#'+a).data('tabswitcher').link;b.trigger('focus');return false};if(panel.length){panel.addClass(_conf.paneClass);var g=$.tabSwitcher.i18n(_conf.en.backLinkText,c.lang)+c.tab.text();if(_conf.focusLinkTemplate){c.focusLink=$(_conf.focusLinkTemplate).attr('href','#'+d).attr('title',g).bind('click',f).prependTo(panel)}if(_conf.returnLinkTemplate){c.returnLink=$(_conf.returnLinkTemplate).attr('href','#'+d).attr('title',g).bind('click',f).appendTo(panel)}if(!i&&!openTabId&&_conf.showFirst){openTabId=d;openLevel=1}if(openLevel<2&&c.tab.hasClass(_conf.currentTabClass)){openTabId=d;openLevel=2}if(openLevel<3&&_conf.setCookie&&m&&$.inArray(m,d)>-1){openTabId=d;openLevel=3}if(openLevel<4&&_hashTarget==d){openTabId=d;openLevel=4}c.link.bind('click',function(e){$.tabSwitcher.switchTo(this);return false});closePanel(d);_allTabIds[d]=true;if(_conf.monitorFragment){_fragmentsToMonitor[d]=true}panel.bind('Tabswitch',function(e){if(e.target!==this){$.tabSwitcher.switchTo(this.id,true)}}).bind('click',crossReferenceMonitor)}});h.addClass(_conf.stripActiveClass);if(openTabId){_tabsToOpen[openLevel-1].unshift(openTabId)}if($.tabSwitcher.fixInitScroll&&openLevel==4&&!_conf.setFragment){document.location.hash=''}});for(var i=0;i<4;i++){var l=_tabsToOpen[i];for(var j=0,tabId;(tabId=l[j]);j++){$.tabSwitcher.switchTo(tabId,true)}}return this};$.fn.makeTabbox=function(d){d=$.extend({titleSel:'h1, h2, h3',min:2,boxTempl:'<div class="tab-box"><ul class="tabs" /></div>',tabContSel:'ul',tabTempl:'<li><a href="#%{id}" title="%{title}">%{title}</a></li>',makeTab:function(a,b){var c=$.inject(b.tabTempl,{id:$.aquireId(a),title:$(b.titleSel,a).eq(0).text()});return $(c)}},d);var e=[],tabPanes=this;if(tabPanes.length>=d.min){e=$(d.boxTempl);var f=d.tabContSel?$(d.tabContSel,e):e,paneParent=tabPanes.eq(0).parent(),refLang=paneParent.closest('[lang]').attr('lang')||'';paneParent.attr('lang',refLang);tabPanes.each(function(){var a=d.makeTab(this,d),paneLang=$(this).closest('[lang]');if(paneLang!=refLang){a.attr('lang',paneLang)}a.appendTo(f)}).eq(0).before(e)}return this.pushStack(e)}})(jQuery);

// encoding: utf-8
// $.fn.videoList 1.0  -- (c) 2010 Hugsmi√∞jan ehf.
(function(c){var h=c('<div id="videobox" class="videobox box"><span class="videocontainer" /><h2/><div class="summary"/></div>'),n='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',o=function(k,e){var g=c(this),a=g.data('playvideo_cfg'),l=g.data('playvideo_data'),m=a.currentClass,i=l.videoHref,f=l.type,d,b,j;a.setfragment&&!e&&c.setFrag(i.replace(/^(https?:)?\/\//i,''));c('#video').remove();c(h.data('videoopener')).removeClass(m);g.addClass(m);h.data('videoopener',g);if(f=='youtube'){b=a.autostart=='all'?b='&autoplay=1':a.autostart=='none'?b='':e?'':'&autoplay=1';d='http://www.youtube.com/v/'+l.youtubeId+'&hl=en_US&fs=1&rel=0'+b;j=a.vidHeight+25}else if(f=='file'){b=a.autostart=='all'?b='&autostart=true':a.autostart=='none'?b='':e?'':'&autostart=true';var p=a.defaultImg?'&image='+a.defaultImg:'';d='/bitar/common/media/mediaplayer.swf?file='+i+p+b;j=a.vidHeight+20}else if(f=='vimeo'){var q=i.replace('http://vimeo.com/','');b=a.autostart=='all'?b='&autoplay=1':a.autostart=='none'?b='':e?'':'&autoplay=1';d='http://vimeo.com/moogaloop.swf?clip_id='+q+'&server=vimeo.com&show_portrait=0&fullscreen=1'+b;j=a.vidHeight}h.find('.videocontainer').html(c.inject(n,{vidurl:d,vidwi:a.vidWidth,vidhe:j}));h.find('h2').text(g.find('h3 a').text());h.find('.summary').text(g.find('.summary').text());k.preventDefault()};c.fn.videoList=function(f){var d=this;if(d.length){f=c.extend({vidWidth:684,vidHeight:414,currentClass:'current',autostart:'notfirst',youtubeImg:1,defaultImg:0},f);h.insertBefore(d.eq(0));d.find('.item').data('playvideo_cfg',f).bind('click',o).each(function(){var k=c(this),e=k.find('a').attr('href'),g=(/\.youtube\.com/i.test(e)&&'youtube')||(/\.(flv|mp4)(\?|$)/i.test(e)&&'file')||(/vimeo\.com/i.test(e)&&'vimeo')||'',a={videoHref:e,type:g};k.data('playvideo_data',a);if(f.youtubeImg&&g=='youtube'){a.youtubeId=e.split('?')[1].match(/v=([^&]+)/)[1];if(f.thumbnails){var l=Math.floor(Math.random()*3+1),m=f.youtubeImg=='large'?'0':'default',i='http://i'+l+'.ytimg.com/vi/'+a.youtubeId+'/'+m+'.jpg';if(i){k.find('img').attr('src',i)}}}});var b=c.getFrag(),j=b&&d.find('a[href$="'+b+'"]');c(j[0]||d.filter(':visible').find('.item')[0]).trigger('click',true)};return d}})(jQuery);

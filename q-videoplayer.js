// encoding: utf-8
// $.fn.videoList 1.0  -- (c) 2010 Hugsmi√∞jan ehf.
(function(e){var j=e('<div id="videobox" class="videobox box"><span class="videocontainer" /><h2/><div class="summary"/></div>'),r='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',s='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',k=document.location.protocol,k=k=='file:'?'http:':k,t=function(m,f){var h=e(this),a=h.data('playvideo_cfg'),p=h.data('playvideo_data'),q=a.currentClass,i=p.videoHref,b=p.type,d,c,n=false,l;a.setfragment&&!f&&e.setFrag(i.replace(/^(https?:)?\/\//i,''));if(b.length){e('#video').remove();e(j.data('videoopener')).removeClass(q);h.addClass(q);j.data('videoopener',h);if(b=='youtube'||b=='youtu'){var o=b=='youtube'?i.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i):i.match(/\.be\/(.+)$/);o=o&&o[1];if(o){c=a.autostart=='all'?c='&autoplay=1':a.autostart=='none'?c='':f?'':'&autoplay=1';d=k+'//www.youtube.com/embed/'+o+'?rel=0&wmode=transparent'+c;l=a.vidHeight+30;n=true}}else if(b=='file'){c=a.autostart=='all'?c='&autostart=true':a.autostart=='none'?c='':f?'':'&autostart=true';var u=a.defaultImg?'&image='+a.defaultImg:'';d='/bitar/common/media/mediaplayer.swf?file='+i+u+c;l=a.vidHeight+20}else if(b=='vimeo'){var g=i.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i);g=g&&g[1];if(g){c=a.autostart=='all'?c='&autoplay=1':a.autostart=='none'?c='':f?'':'&autoplay=1';d=k+'//player.vimeo.com/video/'+g+'?title=1&amp;byline=0&amp;portrait=0'+c;l=a.vidHeight;n=true}}else if(b=='facebook'){var g=i.match(/(?:\/v\/|[?&]v=)(\d{10,20})/);g=g&&g[1];if(g){d=k+'//www.facebook.com/v/'+g;l=a.vidHeight}}if(n){j.find('.videocontainer').html(e.inject(s,{vidurl:d,vidwi:a.vidWidth,vidhe:l}))}else{j.find('.videocontainer').html(e.inject(r,{vidurl:d,vidwi:a.vidWidth,vidhe:l}))}j.find('h2').text(h.find('h3 a').text());j.find('.summary').text(h.find('.summary').text());m.preventDefault()}};e.fn.videoList=function(b){var d=this;if(d.length){b=e.extend({vidWidth:684,vidHeight:414,currentClass:'current',autostart:'notfirst',youtubeImg:1,defaultImg:0,startOpen:1},b);j.insertBefore(d.eq(0));d.find('.item').data('playvideo_cfg',b).bind('click',t).each(function(){var m=e(this),f=m.find('a').attr('href'),h=(/\.youtube\.com/i.test(f)&&'youtube')||(/\.(flv|mp4|m4v)(\?|$)/i.test(f)&&'file')||(/vimeo\.com/i.test(f)&&'vimeo')||(/youtu\.be/i.test(f)&&'youtu')||(/facebook\.com/i.test(f)&&'facebook')||'',a={videoHref:f,type:h};m.data('playvideo_data',a);if(b.youtubeImg&&h=='youtube'){a.youtubeId=f.split('?')[1].match(/v=([^&]+)/)[1];if(b.thumbnails){var p=Math.floor(Math.random()*3+1),q=b.youtubeImg=='large'?'0':'default',i='http://i'+p+'.ytimg.com/vi/'+a.youtubeId+'/'+q+'.jpg';if(i){m.find('img').attr('src',i)}}}});var c=e.getFrag(),n=c&&d.find('a[href$="'+c+'"]');if(b.startOpen){e(n[0]||d.filter(':visible').find('.item')[0]).trigger('click',true)}};return d}})(jQuery);

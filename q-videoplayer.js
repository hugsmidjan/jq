// encoding: utf-8
// $.fn.videoList 1.0  -- (c) 2010 Hugsmi√∞jan ehf.
(function(c){var h=c('<div id="videobox" class="videobox box"><span class="videocontainer" /><h2/><div class="summary"/></div>'),o='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',p='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',k=document.location.protocol,k=k=='file:'?'http:':k,q=function(l,f){var g=c(this),a=g.data('playvideo_cfg'),m=g.data('playvideo_data'),n=a.currentClass,i=m.videoHref,e=m.type,d,b,j;a.setfragment&&!f&&c.setFrag(i.replace(/^(https?:)?\/\//i,''));c('#video').remove();c(h.data('videoopener')).removeClass(n);g.addClass(n);h.data('videoopener',g);if(e=='youtube'){var r=i.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i)[1];b=a.autostart=='all'?b='&autoplay=1':a.autostart=='none'?b='':f?'':'&autoplay=1';d=k+'//www.youtube.com/embed/'+r+'?rel=0'+b;j=a.vidHeight+30;useIframe=true}else if(e=='file'){b=a.autostart=='all'?b='&autostart=true':a.autostart=='none'?b='':f?'':'&autostart=true';var s=a.defaultImg?'&image='+a.defaultImg:'';d='/bitar/common/media/mediaplayer.swf?file='+i+s+b;j=a.vidHeight+20}else if(e=='vimeo'){var t=i.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i)[1];b=a.autostart=='all'?b='&autoplay=1':a.autostart=='none'?b='':f?'':'&autoplay=1';d=k+'//player.vimeo.com/video/'+t+'?title=1&amp;byline=0&amp;portrait=0&fullscreen=1'+b;j=a.vidHeight;useIframe=true}if(useIframe){h.find('.videocontainer').html(c.inject(p,{vidurl:d,vidwi:a.vidWidth,vidhe:j}))}else{h.find('.videocontainer').html(c.inject(o,{vidurl:d,vidwi:a.vidWidth,vidhe:j}))}h.find('h2').text(g.find('h3 a').text());h.find('.summary').text(g.find('.summary').text());l.preventDefault()};c.fn.videoList=function(e){var d=this;if(d.length){e=c.extend({vidWidth:684,vidHeight:414,currentClass:'current',autostart:'notfirst',youtubeImg:1,defaultImg:0,startOpen:1},e);h.insertBefore(d.eq(0));d.find('.item').data('playvideo_cfg',e).bind('click',q).each(function(){var l=c(this),f=l.find('a').attr('href'),g=(/\.youtube\.com/i.test(f)&&'youtube')||(/\.(flv|mp4|m4v)(\?|$)/i.test(f)&&'file')||(/vimeo\.com/i.test(f)&&'vimeo')||'',a={videoHref:f,type:g};l.data('playvideo_data',a);if(e.youtubeImg&&g=='youtube'){a.youtubeId=f.split('?')[1].match(/v=([^&]+)/)[1];if(e.thumbnails){var m=Math.floor(Math.random()*3+1),n=e.youtubeImg=='large'?'0':'default',i='http://i'+m+'.ytimg.com/vi/'+a.youtubeId+'/'+n+'.jpg';if(i){l.find('img').attr('src',i)}}}});var b=c.getFrag(),j=b&&d.find('a[href$="'+b+'"]');if(e.startOpen){c(j[0]||d.filter(':visible').find('.item')[0]).trigger('click',true)}};return d}})(jQuery);

// encoding: utf-8
// $.fn.videoList 1.0  -- (c) 2010 Hugsmi√∞jan ehf.
(function(e){var i=e('<div id="videobox" class="videobox box"><span class="videocontainer" /><h2/><div class="summary"/></div>'),q='<object id="video" width="%{vidwi}" height="%{vidhe}"><param name="movie" value="%{vidurl}"></param><param name="wmode" value="transparent"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="%{vidurl}" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" width="%{vidwi}" height="%{vidhe}"></embed></object>',r='<iframe title="YouTube video player" width="%{vidwi}" height="%{vidhe}" src="%{vidurl}" frameborder="0" allowfullscreen></iframe>',j=document.location.protocol,j=j=='file:'?'http:':j,s=function(k,f){var g=e(this),a=g.data('playvideo_cfg'),n=g.data('playvideo_data'),o=a.currentClass,h=n.videoHref,b=n.type,d,c,l=false,m;a.setfragment&&!f&&e.setFrag(h.replace(/^(https?:)?\/\//i,''));if(b.length){e('#video').remove();e(i.data('videoopener')).removeClass(o);g.addClass(o);i.data('videoopener',g);if(b=='youtube'||b=='youtu'){var t=b=='youtube'?h.match(/(?:embed\/|watch\/?\?v=)([^&?\/]+)/i)[1]:h.match(/\/([0-9a-z]+)$/i)[1];c=a.autostart=='all'?c='&autoplay=1':a.autostart=='none'?c='':f?'':'&autoplay=1';d=j+'//www.youtube.com/embed/'+t+'?rel=0'+c;m=a.vidHeight+30;l=true}else if(b=='file'){c=a.autostart=='all'?c='&autostart=true':a.autostart=='none'?c='':f?'':'&autostart=true';var u=a.defaultImg?'&image='+a.defaultImg:'';d='/bitar/common/media/mediaplayer.swf?file='+h+u+c;m=a.vidHeight+20}else if(b=='vimeo'){var p=h.match(/\/([0-9a-z]{5,10})\/?(?:[#?]|$)/i)[1];c=a.autostart=='all'?c='&autoplay=1':a.autostart=='none'?c='':f?'':'&autoplay=1';d=j+'//player.vimeo.com/video/'+p+'?title=1&amp;byline=0&amp;portrait=0'+c;m=a.vidHeight;l=true}else if(b=='facebook'){var p=h.match(/(\d{10,15})$/)[1];d=j+'//www.facebook.com/v/'+p}if(l){i.find('.videocontainer').html(e.inject(r,{vidurl:d,vidwi:a.vidWidth,vidhe:m}))}else{i.find('.videocontainer').html(e.inject(q,{vidurl:d,vidwi:a.vidWidth,vidhe:m}))}i.find('h2').text(g.find('h3 a').text());i.find('.summary').text(g.find('.summary').text());k.preventDefault()}};e.fn.videoList=function(b){var d=this;if(d.length){b=e.extend({vidWidth:684,vidHeight:414,currentClass:'current',autostart:'notfirst',youtubeImg:1,defaultImg:0,startOpen:1},b);i.insertBefore(d.eq(0));d.find('.item').data('playvideo_cfg',b).bind('click',s).each(function(){var k=e(this),f=k.find('a').attr('href'),g=(/\.youtube\.com/i.test(f)&&'youtube')||(/\.(flv|mp4|m4v)(\?|$)/i.test(f)&&'file')||(/vimeo\.com/i.test(f)&&'vimeo')||(/youtu\.be/i.test(f)&&'youtu')||(/facebook\.com/i.test(f)&&'facebook')||'',a={videoHref:f,type:g};k.data('playvideo_data',a);if(b.youtubeImg&&g=='youtube'){a.youtubeId=f.split('?')[1].match(/v=([^&]+)/)[1];if(b.thumbnails){var n=Math.floor(Math.random()*3+1),o=b.youtubeImg=='large'?'0':'default',h='http://i'+n+'.ytimg.com/vi/'+a.youtubeId+'/'+o+'.jpg';if(h){k.find('img').attr('src',h)}}}});var c=e.getFrag(),l=c&&d.find('a[href$="'+c+'"]');if(b.startOpen){e(l[0]||d.filter(':visible').find('.item')[0]).trigger('click',true)}};return d}})(jQuery);

// encoding: utf-8
// jQuery.fn.virtualBrowser 1.1 - MIT/GPL Licensed - More info: http://github.com/maranomynet/virtualbrowser/
(function(c,o){c.injectBaseHrefToHtml=function(a,g){var d=g.split('#')[0],e=d[i](/([^?]*\/)?(.*)/,'$2'),f=d.split('?')[0][i](/(.*\/)?.*/,'$1');a=a[i](/(<[^>]+ (href|src|action)=["'])(["'#])/gi,'$1'+e+'$3')[i](/(<[^>]+ (href|src|action)=["'])\?/gi,'$1'+e.split('?')[0]+'?')[i](/(["'])([a-z]{3,12}:)/gi,'$1`<<`>>$2')[i](/(<[^>]+ (href|src|action)=["'])([^\/`])/gi,'$1'+f+'$3')[i](/\`<<`>>/g,'');return a};c.getResultBody=function(a){return c('<div/>').append(c(a||[]).not('script,title,meta,link,style').find('script,style').remove().end())};var v=document.location,t='isDefaultPrevented',w='preventDefault',p='stopPropagation',m='passThrough',l='virtualBrowser',x='VBbeforeload',y='VBload',z='VBloaded',i='replace',A=/^(https?:)?\/\//,B={'load':function(d){var e=typeof d!='string'?c(d):o,f=c(this),h=f.data(l),j=h.cfg,k=c.Event(x),q,u,C=j.loadmsgMode,b={elm:e};if(e){d=e.attr('href');d=d===o?e.attr('action'):d}d=b.url=d===''?v.href:d;if(d){k[p]();f.trigger(k,b);if(!k[m]&&((k[m]===o&&e&&e[0].target&&e[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(d)&&!d.toLowerCase()[i](A,'').indexOf(v.href.toLowerCase()[i](A,'').split('/')[0])==0))){k[m]=true}k[m]&&k[w]();if(!k[t]()){var E=b.noCache=b.noCache!==o?b.noCache:j.noCache,r=j.params||'',s='GET';if(e&&e.is('form')){s=e.attr('method')||s;r+='&'+e.serialize();var D=h._0;if(D){r+='&'+c.param(D);delete h._0}}b.params=r;b.method=s;c.ajax({url:b.url.split('#')[0],data:r,type:s,cache:!E,complete:function(a,g){b.result=c.injectBaseHrefToHtml(a.responseText,b.url);b.xhr=a;b.status=g;q=c.Event(y);q[p]();f.trigger(q,b);if(!q[t]()){u=c.Event(z);u[p]();j.loadmsgElm.detach();b.resultDOM=b.resultDOM||c.getResultBody(b.result).contents();f.empty().append(b.resultDOM);f.trigger(u,b);h.lastRequest=b;delete b.resultDOM;delete b.result;delete b.xhr}}});if(C&&C!='none'){j.loadmsgMode=='replace'&&f.empty();f.append(j.loadmsgElm)}}}return k},'data':function(){return c(this).data(l)}},F=function(a){var g=c(a.target).closest(a.type=='click'?'[href], input:submit, button:submit':'form');if(g[0]){if(!a[t]()){if(!g.is(':submit')){var d=B['load'].call(this,g);if(!d[m]){a[w]();d.isPropagationStopped()&&a[p]()}}else if(g.is('[name]')){var e=c(this).data(l);e._0=g;setTimeout(function(){delete e._0},0)}}}},n=c.fn[l]=function(a,g){var d=typeof a=='string';if(d){var e=B[a];e&&this.each(function(){e.apply(this,[].concat(g))})}else{a=c.extend({},n.defaults,a);g&&(a.url=g);var f=this,h=a.loadmsgElm||'<div class="loading" />',j=(n.i18n[f.closest('*[lang]').attr('lang')]||{}).loading||n.i18n.en.loading;if(h.charAt){h=h.replace(/%\{msg\}/g,j)}h=a.loadmsgElm=c(h);if(!h.text()){h.append(j)}f.data(l,{cfg:a}).bind('click submit',F);a.onLoad&&f.bind(y,a.onLoad);a.onLoaded&&f.bind(z,a.onLoaded);a.onBeforeload&&f.bind(x,a.onBeforeload);a.params=typeof a.params=='string'?a.params:c.param(a.params||{});a.url&&f[l]('load',a.url)}return this};n.defaults={loadmsgMode:'none'};n.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

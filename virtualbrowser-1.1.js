!function(e,t){e.injectBaseHrefToHtml=function(e,t){var a=t.split("#")[0],i=a[c](/([^?]*\/)?(.*)/,"$2"),r=a.split("?")[0][c](/(.*\/)?.*/,"$1");return e=e[c](/(<[^>]+ (href|src|action)=["'])(["'#])/gi,"$1"+i+"$3")[c](/(<[^>]+ (href|src|action)=["'])\?/gi,"$1"+i.split("?")[0]+"?")[c](/(["'])([a-z-]{3,12}:)/gi,"$1`<<`>>$2")[c](/(<[^>]+ (href|src|action)=["'])([^\/`])/gi,"$1"+r+"$3")[c](/\`<<`>>/g,"")},e.getResultBody=e.getResultBody||function(t,a){var i=e.getResultBody;return a=a||{},e("<div/>").append(e(t||[]).not(a.stripFlat||i.stripFlat||"script,title,meta,link,style").find(a.stripDeep||i.stripDeep||"script,style").remove().end())},e.imgSuppress=e.imgSuppress||function(e,t){return e.replace(/(<img[^>]*? )src=/g,"$1"+(t||h)+"=")},e.imgUnsuppress=e.imgUnsuppress||function(t,a){a=a||h,t.find("img").add(t.filter("img")).attr("src",function(){var t=e(this),i=t.attr(a);return t.removeAttr(a),i})};var a=document.location,i="isDefaultPrevented",r="preventDefault",s="stopPropagation",n="passThrough",o="virtualBrowser",l="VBbeforeload",d="VBload",m="VBerror",p="VBloaded",u="VBdisengaged",c="replace",f="resultDOM",g="result",h="data-srcAttr",v=/^(https?:)?\/\//,b=function(t,a,i,r){var n=e.Event(t);return a.one(t,function(e){e[s]()}).trigger(n,[i,r]),n},y={load:function(s,u){var h,y,k,C={},T=e(this),_=T.data(o),x=_.cfg;if(e.isPlainObject(s)?(e.extend(C,s),y=C.url,delete C.elm):"string"==typeof s?y=s:(h=e(s),C.elm=h,y=h.attr("href"),y=y===t?h.attr("action"):y),y=C.url=""===y?a.href:y,_.lastRequest||(C.isFirst=!0),y){_._clicked&&(C.btn=_._clicked);var E=b(l,T,C,_);if(!E[n]&&(E[n]===t&&h&&h[0].target&&h[0].target!==window.name||/^([a-z]{3,12}:|\/\/)/i.test(y)&&0!==y.toLowerCase()[c](v,"").indexOf(a.href.toLowerCase()[c](v,"").split("/")[0]))&&(E[n]=!0),E[n]&&E[r](),!E[i]()){var V,S=C.noCache=C.noCache!==t?C.noCache:x.noCache,$=x.params?[x.params]:[];if(h&&h.is("form")){V=h.attr("method"),$.push(h.serialize());var D=_._clicked;if(D){var j=D.elm;if(j.is(":image")){var w=j[0].name;$.push(w+".x="+Math.round(D.X)),$.push(w+".y="+Math.round(D.Y))}else $.push(e.param(j));delete _._clicked}var H="multipart/form-data";E._doIframeSubmit=h.attr("enctype")===H||h.attr("encoding")===H||!!h.find("input:file")[0]}C.params&&$.push("string"==typeof C.params?C.params:e.param(C.params||{})),$=C.params=$.join("&"),V=C.method=C.method||V||"GET",T.addClass(x.loadingClass),x.loadmsgElm&&(k=setTimeout(function(){"replace"===x.loadmsgMode&&T.empty(),T.append(x.loadmsgElm)},0));var R={url:C.url.split("#")[0],data:$,type:V,cache:!S,complete:function(t,a){if(t){clearTimeout(k),T.removeClass(x.loadingClass||""),C.xhr=t,C.status=a||"error";var r=!a||"error"===a;r?b(m,T,C,_):(C[g]=e.injectBaseHrefToHtml(t.responseText||"",C.url),x.imgSuppress&&(C[g]=e.imgSuppress(C[g]))),C[g]&&x.selector&&(C[f]=e.getResultBody(C[g],x.stripCfg).find(x.selector)),(!r||C[g]||C[f])&&(b(d,T,C,_)[i]()||(x.loadmsgElm&&x.loadmsgElm.detach(),C[f]=C[f]||e.getResultBody(C[g],x.stripCfg).contents(),x.imgSuppress&&x.imgUnsuppress!==!1&&e.imgUnsuppress(C[f]),T.empty().append(C[f]),_.lastRequest=C,b(p,T,C,_),T.find("form").on("submit.vb"+T.data("VBid"),e.proxy(B,T[0])),delete C[f],delete C[g])),delete C.xhr,x.disengage&&T[o]("disengage")}}};if(E._doIframeSubmit){var L="if"+(new Date).getTime(),M=e('<iframe name="'+L+'" src=\'javascript:"";\' style="position:absolute;top:-999em;left:-999em;visibility:hidden;" />').appendTo("body"),P=h.attr("action")||"",U=h.attr("target")||"";h.attr("target",L),x.params&&h.attr("action",P+(/\?/.test(P)?"&":"?")+x.params),M.on("load",function(){var e="success";R.complete({fakeXHR:"iframe",responseText:"<html>"+M.contents().find("html").html()+"</html>"},e),h.attr({target:U,action:P}),setTimeout(function(){M.remove()},0)}),u&&u._nativeEvent||h.trigger("submit",["VBiframeHack"])}else e.ajax(R)}return E}},data:function(){return e(this).data(o)},disengage:function(){var t=e(this);t.removeData(o).unbind("click submit",B).find("form").unbind("submit.vb"+t.data("VBid"),B).end().unbind([l,m,d,p].join(" ")),b(u,t),t.unbind(u)}},B=function(t){if(!t[i]()&&!t[o+"Handled"]){var a=e(t.target).closest("submit"===t.type?"[action]":"input:submit, button:submit, input:image, [href]",this.parentNode);if(a[0]){var l=e(this);if(a.is("input, button")){if(!a[0].disabled){var d=l.data(o);if(a.is(":image")){var m=a.offset();d._clicked={elm:a,X:t.pageX-m.left,Y:t.pageY-m.top}}else a.is("[name]")&&(d._clicked={elm:a});d._clicked&&setTimeout(function(){delete d._clicked},0)}}else{var p=y.load.call(l[0],a,{_nativeEvent:!0});p[n]||(!p._doIframeSubmit&&t[r](),p.isPropagationStopped()&&t[s](),t[o+"Handled"]=!0)}}}},k=e.fn[o]=function(a,i){var r=this,s="string"==typeof a;if(s){var n,l=y[a];if(l&&r.each(function(e){var t=l.apply(this,[].concat(i));e||(n=t)}),n!==t)return n}else r.each(function(){var t=e(this),s=e.extend({},k.defaults,a);if(e.each(["Beforeload","Error","Load","Loaded","Disengaged"],function(e,t){e="on"+t,s[e]&&r.on("VB"+t.toLowerCase(),s[e]),delete s[e]}),s.params="string"==typeof s.params?s.params:e.param(s.params||{}),i&&(s.url=i),"none"!==s.loadmsgMode){var n=s.loadmsgElm||'<div class="loading" />',l=(k.i18n[t.closest("*[lang]").attr("lang")]||{}).loading||k.i18n.en.loading;n.charAt&&(n=n.replace(/%\{msg\}/g,l)),n=s.loadmsgElm=e(n),n.text()||n.append(l)}else delete s.loadmsgElm;t.data(o,{cfg:s}),t.on("click",B),t.data("VBid",(new Date).getTime()),s.url?t[o]("load",s.url):t.find("form").add(t.filter("form")).on("submit.vb"+t.data("VBid"),e.proxy(B,t[0]))});return this};k.defaults={loadmsgMode:"none"},k.i18n={en:{loading:"Loading..."},is:{loading:"Sæki gögn..."}}}(jQuery);

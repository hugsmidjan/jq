// encoding: utf-8
// jQuery.fn.virtualBrowser 1.1 - MIT/GPL Licensed - More info: http://github.com/maranomynet/virtualbrowser/
(function(b,o){b.injectBaseHrefToHtml=function(a,g){var c=g.split('#')[0],d=c[i](/([^?]*\/)?(.*)/,'$2'),f=c.split('?')[0][i](/(.*\/)?.*/,'$1');a=a[i](/(<[^>]+ (href|src|action)=["'])(["'#])/gi,'$1'+d+'$3')[i](/(<[^>]+ (href|src|action)=["'])\?/gi,'$1'+d.split('?')[0]+'?')[i](/(["'])([a-z]{3,12}:)/gi,'$1`<<`>>$2')[i](/(<[^>]+ (href|src|action)=["'])([^\/`])/gi,'$1'+f+'$3')[i](/\`<<`>>/g,'');return a};b.getResultBody=function(a){return b('<div/>').append(b(a||[]).not('script,title,meta,link,style').find('script,style').remove().end())};var v=document.location,t='isDefaultPrevented',w='preventDefault',p='stopPropagation',m='passThrough',l='virtualBrowser',x='VBbeforeload',y='VBload',z='VBloaded',i='replace',A=/^(https?:)?\/\//,B={'load':function(c){var d=typeof c!='string'?b(c):o,f=b(this),h=f.data(l),j=h.cfg,k=b.Event(x),q,u,C=j.loadmsgMode,e={elm:d};if(d){c=d.attr('href');c=c===o?d.attr('action'):c}c=e.url=c===''?v.href:c;if(c){k[p]();f.trigger(k,e);if(!k[m]&&((k[m]===o&&d&&d[0].target&&d[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(c)&&!c.toLowerCase()[i](A,'').indexOf(v.href.toLowerCase()[i](A,'').split('/')[0])==0))){k[m]=true}k[m]&&k[w]();if(!k[t]()){var E=e.noCache=e.noCache!==o?e.noCache:j.noCache,r=j.params||'',s='GET';if(d&&d.is('form')){s=d.attr('method')||s;r+='&'+d.serialize();var D=h._0;if(D){r+='&'+b.param(D);delete h._0}}e.params=r;e.method=s;b.ajax({url:e.url.split('#')[0],data:r,type:s,cache:!E,complete:function(a,g){e.result=b.injectBaseHrefToHtml(a.responseText,e.url);e.xhr=a;e.status=g;q=b.Event(y);q[p]();f.trigger(q,e);if(!q[t]()){u=b.Event(z);u[p]();j.loadmsgElm.detach();f.empty().append(e.resultDOM||b.getResultBody(e.result).contents());delete e.resultDOM;delete e.result;delete e.xhr;f.trigger(u,e);h.lastRequest=e}}});if(C&&C!='none'){j.loadmsgMode=='replace'&&f.empty();f.append(j.loadmsgElm)}}}return k},'data':function(){return b(this).data(l)}},F=function(a){var g=b(a.target).closest(a.type=='click'?'[href], input:submit, button:submit':'form');if(g[0]){if(!a[t]()){if(!g.is(':submit')){var c=B['load'].call(this,g);if(!c[m]){a[w]();c.isPropagationStopped()&&a[p]()}}else if(g.is('[name]')){var d=b(this).data(l);d._0=g;setTimeout(function(){delete d._0},0)}}}},n=b.fn[l]=function(a,g){var c=typeof a=='string';if(c){var d=B[a];d&&this.each(function(){d.apply(this,[].concat(g))})}else{a=b.extend({},n.defaults,a);g&&(a.url=g);var f=this,h=a.loadmsgElm||'<div class="loading" />',j=(n.i18n[f.closest('*[lang]').attr('lang')]||{}).loading||n.i18n.en.loading;if(h.charAt){h=h.replace(/%\{msg\}/g,j)}h=a.loadmsgElm=b(h);if(!h.text()){h.append(j)}f.data(l,{cfg:a}).bind('click submit',F);a.onLoad&&f.bind(y,a.onLoad);a.onLoaded&&f.bind(z,a.onLoaded);a.onBeforeload&&f.bind(x,a.onBeforeload);a.params=typeof a.params=='string'?a.params:b.param(a.params||{});a.url&&f[l]('load',a.url)}return this};n.defaults={loadmsgMode:'none'};n.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

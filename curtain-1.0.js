(function(b){var l=b.curtain=function(a,d){if(a=='destroy'){var e=b.inArray(d,f);if(e>-1){b(d).remove();f.splice(e,1)}if(!f.length){g.unbind('resize',k)}return}if(a&&(a.tagName||a.jquery)){d=a;a={}}a=b.extend({className:'curtain-overlay'},typeof(a)=='string'?{className:a}:typeof(a)=='boolean'&&a?{bg:'#888',opacity:.5,z:99}:a||{});var c=b(d||'<div />').hide().addClass(a.className).css({position:'absolute',top:0,left:0});if(!d||!d.parentNode){c.appendTo(document.body)}if(a.opacity&&!b.support.opacity&&c.css('opacity')==1){c.css('opacity',c.css('filter').match(/opacity=(\d+)/)?RegExp.$1/100:1)}f.push(c[0]);h=h||b('body');g.bind('resize',k);k(1);if(a.bg||a.opacity||a.z){c.css({background:a.bg,opacity:a.opacity,zIndex:a.z})}return c},f=l.list=[],g=b(window),h,k=function(a){var d=f.length,e=-1,c=-1;while(d--){var i=f[d];if(i&&((i.parentNode&&b(i).is(':visible'))||a==1)){e=e!=-1?e:Math.max(g.width(),h.innerWidth());c=c!=-1?c:Math.max(g.height(),h.innerHeight());var j=i.style;if(b.browser.msie){j.width=j.height='0'}j.width=e+'px';j.height=c+'px'}}};b.fn.curtain=function(a){return this.each(function(){b.curtain(a,this)})}})(jQuery);

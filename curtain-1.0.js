(function(b){var l=b.curtain=function(a,c){if(a=='destroy'){var e=b.inArray(c,f);if(e>-1){b(c).remove();f.splice(e,1)}if(!f.length){h.unbind('resize',k)}return}if(a&&(a.tagName||a.jquery)){c=a;a={}}a=b.extend({className:'curtain-overlay',container:(c&&c.parentNode)||document.body},typeof(a)=='string'?{className:a}:typeof(a)=='boolean'&&a?{bg:'#888',opacity:.5,z:99}:a||{});var d=b(c||'<div />');d.addClass(a.className).appendTo(a.container).css({position:'absolute',top:0,left:0}).hide().bind('click',function(g){g.stopPropagation();return false});if(!b.support.opacity&&d.css('opacity')==1){d.css('opacity',d.css('filter').match(/opacity=(\d+)/)?RegExp.$1/100:1)}f.push(d[0]);h.bind('resize',k);k('init');if(a.bg||a.opacity||a.z){d.css({background:a.bg,opacity:a.opacity,zIndex:a.z})}return d},f=l.list=[],h=b(window),i,k=function(g){var a=f.length,c=-1,e=c;i=i||b('body');while(a--){var d=f[a];if(d&&((d.parentNode&&b(d).is(':visible'))||g=='init')){c=c!=-1?c:Math.max(h.width(),i.innerWidth());e=e!=-1?e:Math.max(h.height(),i.innerHeight());var j=d.style;if(b.browser.msie){j.width=j.height='0'}j.width=c+'px';j.height=e+'px'}}};b.fn.curtain=function(g){return this.each(function(){b.curtain(g,this)})}})(jQuery);

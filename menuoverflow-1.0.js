// $.fn.menuOverflow 1.0  -- (c) 2011 HugsmiÃ°jan ehf.
(function(c,t){c.fn.menuOverflow=function(a){if(this.length){a=c.extend({itemSelector:'>li',overflowingClass:'menu-overflowing',overflowTempl:'<li class="overflow"><a href="#" /><ul/></li>',togglerText:'More...',delay:0,heightRepSelector:'>li:not(.current)',minWidthChange:10,heightThreshold:1.5,topThreshold:0.5},a);this.each(function(){var d=c(this),e=d.closest(a.wrapper||'*'),j=e.width(),o=d.find(a.itemSelector),f=a.customHeightRep&&c(a.customHeightRep),b=c(a.overflowTempl),g=b.find(a.dropMenuSelector||'ul'),h=false;b.find(a.togglerSelector||'a').html(a.togglerText);var k=function(){f=a.customHeightRep?f:d.find(a.heightRepSelector);var i=f.outerHeight(true),p=f.offset().top,q=i*a.heightThreshold,l=p+(i*a.topThreshold);if(e.height()>q){if(!h){b.insertAfter(o.last());d.addClass(a.overflowingClass);h=true}var m=d.find(a.itemSelector).not(b);var n=m.length;while(n--&&b.offset().top>l){g.prepend(m[n])}j=e.width()}else if(h&&e.width()>(j+a.minWidthChange)){var r=g.children();r.each(function(s){b.before(this);if(8>parseInt((/(msie) ([\w.]+)/.exec(navigator.userAgent)||[])[1],10)){b[0].className+=''}if(b.offset().top>l){g.prepend(this);return false}});if(g.children().length==0){b.remove();d.removeClass(a.overflowingClass);h=false}j=e.width()}};c(window).bind('resize',function(s){if(a.delay){clearTimeout(i);var i=setTimeout(k,a.delay)}else{k()}});k()})}return this}})(jQuery);

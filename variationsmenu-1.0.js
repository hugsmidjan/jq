/* jQuery.fn.variationsMenu 1.0 -- (c) 2012-2015 Hugsmi√∞jan ehf.  @preserve */
!function(a){var e=function(a,e,t,i){for(var n,r,l=t.join("|"),s=0;r=e[s++];){var u=i&&t[a]===r[a],d=!u&&r.join("|")===l;if(u||d){n=r;break}}return n},t=function(a,e){for(var t=[],i=e.length,n=-1;++n<i;)for(var r=t[n]={},l=a.length,s=-1;++s<l;){for(var u=a[s],d=-1;++d<i;)if(d!==n&&null!=e[d]&&u[d]!==e[d]){u=null;break}u&&(r[u[n]]=!0)}return t},i=function(e,t,i,n,r,l){a(e).each(function(e){var s=a(this),u=i[e];s.toggleClass(r.lastMenuClass,e===t),s.data("varMenuItems").each(function(){var t=this,i=a(t),s=i.find("input")[0],d=i.data("varValue"),c=!u[d],o=d===n[e];i.data("varDisabled",c).toggleClass(r.disabledClass,c),s.title=t.orgTitle+(c?" "+l.unavail:""),s.checked=o,i.toggleClass(r.currentClass,o)})})};a.fn.variationsMenu=function(n){n=a.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",lastMenuClass:"activemenu",i18n:{is:{unavail:"(Samsetning ekki til)"},en:{unavail:"(Combination unavailable)"}},priceElm:function(a){return a.closest("form").parent().find(".price b")},defaultPrice:"--",disabledClass:"disabled",autoSelect:"aggressive"},n);var r=[];return this.each(function(){var l,s=a(this),u=s.find("select"),d=s.find("label").contents(),c=(new Date).getTime(),o=n.i18n[s.closest("[lang]").attr("lang")]||n.i18n.en,v=a('<input type="hidden" />').attr({name:u[0].name}),g=n.imgCont&&a.fn.variationsImages?a(n.imgCont).variationsImages(n.variationsImages):null,m=(u.attr("data-tagnames")||"").split("|"),p=(u.attr("data-taglabels")||"").split("|"),f=m.length,h=new RegExp("\\s*"+(u.attr("data-tagjoint")||n.tagJoint)+"\\s*"),b=[],C=a.map(m,function(a,e){return{name:m[e],legend:p[e],vals:{},tagData:{}}}),y=new Array(f),k=u.is("[data-hasprice]")?a(n.priceElm.apply?n.priceElm(s):n.priceElm).last():null,w=null!=n.defaultPrice?n.defaultPrice:k&&k[0].firstChild;if(n.autoSelect&&u.children().filter(function(){return!a(this).attr("value")}).remove(),u.children().each(function(){var e=a(this),t=e.attr("value");if(t){var i=e.attr("data-tags").split("|"),r=e.attr("data-tagdata"),s=e.is(":selected"),u=[],d=e.text();if(k){var c=/\s+\(([^\(\)]+?)\)\s*$/,o=d.match(c);o&&(u.price=document.createTextNode(o[1]),d=d.replace(c,""))}d=d.split(h),r=r?r.split("|"):[],u.id=t;for(var v=0;f>v;v++){var g=i[v]||"";u.push(g),C[v].vals[g]=d[v]||n.emptyLabel,C[v].tagData[g]=r[v],s&&(y[v]=g)}s&&(l=u),b.push(u)}}),1===b.length&&!(b[0]||[]).join(""))return void v.val(b[0].id).replaceAll(s);var I=a.map(C,function(r,s){var u=a(n.menuTmpl.replace(/\{legend\}/g,r.legend)).addClass(r.name),d=0,m=a.map(r.vals,function(e,t){var i=n.menuItem.replace(/\{id\}/g,r.name+c+"-"+d++).replace(/\{tagname\}/g,r.name+c).replace(/\{label\}/g,e).replace(/\{value\}/g,t),l=a(i).data("varValue",t);return n.itemBuilder&&(l=n.itemBuilder(l,r.name,r.tagData[t],t,e)||l),l[0].orgTitle=e,l[0]});return m=a(m),m.on("click.variationmenu",function(u,d){var c=a(this),m=c.data("varValue")!==y[s];if(a(u.target).closest("[href]",c)[0]&&u.preventDefault(),d||(c.data("varDisabled")&&(y=new Array(f)),y[s]=c.data("varValue"),l=e(s,b,y),l||"aggressive"!==n.autoSelect||(l=e(s,b,y,!0),y=[].concat(l))),k){var p=l&&l.price||w,h=k[0].firstChild;p!==h&&a(h).replaceWith(p)}if(m||d){var C=t(b,y);i(I,s,C,y,n,o),c.trigger("variationchanged",[l,r.name,y[s]]),v.val(l?l.id:"").trigger("change"),g&&g.trigger("variationchanged",[l&&l.id])}}),u.data("varMenuItems",m).find("[items]").replaceWith(m),u.toArray()}),D=a(n.wrapper);r.push(D[0]),D.find("[headline]").replaceWith(a(n.wrapperHl).append(d)).end().find("[menus]").replaceWith(I).end().replaceAll(s),v.insertAfter(D),a(I[0]).data("varMenuItems").filter(function(){return a(this).data("varValue")===y[0]}).triggerHandler("click.variationmenu",[!0]),m=p=h=C=s=u=d=c=D=void 0}),this.pushStack(r)}}(jQuery);

// $.fn.variationsMenu 1.0 -- (c) 2012-2013 Hugsmi√∞jan ehf.
!function(a){var e=function(a,e){var t,i=a.length,n=-1;a:while(++n<i){var r=a[n],l=r.length,s=-1;while(++s<l){if(r[s]!==e[s]){continue a}}t=r;break}return t},t=function(a,e,t){var i={},n=e.length,r=-1;a:while(++r<n){var l=e[r],s=l.length,d=-1;while(++d<s){if(t[d]!==undefined&&d!==a&&l[d]!==t[d]){continue a}}i[l[a]]=true}return i};a.fn.variationsMenu=function(i){i=a.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",i18n:{is:{unavail:" (Samsetning ekki til)"},en:{unavail:" (Combination unavailable)"}},disabledClass:"disabled"},i);var n=[];this.each(function(){var r=a(this),l=r.find("select"),s=r.find("label").contents(),d=(new Date).getTime(),u=i.i18n[r.closest("[lang]").attr("lang")]||i.i18n.en,c=a('<input type="hidden" />').attr({name:l[0].name}),v=i.imgCont&&a.fn.variationsImages?a(i.imgCont).variationsImages(i.variationsImages):null,f=(l.attr("data-tagnames")||"").split("|"),g=(l.attr("data-taglabels")||"").split("|"),o=f.length,p=new RegExp("\\s*"+(l.attr("data-tagjoint")||i.tagJoint)+"\\s*"),m=[],h,C=[],b=a.map(f,function(a,e){return{name:f[e],legend:g[e],vals:{},tagData:{}}});l.children().filter(function(){return!a(this).attr("value")}).remove();l.children().each(function(){var e=a(this),t=e.attr("value");if(t){var n=e.text().split(p),r=e.attr("data-tags").split("|"),l=e.attr("data-tagdata"),s=e.is(":selected"),d=[];l=l?l.split("|"):[];d.id=t;for(var u=0;u<o;u++){var c=r[u]||"";d.push(c);b[u].vals[c]=n[u]||i.emptyLabel;b[u].tagData[c]=l[u];s&&(C[u]=c)}if(s){h=d}m.push(d)}});var k=a.map(b,function(n,r){var l=a(i.menuTmpl.replace(/\{legend\}/g,n.legend)).addClass(n.name),s=0,f,g=a.map(n.vals,function(e,t){var l=i.menuItem.replace(/\{id\}/g,n.name+d+"-"+s++).replace(/\{tagname\}/g,n.name+d).replace(/\{label\}/g,e).replace(/\{value\}/g,t),u=a(l).data("varValue",t),c=t===C[r];if(c){f=u[0]}if(i.itemBuilder){u=i.itemBuilder(u,n.name,n.tagData[t],t,e)||u}u[0].orgTitle=e;return u[0]});if(f||g.length===1){a(f||g[0]).addClass(i.currentClass).find("input").prop("checked",true)}g=a(g).on("click.variationmenu",function(l,s){var d=this,g=a(d),o=g.find("input");if(s||f!==d){if(!s||g.is("."+i.currentClass)){if(a(l.target).closest("[href]",d)[0]){l.preventDefault()}a(f).removeClass(i.currentClass);f=d;if(g.data("varDisabled")){C=[]}C[r]=g.data("varValue");h=e(m,C);g.removeClass(i.disabledClass).data("varDisabled",false).addClass(i.currentClass);o.prop("checked",true).attr("title",d.orgTitle);a(k).each(function(e){if(e!==r){var n=t(e,m,C);a(this).data("varMenuItems").each(function(){var e=a(this),t=e.find("input"),r=!n[e.data("varValue")];e.toggleClass(i.disabledClass,r).data("varDisabled",r);t.attr("title",this.orgTitle+(r?u.unavail:""));if(r&&t.prop("checked")){t.prop("checked",false);e.removeClass(i.currentClass)}})}})}g.trigger("variationchanged",[h,n.name,C[r]]);c.val(h?h.id:"");v&&v.trigger("variationchanged",[h&&h.id])}});l.data("varMenuItems",g).find("[items]").replaceWith(g);return l.toArray()});var w=a(i.wrapper);n.push(w[0]);w.find("[headline]").replaceWith(a(i.wrapperHl).append(s)).end().find("[menus]").replaceWith(k).end().replaceAll(r).after(c);a(k[0]).data("varMenuItems").filter(":first, ."+i.currentClass).last().triggerHandler("click.variationmenu",[true]);f=g=o=p=b=r=l=s=d=w=undefined});return this.pushStack(n)}}(jQuery);

// $.fn.variationsMenu 1.0 -- (c) 2012-2013 Hugsmi√∞jan ehf.
!function(a){var e=function(a,e){var t,i=a.length,n=-1;a:while(++n<i){var l=a[n],r=l.length,s=-1;while(++s<r){if(l[s]!==e[s]){continue a}}t=l;break}return t},t=function(a,e,t){var i={},n=e.length,l=-1;a:while(++l<n){var r=e[l],s=r.length,d=-1;while(++d<s){if(t[d]!==undefined&&d!==a&&r[d]!==t[d]){continue a}}i[r[a]]=true}return i};a.fn.variationsMenu=function(i){i=a.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",i18n:{is:{unavail:" (Samsetning ekki til)"},en:{unavail:" (Combination unavailable)"}},disabledClass:"disabled"},i);var n=[];this.each(function(){var l=a(this),r=l.find("select"),s=l.find("label").contents(),d=(new Date).getTime(),u=i.i18n[l.closest("[lang]").attr("lang")]||i.i18n.en,c=a('<input type="hidden" />').attr({name:r[0].name}),g=i.imgCont&&a.fn.variationsImages?a(i.imgCont).variationsImages(i.variationsImages):null,v=(r.attr("data-tagnames")||"").split("|"),p=(r.attr("data-taglabels")||"").split("|"),f=v.length,o=new RegExp("\\s*"+(r.attr("data-tagjoint")||i.tagJoint)+"\\s*"),m=[],h,C=[],b=a.map(v,function(a,e){return{name:v[e],legend:p[e],vals:{},tagData:{}}});r.children().each(function(e){var t=a(this),n=t.attr("value");if(n){var l=t.text().split(o),r=t.attr("data-tags").split("|"),s=t.attr("data-tagdata"),d=t.is(":selected"),u=[];s=s?s.split("|"):[];u.id=n;for(var c=0;c<f;c++){var g=r[c]||"";u.push(g);b[c].vals[g]=l[c]||i.emptyLabel;b[c].tagData[g]=s[c];d&&(C[c]=g)}if(d){h=u}m.push(u)}});var k=a.map(b,function(n,l){var r=a(i.menuTmpl.replace(/\{legend\}/g,n.legend)).addClass(n.name),s=0,v,p=a.map(n.vals,function(e,t){var r=i.menuItem.replace(/\{id\}/g,n.name+d+"-"+s++).replace(/\{tagname\}/g,n.name+d).replace(/\{label\}/g,e).replace(/\{value\}/g,t),u=a(r).data("varValue",t),c=t===C[l];if(c){v=u[0]}if(i.itemBuilder){u=i.itemBuilder(u,n.name,n.tagData[t],t,e)||u}u[0].orgTitle=e;return u[0]});if(v||p.length===1){a(v||p[0]).addClass(i.currentClass).find("input").prop("checked",true)}p=a(p).on("click.variationmenu",function(r,s){var d=this,p=a(d),f=p.find("input");if(s||v!==d){if(!s||p.is("."+i.currentClass)){if(a(r.target).closest("[href]",d)[0]){r.preventDefault()}a(v).removeClass(i.currentClass);v=d;if(p.data("varDisabled")){C=[]}C[l]=p.data("varValue");h=e(m,C);p.removeClass(i.disabledClass).data("varDisabled",false).addClass(i.currentClass);f.prop("checked",true).attr("title",d.orgTitle);a(k).each(function(e){if(e!==l){var n=t(e,m,C);a(this).data("varMenuItems").each(function(){var e=a(this),t=e.find("input"),l=!n[e.data("varValue")];e.toggleClass(i.disabledClass,l).data("varDisabled",l);t.attr("title",this.orgTitle+(l?u.unavail:""));if(l&&t.prop("checked")){t.prop("checked",false);e.removeClass(i.currentClass)}})}})}p.trigger("variationchanged",[h,n.name,C[l]]);c.val(h?h.id:"");g&&g.trigger("variationchanged",[h&&h.id])}});r.data("varMenuItems",p).find("[items]").replaceWith(p);return r.toArray()});var w=a(i.wrapper);n.push(w[0]);w.find("[headline]").replaceWith(a(i.wrapperHl).append(s)).end().find("[menus]").replaceWith(k).end().replaceAll(l).after(c);a(k[0]).data("varMenuItems").filter(":first, ."+i.currentClass).last().triggerHandler("click.variationmenu",[true]);v=p=f=o=b=l=r=s=d=w=undefined});return this.pushStack(n)}}(jQuery);

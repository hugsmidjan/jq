/* jQuery.fn.variationsMenu 1.0 -- (c) 2012-2015 Hugsmi√∞jan ehf.  @preserve */
!function(e){var a=function(e,a,t,n){for(var i,r,l=t.join("|"),s=0;r=a[s++];){var c=n&&t[e]===r[e],d=!c&&r.join("|")===l;if(c||d){i=r;break}}return i},t=function(e,a){for(var t=[],n=a.length,i=-1;++i<n;)for(var r=t[i]={},l=e.length,s=-1;++s<l;){for(var c=e[s],d=-1;++d<n;)if(d!==i&&null!=a[d]&&c[d]!==a[d]){c=null;break}c&&(r[c[i]]=!0)}return t},n=function(a,t,n,i,r,l){e(a).each(function(a){var s=e(this),c=n[a];s.toggleClass(r.lastMenuClass,a===t),s.data("varMenuItems").each(function(){var t=this,n=e(t),s=n.data("varValue"),d=!c[s],u=s===i[a];n.data("varDisabled",d).toggleClass(r.disabledClass,d).toggleClass(r.currentClass,u).attr("title",t.orgTitle+(d?" "+l.unavail:"")),n.find("input")[0].checked=u})})};e.fn.variationsMenu=function(i){i=e.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",lastMenuClass:"activemenu",i18n:{is:{unavail:"(Samsetning ekki til)"},en:{unavail:"(Combination unavailable)"}},disabledClass:"disabled",autoSelect:"aggressive",priceElm:function(e){return e.closest("form").parent().find(".price")},defaultPrice:function(e){return e.find("b")[0].firstChild.nodeValue},updatePrice:function(e,a,t){var n=e.data("prototype");if(n||(n=e.children("del").addBack().last().contents().detach(),n.filter("b").contents().eq(0).replaceWith('<span class="price__value"/>'),e.data("prototype",n)),e.empty(),t){n.clone().appendTo(e).wrapAll("<del/>"),e.find("del .price__value").replaceWith(a),n.clone().appendTo(e).eq(0).before(" ").end().wrapAll("<ins/>"),e.find("ins .price__value").replaceWith(t);var i=e.attr("data-offerlabel");i&&e.find("ins strong").text(i)}else n.clone().appendTo(e),e.find(".price__value").replaceWith(a)},unknownPrice:"--"},i);var r=[];return this.each(function(){var l,s,c,d=e(this),u=d.find("select"),o=d.find("label").contents(),p=(new Date).getTime(),f=i.i18n[d.closest("[lang]").attr("lang")]||i.i18n.en,v=e('<input type="hidden" />').attr({name:u[0].name}),g=i.imgCont&&e.fn.variationsImages?e(i.imgCont).variationsImages(i.variationsImages):null,m=(u.attr("data-tagnames")||"").split("|"),h=(u.attr("data-taglabels")||"").split("|"),b=m.length,C=new RegExp("\\s*"+(u.attr("data-tagjoint")||i.tagJoint)+"\\s*"),w=[],y=e.map(m,function(e,a){return{name:m[a],legend:h[a],vals:{},tagData:{}}}),k=new Array(b);u.is("[data-hasprice]")&&(s=e(i.priceElm.apply?i.priceElm(d):i.priceElm),c=i.defaultPrice(s));var T=function(){if(s){var e=l?l.price||c:i.unknownPrice,a=l&&l.priceOffer;i.updatePrice(s,e,a)}};if(i.autoSelect&&u.children().filter(function(){return!e(this).attr("value")}).remove(),u.children().each(function(){var a=e(this),t=a.attr("value");if(t){var n=a.attr("data-tags").split("|"),r=a.attr("data-tagdata"),c=a.is(":selected"),d=[],u=a.text();if(s){var o=/\s+\(([^\(\)]+?)\)\s*$/,p=u.match(o);if(p){u=u.replace(o,"");var f=document.createTextNode(p[1]),v=a.attr("data-beforeprice");d.price=v||f,d.priceOffer=v?f:""}}u=u.split(C),r=r?r.split("|"):[],d.id=t;for(var g=0;b>g;g++){var m=n[g]||"";d.push(m),y[g].vals[m]=u[g]||i.emptyLabel,y[g].tagData[m]=r[g],c&&(k[g]=m)}c&&(l=d),w.push(d)}}),1===w.length&&!(w[0]||[]).join(""))return T(),void v.val(w[0].id).replaceAll(d);var _=e.map(y,function(r,s){var c=e(i.menuTmpl.replace(/\{legend\}/g,r.legend)).addClass(r.name),d=0,u=e.map(r.vals,function(a,t){var n=i.menuItem.replace(/\{id\}/g,r.name+p+"-"+d++).replace(/\{tagname\}/g,r.name+p).replace(/\{label\}/g,a).replace(/\{value\}/g,t),l=e(n).data("varValue",t);return i.itemBuilder&&(l=i.itemBuilder(l,r.name,r.tagData[t],t,a)||l),l[0].orgTitle=a,l[0]});return u=e(u),u.on("click.variationmenu",function(c,d){var u=e(this),o=u.data("varValue")!==k[s];if(e(c.target).closest("[href]",u)[0]&&c.preventDefault(),d||(u.data("varDisabled")&&(k=new Array(b)),k[s]=u.data("varValue"),l=a(s,w,k),l||"aggressive"!==i.autoSelect||(l=a(s,w,k,!0),k=[].concat(l))),T(),o||d){var p=t(w,k);n(_,s,p,k,i,f),u.trigger("variationchanged",[l,r.name,k[s]]),v.val(l?l.id:"").trigger("change"),g&&g.trigger("variationchanged",[l&&l.id])}}),c.data("varMenuItems",u).find("[items]").replaceWith(u),c.toArray()}),A=e(i.wrapper);r.push(A[0]),A.find("[headline]").replaceWith(e(i.wrapperHl).append(o)).end().find("[menus]").replaceWith(_).end().replaceAll(d),v.insertAfter(A),e(_[0]).data("varMenuItems").filter(function(){return e(this).data("varValue")===k[0]}).triggerHandler("click.variationmenu",[!0]),m=h=C=y=d=u=o=p=A=void 0}),this.pushStack(r)}}(jQuery);

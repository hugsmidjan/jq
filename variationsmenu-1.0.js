/* $.fn.variationsMenu 1.0 -- (c) 2012-2013 Hugsmi√∞jan ehf.  @preserve */
!function(e){var a=function(e,a){var t,i=e.length,l=-1;e:for(;++l<i;){for(var r=e[l],n=r.length,s=-1;++s<n;)if(r[s]!==a[s])continue e;t=r;break}return t},t=function(e,a,t,i){for(var l={},r=t.length,n=0;r>n;){var s=t[n++];s[a]===i[a]&&(l[s[e]]=!0)}return l},i=function(a,t){var i=e(a.data("varSelectedItem"));i.addClass(t.currentClass).find("input").prop("checked",!0).attr("title",i.orgTitle)};e.fn.variationsMenu=function(l){l=e.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",lastMenuClass:"activemenu",i18n:{is:{unavail:"(Samsetning ekki til)"},en:{unavail:"(Combination unavailable)"}},priceElm:function(e){return e.closest("form").parent().find(".price b")},defaultPrice:"--",disabledClass:"disabled",autoSelect:!0},l);var r=[];return this.each(function(){var n,s=e(this),d=s.find("select"),u=s.find("label").contents(),c=(new Date).getTime(),v=l.i18n[s.closest("[lang]").attr("lang")]||l.i18n.en,m=e('<input type="hidden" />').attr({name:d[0].name}),o=l.imgCont&&e.fn.variationsImages?e(l.imgCont).variationsImages(l.variationsImages):null,p=(d.attr("data-tagnames")||"").split("|"),g=(d.attr("data-taglabels")||"").split("|"),f=p.length,h=new RegExp("\\s*"+(d.attr("data-tagjoint")||l.tagJoint)+"\\s*"),C=[],b=[],I=e.map(p,function(e,a){return{name:p[a],legend:g[a],vals:{},tagData:{}}}),S=d.is("[data-hasprice]")?e(l.priceElm.apply?l.priceElm(s):l.priceElm):null,k=null!=l.defaultPrice?l.defaultPrice:S&&S[0].firstChild;if(l.autoSelect&&d.children().filter(function(){return!e(this).attr("value")}).remove(),d.children().each(function(){var a=e(this),t=a.attr("value");if(t){var i=a.attr("data-tags").split("|"),r=a.attr("data-tagdata"),s=a.is(":selected"),d=[],u=a.text();if(S){var c=/\s+\(([^\(\)]+?)\)\s*$/,v=u.match(c);v&&(d.price=document.createTextNode(v[1]),u=u.replace(c,""))}u=u.split(h),r=r?r.split("|"):[],d.id=t;for(var m=0;f>m;m++){var o=i[m]||"";d.push(o),I[m].vals[o]=u[m]||l.emptyLabel,I[m].tagData[o]=r[m],s&&(b[m]=o)}s&&(n=d),C.push(d)}}),1===C.length&&!(C[0]||[]).join(""))return void m.val(C[0].id).replaceAll(s);var D=e.map(I,function(r,s){var d=e(l.menuTmpl.replace(/\{legend\}/g,r.legend)).addClass(r.name),u=0,p=e.map(r.vals,function(a,t){var i=l.menuItem.replace(/\{id\}/g,r.name+c+"-"+u++).replace(/\{tagname\}/g,r.name+c).replace(/\{label\}/g,a).replace(/\{value\}/g,t),n=e(i).data("varValue",t),v=t===b[s];return v&&d.data("varSelectedItem",n[0]),l.itemBuilder&&(n=l.itemBuilder(n,r.name,r.tagData[t],t,a)||n),n[0].orgTitle=a,n[0]});return i(d,l),p=e(p).on("click.variationmenu",function(u,c){var g=this,f=e(g),h=d.data("varSelectedItem"),I=h!==g;if(c||(e(u.target).closest("[href]",g)[0]&&u.preventDefault(),I&&(e(h).removeClass(l.currentClass),h=g,d.data("varSelectedItem",h),f.data("varDisabled")&&(b=[]),b[s]=f.data("varValue"),n=a(C,b),p.removeClass(l.disabledClass).data("varDisabled",!1),i(d,l)),d.addClass(l.lastMenuClass),e(D).each(function(a){if(a!==s){var i=e(this),r=t(a,s,C,b,n);i.removeClass(l.lastMenuClass),i.data("varMenuItems").each(function(){var a=e(this),t=a.find("input")[0],n=!r[a.data("varValue")];a.data("varDisabled",n).toggleClass(l.disabledClass,n),t.title=this.orgTitle+(n?" "+v.unavail:""),n&&a[0]===i.data("varSelectedItem")&&(i.data("varSelectedItem",null),a.removeClass(l.currentClass),t.checked=!1)})}})),S){var y=n&&n.price||k,M=S[0].firstChild;y!==M&&e(M).replaceWith(y)}(I||c)&&(f.trigger("variationchanged",[n,r.name,b[s]]),m.val(n?n.id:"").trigger("change"),o&&o.trigger("variationchanged",[n&&n.id]))}),d.data("varMenuItems",p).find("[items]").replaceWith(p),d.toArray()}),y=e(l.wrapper);r.push(y[0]),y.find("[headline]").replaceWith(e(l.wrapperHl).append(u)).end().find("[menus]").replaceWith(D).end().replaceAll(s),m.insertAfter(y),e(D[0]).data("varMenuItems").filter("."+l.currentClass).triggerHandler("click.variationmenu",[!0]),p=g=f=h=I=s=d=u=c=y=void 0}),this.pushStack(r)}}(jQuery);
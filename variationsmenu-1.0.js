/* jQuery.fn.variationsMenu 1.0 -- (c) 2012-2015 Hugsmi√∞jan ehf.  @preserve */
!function(e){var a=function(e,a,t,i){for(var n,r,l=t.join("|"),s=0;r=a[s++];){var c=i&&t[e]===r[e],d=!c&&r.join("|")===l;if(c||d){n=r;break}}return n},t=function(e,a){for(var t=[],i=a.length,n=-1;++n<i;)for(var r=t[n]={},l=e.length,s=-1;++s<l;){for(var c=e[s],d=-1;++d<i;)if(d!==n&&null!=a[d]&&c[d]!==a[d]){c=null;break}c&&(r[c[n]]=!0)}return t},i=function(a,t,i,n,r,l){e(a).each(function(a){var s=e(this),c=i[a];s.toggleClass(r.lastMenuClass,a===t),s.data("varMenuItems").each(function(){var t=this,i=e(t),s=i.data("varValue"),d=!c[s],u=s===n[a];i.data("varDisabled",d).toggleClass(r.disabledClass,d).toggleClass(r.currentClass,u).attr("title",t.orgTitle+(d?" "+l.unavail:"")),i.find("input")[0].checked=u})})};e.fn.variationsMenu=function(n){n=e.extend({imgCont:".imagelist",tagJoint:" - ",wrapper:'<fieldset class="variationsmenu"><i headline/><i menus/></fieldset>',wrapperHl:"<h3/>",menuTmpl:'<fieldset class="fi_rdo req"><h4>{legend}</h4><ul><li items/></ul></fieldset>',menuItem:'<li class="{value}"><input type="radio" name="{tagname}" value="{value}" id="{id}" /><label for="{id}">{label}</label></li>',emptyLabel:"- - -",currentClass:"current",lastMenuClass:"activemenu",i18n:{is:{unavail:"(Samsetning ekki til)"},en:{unavail:"(Combination unavailable)"}},disabledClass:"disabled",autoSelect:"aggressive",priceElm:function(e){return e.closest("form").parent().find(".price")},defaultPrice:function(e){return e.find("b")[0].firstChild.nodeValue},updatePrice:function(e,a,t){var i=e.data("prototype");if(i||(i=e.children("del").addBack().last().contents().detach(),i.filter("b").contents().eq(0).replaceWith('<span class="price__value"/>'),e.data("prototype",i)),e.empty(),t){i.clone().appendTo(e).last().after(" ").end().wrap("<del/>"),e.find("del .price__value").replaceWith(a),i.clone().appendTo(e).wrap("<ins/>"),e.find("ins .price__value").replaceWith(t);var n=e.attr("data-offerlabel");n&&e.find("ins strong").text(n)}else i.clone().appendTo(e),e.find(".price__value").replaceWith(a)},unknownPrice:"--"},n);var r=[];return this.each(function(){var l,s,c,d=e(this),u=d.find("select"),o=d.find("label").contents(),p=(new Date).getTime(),f=n.i18n[d.closest("[lang]").attr("lang")]||n.i18n.en,v=e('<input type="hidden" />').attr({name:u[0].name}),g=n.imgCont&&e.fn.variationsImages?e(n.imgCont).variationsImages(n.variationsImages):null,m=(u.attr("data-tagnames")||"").split("|"),h=(u.attr("data-taglabels")||"").split("|"),b=m.length,C=new RegExp("\\s*"+(u.attr("data-tagjoint")||n.tagJoint)+"\\s*"),w=[],y=e.map(m,function(e,a){return{name:m[a],legend:h[a],vals:{},tagData:{}}}),k=new Array(b);if(u.is("[data-hasprice]")&&(s=e(n.priceElm.apply?n.priceElm(d):n.priceElm),c=n.defaultPrice(s)),n.autoSelect&&u.children().filter(function(){return!e(this).attr("value")}).remove(),u.children().each(function(){var a=e(this),t=a.attr("value");if(t){var i=a.attr("data-tags").split("|"),r=a.attr("data-tagdata"),c=a.is(":selected"),d=[],u=a.text();if(s){var o=/\s+\(([^\(\)]+?)\)\s*$/,p=u.match(o);if(p){u=u.replace(o,"");var f=document.createTextNode(p[1]),v=a.attr("data-beforeprice");d.price=v||f,d.priceOffer=v?f:""}}u=u.split(C),r=r?r.split("|"):[],d.id=t;for(var g=0;b>g;g++){var m=i[g]||"";d.push(m),y[g].vals[m]=u[g]||n.emptyLabel,y[g].tagData[m]=r[g],c&&(k[g]=m)}c&&(l=d),w.push(d)}}),1===w.length&&!(w[0]||[]).join(""))return void v.val(w[0].id).replaceAll(d);var T=e.map(y,function(r,d){var u=e(n.menuTmpl.replace(/\{legend\}/g,r.legend)).addClass(r.name),o=0,m=e.map(r.vals,function(a,t){var i=n.menuItem.replace(/\{id\}/g,r.name+p+"-"+o++).replace(/\{tagname\}/g,r.name+p).replace(/\{label\}/g,a).replace(/\{value\}/g,t),l=e(i).data("varValue",t);return n.itemBuilder&&(l=n.itemBuilder(l,r.name,r.tagData[t],t,a)||l),l[0].orgTitle=a,l[0]});return m=e(m),m.on("click.variationmenu",function(u,o){var p=e(this),m=p.data("varValue")!==k[d];if(e(u.target).closest("[href]",p)[0]&&u.preventDefault(),o||(p.data("varDisabled")&&(k=new Array(b)),k[d]=p.data("varValue"),l=a(d,w,k),l||"aggressive"!==n.autoSelect||(l=a(d,w,k,!0),k=[].concat(l))),s){var h=l?l.price||c:n.unknownPrice,C=l&&l.priceOffer;n.updatePrice(s,h,C)}if(m||o){var y=t(w,k);i(T,d,y,k,n,f),p.trigger("variationchanged",[l,r.name,k[d]]),v.val(l?l.id:"").trigger("change"),g&&g.trigger("variationchanged",[l&&l.id])}}),u.data("varMenuItems",m).find("[items]").replaceWith(m),u.toArray()}),_=e(n.wrapper);r.push(_[0]),_.find("[headline]").replaceWith(e(n.wrapperHl).append(o)).end().find("[menus]").replaceWith(T).end().replaceAll(d),v.insertAfter(_),e(T[0]).data("varMenuItems").filter(function(){return e(this).data("varValue")===k[0]}).triggerHandler("click.variationmenu",[!0]),m=h=C=y=d=u=o=p=_=void 0}),this.pushStack(r)}}(jQuery);

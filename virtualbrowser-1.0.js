// encoding: utf-8
(function(b,r){b.fn.detach=b.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var j='virtualBrowser',l='VBbeforeload',m='VBload',n={'load':function(i){var e=typeof i!='string'?b(i):r,c=b(this),d=c.data(j).cfg,g=jQuery.Event(l),o=d.loadmsgMode,h={elm:e};h.url=e?(e.attr('href')||e.attr('action')||''):i;if(h.url){c.trigger(g,h);g.passThrough&&g.preventDefault();if(!g.isDefaultPrevented()){if(o&&o!='none'){d.loadmsgMode=='replace'&&c.empty();c.append(d.loadmsgElm)}var k=d.params,p;if(e&&e.is('form')){k=e.serialize()+'&'+k;p=e.attr('method')||'GET'}b.ajax({url:h.url,data:k,type:p,complete:function(a){h.result=a.responseText;var f=jQuery.Event(m);c.trigger(f,h);if(!f.isDefaultPrevented()){d.loadmsgElm.detach();c.empty().append(h.resultDOM||b(h.result)).find('form').data(j+'Elm',c).bind('submit',q)}}})}}return g}},q=function(a){var f=b(a.target).closest('[href], form')[0];if(f){var i=b(this).data(j+'Elm')||this;bfldEv=n['load'].call(i,f);bfldEv.isPropagationStopped()&&a.stopPropagation();!bfldEv.passThrough&&a.preventDefault()}};fnVB=b.fn[j]=function(a,f){var i=typeof a=='string';if(i){var e=n[a];e&&this.each(function(){e.apply(this,[].concat(f))})}else{a=b.extend({loadmsgMode:'none'},a||{});f&&(a.url=f);var c=b(this),d=a.loadmsgElm||'<div class="loading" />',g=(fnVB.i18n[c.closest('[lang]').attr('lang')]||{}).loading||fnVB.i18n.en.loading;if(d.charAt){d=d.replace(/%\{msg\}/g,g)}d=a.loadmsgElm=b(d);if(!d.text()){d.append(g)}c.data(j,{cfg:a}).bind('click',q);a.onLoad&&c.bind(m,a.onLoad);a.onBeforeload&&c.bind(l,a.onBeforeload);a.params=typeof a.params=='string'?a.params:b.param(a.params||{});a.url&&c[j]('load',a.url)}return this};fnVB.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

// encoding: utf-8
(function(c,t){c.fn.detach=c.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var h='virtualBrowser',n='VBbeforeload',o='VBload',p={'load':function(e){var b=typeof e!='string'?c(e):t,d=c(this),i=d.data(h).cfg,j=jQuery.Event(n),q=i.loadmsgMode,f={elm:b};f.url=b?(b.attr('href')||b.attr('action')||''):e;if(f.url){d.trigger(j,f);j.passThrough&&j.preventDefault();if(!j.isDefaultPrevented()){if(q&&q!='none'){i.loadmsgMode=='replace'&&d.empty();d.append(i.loadmsgElm)}var m=i.params,r;if(b&&b.is('form')){m=b.serialize()+'&'+m;r=b.attr('method')||'GET'}c.ajax({url:f.url,data:m,type:r,complete:function(a){var g=f.url.replace(/^((https?|file):/var l=a.responseText.replace(/(<[^>]+ href=["'])([^"'\/])/g,'');f.result=a.responseText;var k=jQuery.Event(o);d.trigger(k,f);if(!k.isDefaultPrevented()){i.loadmsgElm.detach();d.empty().append(f.resultDOM||c(f.result.replace(/<script( |>)[\s\S]*?<\/script>/ig,''))).find('form').data(h+'Elm',d).bind('submit',s)}}})}}return j}},s=function(a){var g=a.type=='submit'?a.target:c(a.target).closest('[href]')[0];if(g){var l=c(this).data(h+'Elm')||this;bfloadEv=p['load'].call(l,g);bfloadEv.isPropagationStopped()&&a.stopPropagation();!bfloadEv.passThrough&&a.preventDefault()}};fnVB=c.fn[h]=function(a,g){var l=typeof a=='string';if(l){var k=p[a];k&&this.each(function(){k.apply(this,[].concat(g))})}else{a=c.extend({loadmsgMode:'none'},a||{});g&&(a.url=g);var e=c(this),b=a.loadmsgElm||'<div class="loading" />',d=(fnVB.i18n[e.closest('[lang]').attr('lang')]||{}).loading||fnVB.i18n.en.loading;if(b.charAt){b=b.replace(/%\{msg\}/g,d)}b=a.loadmsgElm=c(b);if(!b.text()){b.append(d)}e.data(h,{cfg:a}).bind('click',s);a.onLoad&&e.bind(o,a.onLoad);a.onBeforeload&&e.bind(n,a.onBeforeload);a.params=typeof a.params=='string'?a.params:c.param(a.params||{});a.url&&e[h]('load',a.url)}return this};fnVB.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

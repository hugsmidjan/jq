// encoding: utf-8
(function(d,s){d.fn.detach=d.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var h='virtualBrowser',m='VBbeforeload',n='VBload',o={'load':function(i){var c=typeof i!='string'?d(i):s,b=d(this),f=b.data(h).cfg,k=jQuery.Event(m),p=f.loadmsgMode,e={elm:c};e.url=c?(c.attr('href')||c.attr('action')||''):i;if(e.url){b.trigger(k,e);k.passThrough&&k.preventDefault();if(!k.isDefaultPrevented()){if(p&&p!='none'){f.loadmsgMode=='replace'&&b.empty();b.append(f.loadmsgElm)}var l=f.params,q;if(c&&c.is('form')){l=c.serialize()+'&'+l;q=c.attr('method')||'GET'}d.ajax({url:e.url,data:l,type:q,complete:function(a){var g=e.url.replace(/^((https?|file):\/\/\/?)?[^\/]*/,'').replace(/(.*\/).*/,'$1').split(/[?#]/)[0];e.result=a.responseText.replace(/http:\/\//gi,'^').replace(/https:\/\//gi,'`').replace(/(<[^>]+ (href|src)=["'])([^\/`\^])/gi,'$1'+g+'$3').replace(/\^/g,'http://').replace(/`/g,'https://');var j=jQuery.Event(n);b.trigger(j,e);if(!j.isDefaultPrevented()){f.loadmsgElm.detach();b.empty().append(e.resultDOM||d(e.result.replace(/<script[ >][\s\S]*?<\/script>/gi,''))).find('form').data(h+'Elm',b).bind('submit',r)}}})}}return k}},r=function(a){var g=a.type=='submit'?a.target:d(a.target).closest('[href]')[0];if(g){var j=d(this).data(h+'Elm')||this;bfloadEv=o['load'].call(j,g);bfloadEv.isPropagationStopped()&&a.stopPropagation();!bfloadEv.passThrough&&a.preventDefault()}};fnVB=d.fn[h]=function(a,g){var j=typeof a=='string';if(j){var i=o[a];i&&this.each(function(){i.apply(this,[].concat(g))})}else{a=d.extend({loadmsgMode:'none'},a||{});g&&(a.url=g);var c=d(this),b=a.loadmsgElm||'<div class="loading" />',f=(fnVB.i18n[c.closest('[lang]').attr('lang')]||{}).loading||fnVB.i18n.en.loading;if(b.charAt){b=b.replace(/%\{msg\}/g,f)}b=a.loadmsgElm=d(b);if(!b.text()){b.append(f)}c.data(h,{cfg:a}).bind('click',r);a.onLoad&&c.bind(n,a.onLoad);a.onBeforeload&&c.bind(m,a.onBeforeload);a.params=typeof a.params=='string'?a.params:d.param(a.params||{});a.url&&c[h]('load',a.url)}return this};fnVB.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

// encoding: utf-8
// $.fn.virtualBrowser 1.0  -- (c) 2009 Hugsmiðjan ehf. 
(function(c,p){c.fn.detach=c.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var x=document.location,t='isDefaultPrevented',q='stopPropagation',n='passThrough',l='virtualBrowser',y='VBbeforeload',z='VBload',A='VBloaded',e='replace',B=/^(https?:)?\/\//,C={'load':function(d){var g=typeof d!='string'?c(d):p,k=c(this),m=k.data(l).cfg,i=c.Event(y),r,u,D=m.loadmsgMode,h={elm:g};if(g){d=g.attr('href');d=d===p?g.attr('action'):d}d=h.url=d===''?x.href:d;if(d){i[q]();k.trigger(i,h);if(!i[n]&&((i[n]===p&&g&&g[0].target&&g[0].target!=window.name)||(/^([a-z]{3,12}:|\/\/)/i.test(d)&&!d.toLowerCase()[e](B,'').indexOf(x.href.toLowerCase()[e](B,'').split('/')[0])==0))){i[n]=true}i[n]&&i.preventDefault();if(!i[t]()){var v=m.params,E=h.noCache,F;if(g&&g.is('form')){v=g.serialize()+'&'+v;F=g.attr('method')||'GET'}c.ajax({url:h.url.split('#')[0],data:v,type:F,cache:E!==p?E:!m.noCache,complete:function(a){var f=h.url.split('#')[0],o=f[e](/([^?]*\/)?(.*)/,'$2'),s=f.split('?')[0][e](/(.*\/)?.*/,'$1'),j=/\?/.test(f),b=a.responseText;j&&(b=b[e](/(['"])\?/gi,'$1¨<<`>>'));b=b[e](/(<[^>]+ (href|src|action)=["'])(["'#¨])/gi,'$1'+o+'$3');j&&(b=b[e](/(['"])¨<<`>>/gi,'$1?')[e](/¨<<`>>/gi,'&amp;'));b=b[e](/http:\/\//gi,'^<<`>>')[e](/https:\/\//gi,'`<<`>>')[e](/(<[^>]+ (href|src|action)=["'])([^\/`\^])/gi,'$1'+s+'$3')[e](/\^<<`>>/g,'http://')[e](/\^<<`>>/g,'http://')[e](/`<<`>>/g,'https://');h.result=b;r=c.Event(z);r[q]();k.trigger(r,h);if(!r[t]()){u=c.Event(A);u[q]();m.loadmsgElm.detach();k.empty().append(h.resultDOM||c.getResultBody(h.result)[0].childNodes).trigger(u,{url:h.url,elm:h.elm}).bind('click',H).find('form').data(l+'Elm',k).bind('submit',G)}}});if(D&&D!='none'){m.loadmsgMode=='replace'&&k.empty();k.append(m.loadmsgElm)}}}return i}},H=function(a){var f=c(a.target).closest('[href]');if(f[0]){a.VBbody=this;G.call(f,a)}},G=function(a){if(!a[t]()){var f=this,o=a.VBbody||c(f).data(l+'Elm')||this;bfloadEv=C['load'].call(o,f);bfloadEv.isPropagationStopped()&&a[q]();!bfloadEv[n]&&a.preventDefault()}},w=c.fn[l]=function(a,f){var o=typeof a=='string';if(o){var s=C[a];s&&this.each(function(){s.apply(this,[].concat(f))})}else{a=c.extend({loadmsgMode:'none'},a||{});f&&(a.url=f);var j=this,b=a.loadmsgElm||'<div class="loading" />',d=(w.i18n[j.closest('*[lang]').attr('lang')]||{}).loading||w.i18n.en.loading;if(b.charAt){b=b.replace(/%\{msg\}/g,d)}b=a.loadmsgElm=c(b);if(!b.text()){b.append(d)}j.data(l,{cfg:a});a.onLoad&&j.bind(z,a.onLoad);a.onLoaded&&j.bind(A,a.onLoaded);a.onBeforeload&&j.bind(y,a.onBeforeload);a.params=typeof a.params=='string'?a.params:c.param(a.params||{});a.url&&j[l]('load',a.url)}return this};w.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

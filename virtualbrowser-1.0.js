// encoding: utf-8
(function(b,r){b.fn.detach=b.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var i='virtualBrowser',m='VBbeforeload',n='VBload',o={'load':function(h){var e=typeof h!='string'?b(h):r,c=b(this),d=c.data(i).cfg,j=jQuery.Event(m),p=d.loadmsgMode,f={elm:e};f.url=e?(e.attr('href')||e.attr('action')||''):h;if(f.url){c.trigger(j,f);if(!j.isDefaultPrevented()){if(p&&p!='none'){d.loadmsgMode=='replace'&&c.empty();c.append(d.loadmsgElm)}var k=d.params,l;if(e&&e.is('form')){k=e.serialize()+'&'+k;l=e.attr('method')||'GET'}window.console&&console.log((l||'Load')+'ing: '+f.url+(k?'?'+k:''));b.ajax({url:f.url,data:k,type:l,complete:function(a){f.result=a;var g=jQuery.Event(n);c.trigger(g,f);if(!g.isDefaultPrevented()){d.loadmsgElm.detach();c.empty().append(f.resultDOM||b(f.result)).find('form').data(i+'Elm',c).bind('submit',q)}}})}}return j}},q=function(a){var g=b(a.target).closest('[href], form')[0];if(g){var h=b(this).data(i+'Elm')||this;bfldEv=o['load'].call(h,g);bfldEv.isPropagationStopped()&&a.stopPropagation();!bfldEv.passThrough&&a.preventDefault()}};fnVB=b.fn[i]=function(a,g){var h=typeof a=='string';if(h){var e=o[a];e&&this.each(function(){e.apply(this,[].concat(g))})}else{a=b.extend({loadmsgMode:'none'},a||{});g&&(a.url=g);var c=b(this),d=a.loadmsgElm||'<div class="loading" />',j=(fnVB.i18n[c.closest('[lang]').attr('lang')]||{}).loading||fnVB.i18n.en.loading;if(d.charAt){d=d.replace(/%\{msg\}/g,j)}d=a.loadmsgElm=b(d);if(!d.text()){d.append(j)}c.data(i,{cfg:a}).bind('click',q);a.onLoad&&c.bind(n,a.onLoad);a.onBeforeload&&c.bind(m,a.onBeforeload);a.params=typeof a.params=='string'?a.params:b.param(a.params||{});a.url&&c[i]('load',a.url)}return this};fnVB.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

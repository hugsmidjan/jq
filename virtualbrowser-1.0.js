// encoding: utf-8
(function(b,r){b.fn.detach=b.fn.detach||function(){return this.each(function(){var a=this.parentNode;a&&a.nodeType==1&&a.removeChild(this)})};var i='virtualBrowser',l='VBbeforeload',m='VBload',n={'load':function(h){var e=typeof h!='string'?b(h):r,c=b(this),d=c.data(i).cfg,j=jQuery.Event(l),o=d.loadmsgMode,g={elm:e};g.url=e?(e.attr('href')||e.attr('action')||''):h;if(g.url){c.trigger(j,g);if(!j.isDefaultPrevented()){if(o&&o!='none'){d.loadmsgMode=='replace'&&c.empty();c.append(d.loadmsgElm)}var k=d.params,p;if(e&&e.is('form')){k=e.serialize()+'&'+k;p=e.attr('method')||'GET'}b.ajax({url:g.url,data:k,type:p,complete:function(a){g.result=a;var f=jQuery.Event(m);c.trigger(f,g);if(!f.isDefaultPrevented()){d.loadmsgElm.detach();c.empty().append(g.resultDOM||b(g.result)).find('form').data(i+'Elm',c).bind('submit',q)}}})}}return j}},q=function(a){var f=b(a.target).closest('[href], form')[0];if(f){var h=b(this).data(i+'Elm')||this;bfldEv=n['load'].call(h,f);bfldEv.isPropagationStopped()&&a.stopPropagation();!bfldEv.passThrough&&a.preventDefault()}};fnVB=b.fn[i]=function(a,f){var h=typeof a=='string';if(h){var e=n[a];e&&this.each(function(){e.apply(this,[].concat(f))})}else{a=b.extend({loadmsgMode:'none'},a||{});f&&(a.url=f);var c=b(this),d=a.loadmsgElm||'<div class="loading" />',j=(fnVB.i18n[c.closest('[lang]').attr('lang')]||{}).loading||fnVB.i18n.en.loading;if(d.charAt){d=d.replace(/%\{msg\}/g,j)}d=a.loadmsgElm=b(d);if(!d.text()){d.append(j)}c.data(i,{cfg:a}).bind('click',q);a.onLoad&&c.bind(m,a.onLoad);a.onBeforeload&&c.bind(l,a.onBeforeload);a.params=typeof a.params=='string'?a.params:b.param(a.params||{});a.url&&c[i]('load',a.url)}return this};fnVB.i18n={en:{loading:'Loading...'},is:{loading:'Sæki gögn...'}}})(jQuery);

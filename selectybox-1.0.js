/* Selectybox 1.0  -- (c) 2012-2014 Hugsmiðjan ehf. - MIT/GPL   @preserve */
!function(){"use strict";var e,t=window,n=!!t.addEventListener,r=function(e,t){var r="add"===t,s=n?(r?"add":"remove")+"EventListener":(r?"at":"de")+"tachEvent",o=n?"":"on",i=e.select;i[s](o+"change",e._$refresh),i[s](o+"keyup",e._$refresh),i[s](o+"focus",e._$focus),i[s](o+"blur",e._$blur)},s=function(e,t,n){for(var r in t)e.style[r]=n?"":t[r]},o="templ getButton focusClass emptyVal text selectCSS".split(" "),i="_$refresh _$focus _$blur select container button".split(" "),c=function(t,n){var i=c.getWidget(t),l=i||this;if(!(l instanceof c))return new c(t,n);if(i&&i.destroy(),n){for(var a,u=0;a=o[u++];)n[a]&&(l[a]=n[a]);n=null}e=e||document.createElement("div"),e.innerHTML=l.templ.replace(/^[^<]+/,"");var f=l.container=e.firstChild;f.style.position="relative",l.button=l.getButton(),l.select=t,t.parentNode.insertBefore(f,t),f.insertBefore(t,l.button.nextSibling),t.style.opacity=1e-4,s(t,l.selectCSS),l._$refresh=function(){setTimeout(function(){l.refresh()},0)};var d;return l._$blur=function(){d=d||new RegExp("(?:^| )"+l.focusClass+"( |$)"),f.className=f.className.replace(d,"$1")},l._$focus=function(){f.className+=" "+l.focusClass},r(l,"add"),l.refresh(),t.$selectybox=l,i?l:void 0};c.prototype={templ:'<span class="selecty"><span class="selecty-button"/></span>',getButton:function(){return this.container.firstChild},focusClass:"focused",emptyVal:"     ",text:function(e){return e},selectCSS:{position:"absolute",bottom:0,left:0,width:"100%",height:"100%",top:"auto",right:"auto",margin:0,padding:0,border:0},refresh:function(){var e=this,t=e.select;e.button.innerHTML=e.text(t.options[t.selectedIndex].text.replace(/</g,"&lt;"))||e.emptyVal},val:function(e){var t,n=this,r=0;for(e+="";t=n.select.options[r++];)if(t.value===e){t.selected=!0;break}n.refresh()},destroy:function(){var e=this,t=e.select,n=e.container,c=n.parentNode;c.insertBefore(t,n),c.removeChild(n),r(e,"remove"),t.style.opacity="",s(t,e.selectCSS,!0),t.$selectybox="";for(var l=o.concat(i),a=l.length;a--;)delete e[l[a]]}},c.jQueryPlugin=function(e){e.fn.selectybox=function(t,n){var r=this;if(/^(?:refresh|val|destroy|widget)$/.test(t))r.each(function(){var e=c.getWidget(this);if(e){if("widget"===t)return e;e[t](n)}});else if("string"!=typeof t)return t=t||{},t.text=t.text||function(t){return e(this.container).toggleClass("selecty-empty",!e(this.select).val()),t},r.pushStack(r.filter("select").map(function(e,n){return c(n,t).container}));return r}},c.getWidget=function(e){return e.$selectybox},"object"==typeof module&&module.exports?module.exports=c:(t.Selectybox=c,t.jQuery&&c.jQueryPlugin(t.jQuery))}();
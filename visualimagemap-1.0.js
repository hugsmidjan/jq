// encoding: utf-8
// $.fn.visualImageMap 1.0  -- (c) 2010 Hugsmi√∞jan ehf.
(function(b,m,r){b.fn[m]=function(d){d=b.extend({overlay:'<div class="imgoverlay" />',area:'<a class="area"/>'},d);this.each(function(){var a=b(this),i=(a.attr('usemap')||'').substr(1),f=i?b('map[name="'+i+'"]').detach():a.data('usemapElm')||[];if(f[0]){b(a.data('usemapoverlay')||[]).remove();a.removeAttr('usemap').data('usemapElm',f).one('load',function(s){var n=parseInt(a.attr('width'),10)||a.clone().appendTo('body').width(),o=parseInt(a.attr('height'),10)||a.clone().appendTo('body').height(),j=a.width()/n,k=a.height()/o,e,p=b(d.area),g=b(d.overlay).insertAfter(a).css({position:'absolute',top:a.position().top+parseFloat(a.css('padding-top'))+parseFloat(a.css('border-top-width')),left:a.position().left+parseFloat(a.css('padding-left'))+parseFloat(a.css('border-left-width'))});a.data('usemapoverlay',g);f.find('area').each(function(t){var h=b(this),l=h.attr('title'),c=b.map(h.attr('coords').split(','),function(q,u){return parseInt(q,10)});areaElm=p.clone(true);if(!e){areaElm.prependTo(g);e=[parseInt(areaElm.css('margin-left'),10)||0,parseInt(areaElm.css('margin-top'),10)||0]}areaElm.text(l).attr({href:h.attr('href'),title:l}).css({position:'absolute',left:c[0]*j+e[0],top:c[1]*k+e[1],width:(c[2]-c[0])*j,height:(c[3]-c[1])*k}).prependTo(g)})});if(a[0].width){a.trigger('load')}}});return this}})(jQuery,'visualImageMap');

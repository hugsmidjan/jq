(function(f){f.listscroller={version:1.0,defaultConfig:{item:'',windowSize:3,stepSize:1,startPos:0,hideClass:'overflow',topClass:'at-top',bottomClass:'at-bottom',wrap:'both',overflow:'hidden',controls:'below',animation:'none',easing:'swing',speed:600,aspect:'auto',paging:false,inputPager:false,initCallback:function(){},moveCallback:function(){},classPrefix:'listscroller',currentPageClass:'current',currentItemClass:'visible',cursorItemClass:'current',pagingTopClass:'paging-top',pagingBottomClass:'paging-bottom',pagingTemplate:'<div class="paging"><ul class="stepper"></ul></div>',nextBtnTemplate:'<li class="next"><a href="#"></a></li>',prevBtnTemplate:'<li class="prev"><a href="#"></a></li>',jumpTemplate:'<li class="jump"></li>',jumpLabelTemplate:'<strong></strong>',jumpWrapTemplate:'<span></span>',jumpBtnTemplate:'<a href="#"></a>',totalTemplate:'<b></b>',pagerTemplate:'<input type="text" value="" size="2" />',statusLabel:'Viewing results:',jumpLabel:'Pages:',labelNext:'Next',labelPrev:'Previous',titleNext:'Page forward',titlePrev:'Page back'},i18n:function(a,b){return a},animate:{none:function(a,b){},carousel:function(a,b){var c,e=f('.'+b.classPrefix+'-wrapper',this),d=a.eq(a.length-1),g=a.length-b.stepSize,h=(b.aspect==='horizontal')?'scrollLeft':'scrollTop',j=(b.aspect==='horizontal')?'outerWidth':'outerHeight',i={};e.stop();c=a.eq(b.index).position();i[h]=c.left;if(b.wrap=='loop'&&b.lastIndex==0&&b.index==g){e[h](d.position().left+d[j]());e.animate(i,b.speed,b.easing)}else if(b.wrap=='loop'&&b.lastIndex==g&&b.index==0){i[h]=d.position().left+d[j]();e.animate(i,b.speed,b.easing,function(){e[h](0)})}else{e.animate(i,b.speed,b.easing)}},crossfade:function(e,d){e.each(function(a,b,c){b=(a>=d.index&&a<d.index+d.windowSize);c=(d.lastIndex==null)||(a>=d.lastIndex&&a<d.lastIndex+d.windowSize);if(b&&!c){f(this).stop().hide().fadeIn(d.speed)}else if(!b&&d.lastIndex==null){f(this).stop().hide()}else if(!b&&c){f(this).stop().show().fadeOut(d.speed)}})},accordion:function(e,d){var g,h=(d.aspect=='vertical')?'height':'width';e.each(function(a,b,c){b=(a>=d.index&&a<d.index+d.windowSize);c=(d.lastIndex==null)||(a>=d.lastIndex&&a<d.lastIndex+d.windowSize);g={};if(b&&!c){g[h]='show';f(this).stop().animate(g,d.speed,d.easing,function(){this.style[h]=''})}else if(!b&&d.lastIndex==null){f(this).stop().hide()}else if(!b&&c){g[h]='hide';f(this).stop().animate(g,d.speed,d.easing,function(){this.style[h]=''})}})}},wrap:{none:function(a,b,c){return Math.max(Math.min(a,l(b,c)),0)},start:function(a,b,c){var e=l(b,c);if(a<0)return(c.index==0)?e:0;if(a>e)return e;return a},end:function(a,b,c){var e=l(b,c);if(a<0)return 0;if(a>e)return(c.index==e)?0:e;return a},both:function(a,b,c){var e=l(b,c);if(a<0)return(c.index==0)?e:0;if(a>e)return(c.index==e)?0:e;return a},random:function(a,b,c){return Math.floor(Math.random()*b.length)},loop:function(a,b,c){return((b.length+a)%b.length)}},aspectDefaults:{none:'vertical',carousel:'horizontal',crossfade:'horizontal',accordion:'vertical'}};function r(a){var b,c=a.eq(1);p1=a.eq(0).offset(),p2=c.offset();if(p2&&c.is(':visible')){return(Math.abs(p2.top-p1.top)<=Math.abs(p2.left-p1.left))?'horizontal':'vertical'}return false}function l(a,b){return(b.overflow=='visible')?Math.floor(a.length/b.stepSize)*b.stepSize:a.length-b.windowSize}function k(a,b,c){var e=a.block;var d=a.list;a.lastIndex=a.index;a.index=f.listscroller.wrap[a.wrap||'none'](b,d,a);d.addClass(a.hideClass).removeClass(a.cursorItemClass).removeClass(a.currentItemClass).slice(a.index,a.index+a.windowSize).addClass(a.currentItemClass).removeClass(a.hideClass).eq(0).addClass(a.cursorItemClass);if(f.isFunction(a.moveCallback))a.moveCallback.call(e,d,a);if(f.isFunction(a.animation))a.animation.call(e,d,a)else f.listscroller.animate[a.animation||'none'].call(e,d,a);e.removeClass(a.topClass).removeClass(a.bottomClass);if(a.index==0)e.addClass(a.topClass);if(a.index==d.length-a.windowSize)e.addClass(a.bottomClass);if(!c){e.addClass(a.classPrefix+'-changed');setTimeout(function(){e.removeClass(a.classPrefix+'-changed')},a.speed||1)}if(a.jumps){a.jumps.removeClass(a.currentPageClass).eq(Math.ceil(a.index/a.stepSize)).addClass(a.currentPageClass)}else if(a.pager){a.pager.val(Math.ceil(a.index/a.stepSize)+1)}}function s(a){var b=a.data;k(b,b.index-b.stepSize);return false}function t(a){var b=a.data;k(b,b.index+b.stepSize);return false}function u(a){var b=a.data,c=(parseInt(f(this).text(),10)-1)||0;k(b,c*b.stepSize);return false}function v(a){var b=a.data,c=(parseInt(f(this).val(),10)-1)||0;k(b,c*b.stepSize);return false}function n(b,c){var e=f(b.nextBtnTemplate);var d=f(b.prevBtnTemplate);var g=f([]);var h=f.listscroller.i18n;e.find('a').andSelf().eq(0).bind('click',b,t).attr('title',h(b.titleNext,c)).text(h(b.labelNext,c))d.find('a').andSelf().eq(0).bind('click',b,s).attr('title',h(b.titlePrev,c)).text(h(b.labelPrev,c))if(b.paging){var j=[]page=Math.ceil(b.index/b.stepSize),i=Math.ceil(b.list.length/b.stepSize);g=f(b.jumpTemplate);if(b.jumpLabelTemplate){f(b.jumpLabelTemplate).text(h(b.jumpLabel,c)).appendTo(g)}if(b.inputPager){b.pager=f(b.pagerTemplate).appendTo(g);var w=f(b.totalTemplate).appendTo(g);b.pager.bind('change',b,v).val(page+1);w.text(i)}else{for(var m=0;m<i;m++){var x=f(b.jumpBtnTemplate);var o=x.find('a').andSelf().eq(0).text(m+1).bind('click',b,u);if(b.index==m)o.addClass(b.currentPageClass);j.push(o[0])}b.jumps=f(j);f(b.jumpWrapTemplate||[]).append(b.jumps).appendTo(g)}}var p=f(b.pagingTemplate);p.map(function(){var a=this;while(a.firstChild)a=a.firstChild;return a}).append(e,d,g);return p}function q(a,b,c){if(b.hasClass(a.classPrefix+'-active'))return false;a.list=c;a.block=b;var e,d,g;if(c.eq(0).is('li'))d=c.parent();else d=c.wrapAll('<div />').parent();g=d.wrap('<div />').parent();d.addClass(a.classPrefix+'-clip');g.addClass(a.classPrefix+'-wrapper')b.addClass(a.classPrefix+'-active');d.add(g).css('position','relative');g.addClass(a.classPrefix+'-'+a.aspect);if(a.wrap=='loop'){a.flipover=c.slice(0,a.windowSize).clone(true);c.parent().append(a.flipover)}if(a.controls!=='none'&&c.length>0){var h=c.parents('[lang]').attr('lang')||'en';if(/^(above|both)$/.test(a.controls))g.before(n(a,h).addClass(a.pagingTopClass));if(/^(below|both)$/.test(a.controls))g.after(n(a,h).addClass(a.pagingBottomClass))}if(a.aspect=='auto'){a.aspect=r(c)||f.listscroller.aspectDefaults[a.animation]||'horizontal'}g.addClass(a.classPrefix+'-'+a.aspect);k(a,a.startPos||0,true)}f.fn.listscroller=function(c){var e=f.listscroller.defaultConfig;if((c&&c.item)||e.item){this.each(function(){var a=f.extend({},e,c),b=f(this);q(a,b,b.find(a.item))})}else if(this.length){q(f.extend({},e,c),this.eq(0).parent(),this)}return this}})(jQuery);
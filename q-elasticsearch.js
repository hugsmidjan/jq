/* jQuery.fn.elsearch v 1.0  -- (c) 2016 Hugsmiðjan ehf.  @preserve */
!function(e){let t,s,a,r,n,i;e.search={defaultConfig:{apiKey:"api-unset",url:"https://search-api.hugsmidjan.is/v1/search",pageSize:10,paginator:!0,minCharacters:2,maxCharacters:100,pages:!0},i18n:{en:{minCharactersError:"Minimum ${minChar} characters in search term",noResultsText:"No results for <strong>${text}</strong>",singleResultText:"${hits} result for <strong>${text}</strong>",multipleResultsText:"${hits} results for <strong>${text}</strong>",loadMoreText:"Load more",pagingTitle:"Pages: ",searchPending:"Searching..."},is:{minCharactersError:"Minnst ${minChar} stafir í leitarstreng",noResultsText:"Engar niðurstöður fyrir <strong>${text}</strong>",singleResultText:"${hits} niðurstaða fyrir <strong>${text}</strong>",multipleResultsText:"${hits} niðurstöður fyrir <strong>${text}</strong>",loadMoreText:"Fleiri niðurstöður",pagingTitle:"Síður: ",searchPending:"Leit í gangi..."}}};let l=0,o="",c="";const p=()=>{r.empty(),n.empty().removeClass("searchresults__paging--active")},g=(e,t,s,i)=>{if(""===s)a.html("");else if(s.length<=i.minCharacters)a.html(i.minCharactersError.replace("${minChar}",i.minCharacters));else if(0===e)a.html(i.noResultsText.replace("${text}",s));else{"1"===(""+e).substr(-1)?a.html(i.singleResultText.replace("${hits}",e).replace("${text}",s)):a.html(i.multipleResultsText.replace("${hits}",e).replace("${text}",s));for(let e=0;e<t.length;e++){const s=t[e];r.append(`<li>\n\t\t\t\t\t\t<a class="title" href="${s.url}">${s.title}</a>\n\t\t\t\t\t\t<div class="snippets">${s.snippets?s.snippets.join(" ... "):""}</div>\n\t\t\t\t\t</li>`)}e>i.pageSize&&((e,t)=>{const s=Math.ceil(e/t.pageSize);if(t.pages){n.append(`<span class="searchresults__paging__title">${t.pagingTitle}</span>`).addClass("searchresults__paging--active");for(let e=0;e<s&&(n.append(`<button class="searchresults__paging__button ${e===l?"current":""}" type="button" data-page="${e}" title="Síða: ${e+1}">${e+1}</button>`),9!==e);e++);a.append(` <span>(Síða ${l+1})</span>`)}else n.empty().removeClass("searchresults__paging--active"),l<s-1&&n.append(`<button class="searchresults__loadmore__button button" type="button" data-page="${l+1}" >${t.loadMoreText}</button>`).addClass("searchresults__paging--active")})(e,i)}},h=(s,a,r)=>{s===c&&a===l||(i&&4!==i.readyState&&i.abort(),(r.pages||s!==c)&&p(),t.addClass("searchform--searching"),l=a,i=e.ajax({url:r.url,type:"GET",dataType:"json",crossDomain:!0,beforeSend:e=>e.setRequestHeader("x-api-key",r.apiKey),data:{inflect:!0,q:s,page_size:r.pageSize,page_no:a}}).done(function(e){g(e.hits,e.results,s,r)}).always(function(){t.removeClass("searchform--searching")}))},u=t=>{l=0,a.html(t.searchPending),o.length>t.minCharacters?(o.length>t.maxCharacters&&(o=e.trim(e.cropText(o,t.maxCharacters," "))),h(o,0,t)):(p(),g(0,[],o,t)),c=o};e.fn.search=function(i){if(this.length){l=e(this),t=l,s=e('<div class="searchresults" />').appendTo(t),a=e('<h3 class="searchresults__title"></h3>').insertBefore(s),r=e('<ul class="searchresults__list"/>').appendTo(s),n=e('<div class="searchresults__paging"/>').appendTo(s);let c=e(this),p=e.search.defaultConfig,g=c.closest("[lang]").attr("lang")||"",d=e.extend(e.search.i18n,i.i18n),m=d[g.toLowerCase()]||d[g.substr(0,2)]||d.en;i=e.extend(p,m,i),(o=c.find(".searchform__field").val())&&u(i),e(".searchform__field").on("keyup",t=>{o=e(t.target).val().trim(),u(i)}),n.on("click","button",t=>{const s=e(t.target);h(o,parseInt(s.data("page"),10),i)})}var l}}(window.jQuery);

/* jQuery.fn.elasticSearch v 1.0  -- (c) 2020 Hugsmiðjan ehf.  @preserve */
!function(t){const e={inputSelector:'input[type="text"]',apiKey:"api-unset",url:"https://search-api.hugsmidjan.is/v1/search",pageSize:10,paginator:!0,minCharacters:2,maxCharacters:100,pages:!0,i18n:{en:{minCharactersError:"Minimum ${minChar} characters in search term",noResultsText:"No results for <strong>${text}</strong>",singleResultText:"${hits} result for <strong>${text}</strong>",multipleResultsText:"${hits} results for <strong>${text}</strong>",loadMoreText:"Load more",pagingTitle:"Pages: ",searchPending:"Searching..."},is:{minCharactersError:"Minnst ${minChar} stafir í leitarstreng",noResultsText:"Engar niðurstöður fyrir <strong>${text}</strong>",singleResultText:"${hits} niðurstaða fyrir <strong>${text}</strong>",multipleResultsText:"${hits} niðurstöður fyrir <strong>${text}</strong>",loadMoreText:"Fleiri niðurstöður",pagingTitle:"Síður: ",searchPending:"Leit í gangi..."}}};let s,a,r,n,i,l,o=0,c="",p="";const g=()=>{n.empty(),i.empty().removeClass("searchresults__paging--active")},u=(t,e,s,a)=>{if(""===s)r.html("");else if(s.length<=a.minCharacters)r.html(a.minCharactersError.replace("${minChar}",a.minCharacters));else if(0===t)r.html(a.noResultsText.replace("${text}",s));else{"1"===(""+t).substr(-1)?r.html(a.singleResultText.replace("${hits}",t).replace("${text}",s)):r.html(a.multipleResultsText.replace("${hits}",t).replace("${text}",s));for(let t=0;t<e.length;t++){const s=e[t];n.append(`<li>\n\t\t\t\t\t\t<a class="title" href="${s.url}">${s.title}</a>\n\t\t\t\t\t\t<div class="snippets">${s.snippets?s.snippets.join(" ... "):""}</div>\n\t\t\t\t\t</li>`)}t>a.pageSize&&((t,e)=>{const s=Math.ceil(t/e.pageSize);if(e.pages){i.append(`<span class="searchresults__paging__title">${e.pagingTitle}</span>`).addClass("searchresults__paging--active");for(let t=0;t<s&&(i.append(`<button class="searchresults__paging__button ${t===o?"current":""}" type="button" data-page="${t}" title="Síða: ${t+1}">${t+1}</button>`),9!==t);t++);r.append(` <span>(Síða ${o+1})</span>`)}else i.empty().removeClass("searchresults__paging--active"),o<s-1&&i.append(`<button class="searchresults__loadmore__button button" type="button" data-page="${o+1}" >${e.loadMoreText}</button>`).addClass("searchresults__paging--active")})(t,a)}},h=(e,a,r)=>{e===p&&a===o||(l&&4!==l.readyState&&l.abort(),(r.pages||e!==p)&&g(),s.addClass("searchform--searching"),o=a,l=t.ajax({url:r.url,type:"GET",dataType:"json",crossDomain:!0,beforeSend:t=>t.setRequestHeader("x-api-key",r.apiKey),data:{inflect:!0,q:e,page_size:r.pageSize,page_no:a}}).done(function(t){u(t.hits,t.results,e,r)}).always(function(){s.removeClass("searchform--searching")}))},d=e=>{o=0,r.html(e.searchPending),c.length>e.minCharacters?(c.length>e.maxCharacters&&(c=t.trim(t.cropText(c,e.maxCharacters," "))),h(c,0,e)):(g(),u(0,[],c,e)),p=c},m=e=>{s=e,a=t('<div class="searchresults" />').appendTo(s),r=t('<h3 class="searchresults__title"></h3>').insertBefore(a),n=t('<ul class="searchresults__list"/>').appendTo(a),(i=t('<div class="searchresults__paging"/>').appendTo(a)).on("click","button",e=>{const s=t(e.target);h(c,parseInt(s.data("page"),10),cfg)})};t.fn.elasticSearch=function(s){if(this.length){m(t(this));const a=t(this),r=a.closest("[lang]").attr("lang")||"",n=t.extend(e.i18n,s.i18n),i=n[r.toLowerCase()]||n[r.substr(0,2)]||n.en;s=t.extend(e,i,s);const l=a.find(inputSelector);(c=l.val())&&d(s),l.on("keyup.search",e=>{c=t(e.target).val().trim(),d(s)})}}}(window.jQuery);

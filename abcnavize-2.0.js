// encoding: utf-8
// $.fn.abcnavize 2.0  -- (c) 2010 Hugsmiðjan ehf.
(function(b){var q=b.fn.abcnavize=function(a){a=b.extend({menuTmpl:'<div class="abcnav"><span>%{title}</span> <b /></div>',menuListElm:'b',menuItmTmpl:'<a href="%{frag}">%{label}</a>',menuItmSel:'a',currentClass:'current',items:'>li',noneFound:'<li class="nothingfound"><strong>%{msg}</strong></li>',fragmPrefix:'index:',allBtn:!0,zebraize:!0},(!a||a.preset!='table')?{}:{listElm:'> tbody',items:'> tr',noneFound:'<tr class="nothingfound"><td colspan="%{colspan}"><strong>%{msg}</strong></td></tr>',},a);return this.each(function(){var e=b(this),h=!a.listElm?e:typeof a.listElm!='string'?b(a.listElm):e.find(a.listElm),i=h.find(a.items).detach(),m={},n=n||q.texts[e.closest('[lang]').attr('lang')]||q.texts.en,j,u=function(f){var g=b(f.target).closest('a'),c=g.closest(a.menuItmSel);if(g[0]&&!c.is('.'+o)){var d=b.Event('abcnavfilter');d.menuItem=c;e.trigger(d);if(!d.isDefaultPrevented()){var o=a.currentClass;k.find(a.menuItmSel+'.'+o).removeClass(o);c.addClass(o);var l=b.getFrag(g.attr('href'));f.type=='click'&&b.setFrag(l);if(l==a.fragmPrefix+'all'){l=''}h.find(a.items).detach();var p=l?b(m[l]):i;if(p.length){p.appendTo(h);j&&j.detach();if(a.zebraize){p.removeClass('even').filter(':odd').addClass('even')}}else{if(!j){j=b(typeof a.noFound!='string'?a.noneFound:a.noneFound.replace('%{msg}',n.noFoundMsg).replace('%{colspan}',i.eq(0).children().length))}j.appendTo(h)}var r=b.Event('abcnavfiltered');r.menuItem=c;r.visibleRows=p;e.trigger(r)}}return false},k=b(a.menuTmpl.replace('%{title}',n.abcTitle)).bind('click',u),s=typeof a.menuListElm=='string'?k.find(a.menuListElm):b(a.menuListElm);if(a.allBtn){s.append(b(a.menuItmTmpl.replace('%{frag}','#'+(a.startHidden?a.fragmPrefix+'all':'')).replace('%{label}',n.abcAll)))}i.each(function(){var f=b(this),g=b.trim(f.text()).charAt(0).toUpperCase(),c=a.fragmPrefix+g;f.data('abcnav-fragm',c);var d=m[c];if(!d){s.append(' ',b(a.menuItmTmpl.replace('%{frag}','#'+b.encodeFrag(c)).replace('%{label}',g)));d=m[c]=[]}d.push(f[0])});var t=b.getFrag()||(a.startOn&&a.fragmPrefix+a.startOn),v=(!!m[t]||t==a.fragmPrefix+'all')?'[href$="#'+b.encodeFrag(t)+'"]':'';if(v){u.call(null,{target:k.find('a'+v)[0]})}else if(!a.startHidden){i.appendTo(h)}e.before(k).data('abcnav',{menu:k,items:i,cfg:a});s=undefined})};q.texts={en:{abcTitle:'Initial:',abcAll:'Show all',noFoundMsg:'No items match this criteria.'},is:{abcTitle:'Upphafsstafur:',abcAll:'Sýna alla',noFoundMsg:'Engar línur uppfylla þessi leitarskilyrði.'}}})(jQuery);

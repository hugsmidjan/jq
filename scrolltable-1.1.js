// $.fn.scrollTable 1.1  -- (c) 2010-2013 HugsmiÃ°jan ehf.
(function(b,r){var j='scrollTable',s=function(d){var h=d.table;if(h.is(':visible')){var o=h.find('>tbody>tr:first>*').css('width',''),i=h.find('>thead,>tfoot').show(),l=[],t=[];if(d._0){d._1=d.tbWrap?Math.max(0,d.tbWrap.width()-parseInt(h.css('width'),10)):0}h.css('width','').css('table-layout','');o.each(function(a){var c=b(this);t[a]=c.outerWidth();l[a]=c.width()});o.each(function(a){b(this).width(l[a])});var u=parseInt(h.css('width'),10);h.css('width',u).css('table-layout','fixed');i.css('display','');d.clones.css('table-layout','');d.clones.find('>*>tr').each(function(){var k=0,g=b(this).children(),m=g.length-1;if(d._0&&d._1){g.last().css('padding-right',function(a,c){return parseInt(c,10)+d._1})}g.each(function(a){var c=b(this),f=(parseInt(c.attr('colspan'),10)||1),e=0;padWidth=c.outerWidth()-c.width();while(f--){e+=t[k++]}c.width(e-padWidth+(a===m?d._1:0))})});d.clones.css('width',u+d._1).css('table-layout','fixed');d._0=r}},v=function(i){var l=i.table;i.clones&&i.clones.remove();i.clones=l.children('thead, tfoot').map(function(){var g=b(this),m=this.tagName.toLowerCase(),d=g.clone().data(j+'-org',g),h=b(l[0].cloneNode(false));i._2&&d.bind(i._2,i,w);h.css('table-layout','fixed').attr('summary','Skip this table - it\'s for layout purposes only').append(g.is('thead')?g.prevAll('caption').clone():r).append(d).addClass(m+' '+(i._3))['insert'+(m==='thead'?'Before':'After')](i.tbWrap||l);var o=h.find('*').add(h);o.filter('[id]').each(function(){var f=this.id,e=f+(Math.random()+'').substr(2),k=b(this).attr('id',e);b.each({'input, select, textarea':'label[for','area':'img[usemap'},function(a,c){if(k.is(a)){h.find(c+'="'+f+'"]').attr(c.split('[')[1],e)}})});if(i._4){b.each(i._2.split(/\s+/),function(a,c){o.removeAttr('on'+c)})}return h[0]})},w=function(a){var c=this,f=a.data,e=b(c).data(j+'-org'),k=[],g=a.target;while(g!==c){k.unshift(g.tagName.toLowerCase()+':nth-child('+(b(g).index()+1)+')');g=g.parentNode}var m='>'+k.join('>'),d=b.Event(a.type);b.each(f._5,function(){d[this]=a[this]});e.find(m).trigger(d);a.stopPropagation();d.isDefaultPrevented()&&a.preventDefault()},n=[],p,x=function(){if(p){clearTimeout(p);p=setTimeout(q,75)}else{q()}},q=function(){var a=n.length;while(a--){var c=n[a],f=c.data(j);if(!f){n=n.splice(a,1)}s(f)}if(!n.length){b(window).unbind('resize.scrolltable')}};b.fn[j]=function(e,k){if(e==='refresh'){this.each(function(a){if(a=b(this).data(j)&&k&&k.reclone){v(a);a._0=1}});q()}else{e=b.extend({},b.fn[j].defaults,e);this.filter(function(){return!b(this).data(j)}).each(function(){var a=b(this),c=e.tbWrap?b(a.wrap(e.tbWrap).parent()):null,f={table:a,tbWrap:c,_3:e.cloneClass,_2:e.proxyEvents,_5:e.proxyEvProps.split(/\s*,\s*/),_4:e.hasEvAttrs,_0:1};if(e.wrap){f.wrap=b(e.wrap).data(j,f);(c||a).wrap(f.wrap)}v(f);a.css('margin',0).data(j,f);s(f);n.push(a);b(window).bind('resize.scrolltable',x)})}return this};b.fn[j].defaults={proxyEvents:'click focusin focusout mouseup mousedown',proxyEvProps:'pageX pageY which',wrap:'<div class="scrollable" />',tbWrap:'<div class="tbody"/>',cloneClass:'screen-only'}})(jQuery);

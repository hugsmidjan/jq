// $.fn.quickFeedback 1.0  -- (c) 2014 Hugsmiðjan ehf.
!function(e){e.quickFeedback={i18n:{en:{qfeedbackThanks:"That was nice. Thanks!",qfeedbackClose:"Hide"},is:{qfeedbackThanks:"Gott að vita. Takk!",qfeedbackClose:"Fela"}}},e.fn.quickFeedback=function(n){return n=e.extend({gaPing:!0,yayBtnSel:"a.yay",nayBtnSel:"a.nay",ajaxParams:{justPicPos:"pgmain"},feedbackformSel:".quickfeedback"},n),this.each(function(){var a=e(this),t=e.quickFeedback.i18n[a.lang()]||e.quickFeedback.i18n.is;a.on("click",n.yayBtnSel,function(n){n.preventDefault(),a.pause(200,function(){a.html('<strong class="thanks">'+t.qfeedbackThanks+"</strong>").focusHere()}).pause(4e3).fadeOut(1e3,function(){a.remove()}),gaPing&&e.gaEvtPing("quickfeedback","clicked-yes")}).on("click",n.nayBtnSel,function(i){i.preventDefault();var c,o=this;e.get(o.href,n.ajaxParams).done(function(i){var o=e(i),f=o.find(n.feedbackformSel).append(o.filter("script[data-spm]"));e('<a class="action cancel" role="button" href="#">'+t.qfeedbackClose+"</a>").on("click",function(e){e.preventDefault(),f.pause(200).fadeOut(500,function(){f.remove()})}).insertAfter(f.find(".fi_btn"));var d;f.on("submit",function(){d=!!f.find("input:checked")[0]||!!f.find("textarea").val()}).hide().insertAfter(a).fadeIn(500,function(){f.focusHere()}),a.detach(),e(document).trigger("domupdated",[f]),f.find(".boxbody").on("VBload",function(e,n){n.resultDOM.find("h1, h2").detach(),n.resultDOM=n.resultDOM.find(".boxbody").contents()}).on("VBloaded",function(){d&&(gaPing&&e.gaEvtPing("quickfeedback","clicked-no","form-submitted"),c=!0),f.pause(4e3).fadeOut(1e3,function(){f.remove()})}).virtualBrowser()}),e(window).on("unload beforeunload",function(){!c&&gaPing&&e.gaEvtPing("quickfeedback","clicked-no","button-only"),c=!0})})})}}(jQuery);

// encoding: utf-8
// datepicker 1.0 -- (c) 2011 Hugsmiðjan ehf. 
!window.datePicker&&(function($){var r=$.browser.msie&&parseInt($.browser.version,10)<8,n=function(a){return a&&(a.charAt(0).toUpperCase()+a.substr(1))},o=function(a){a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a};datePicker={VERSION:1.0,defaultCssFile:null,cssTriggers:['fi_date','fi_dmy'],openOnFieldClick:true,wDLength:1,is:{months:'janúar,febrúar,mars,apríl,maí,júní,júlí,ágúst,september,október,nóvember,desember'.split(','),wdays:'sunnudagur,mánudagur,þriðjudagur,miðvikudagur,fimmtudagur,föstudagur,laugardagur'.split(','),popBtn:'Veldu dag',popBtnLong:'Veldu dagsetningu',close:'Fela',closeLong:'Fela dagatalið',prevM:'Fyrri',prevMLong:'Fyrri mánuður',nextM:'Næsti',nextMLong:'Næsti mánuður',prevY:'Fyrra ár',prevYLong:'Fyrra ár',nextY:'Næsta ár',nextYLong:'Næsta ár'},en:{months:'January,February,March,April,May,June,July,August,September,October,November,December'.split(','),wdays:'Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday'.split(','),popBtn:'Pick date',popBtnLong:'Pick date',close:'Close',closeLong:'Close Calendar',prevM:'Prev',prevMLong:'Previous month',nextM:'Next',nextMLong:'Next month',prevY:'Prev year',prevYLong:'Previous year',nextY:'Next year',nextYLong:'Next year'},defaults:{dateActiveSrc:new Date(),dateMinSrc:null,dateMaxSrc:null,dateFormat:'%d.%m.%yyyy',flipYears:false,caseSensitive:false,lang:'en'},idDefaults:{},fields:{},_2:false,init:function(a){if(!this._2&&this.defaultCssFile!==""){this.defaultCssFile=this.defaultCssFile||'https://secure.eplica.is/codecentre/jquery/datepicker/0.9/dp.css';$('head').append('<link href="'+this.defaultCssFile+'" media="screen" rel="stylesheet" type="text/css" />')}this._5=o(new Date());a=a||$('body');var b=$(a).find("input");var c=new RegExp(" "+this.cssTriggers.join(" | ")+" ");for(var h=0,e;e=b[h];h++){if(e.id&&this.fields[e.id]&&(this.fields[e.id]._0==e)){continue}if(!e.type||(e.type=="text")){var d=$.aquireId(e),g="",f=e;while(!/^(form|body)$/.test(f.tagName.toLowerCase())){g+=" "+f.className;f=f.parentNode}if(c.test(g+" ")){this.fields[d]=new s(d);this.fields[d].init()}}}this._2=true},getMY:function(a,b){return n(this[b].months[a.getMonth()])+" "+a.getFullYear()},_3:function(a){if(a.indexOf('%')==-1){a=a.replace(/(d+)/i,'%$1').replace(/(m+)/i,'%$1').replace(/(y+)/i,'%$1')}return a.toLowerCase()},printDateValue:function(a,b,c){if(!a){return""}var h=this[c||this.defaults.lang]||this.en;b=this._3(b||this.defaults.dateFormat);var e=a.getFullYear()+"";var d=(a.getMonth()+1)+"";var g=a.getDate()+"";var f=(b.match(/\%d+/))?b.match(/\%(d+)/)[1].length:0;if((f>=2)&&(g<10)){g="0"+g}f=(b.match(/\%m+/))?b.match(/\%(m+)/)[1].length:0;if((f==2)&&(d<10)){d="0"+d}else if(f>2){d=h.months[a.getMonth()]}if(f==3){d=d.substr(0,3)}f=(b.match(/\%y+/))?b.match(/\%(y+)/)[1].length:0;if(f==2){e=e.substr(2,2)}return b.replace(/\%y+/,e).replace(/\%m+/,d).replace(/\%d+/,g)},parseDate:function(a){var b=this.fields[a]._0.value;if(!b){return null}var c=this._3(this.fields[a].dateFormat),h=1,e=0,d=null,g,f,i,j;if(c.indexOf("%m")>-1){i=c.substr(0,c.indexOf("%m")).replace(/\%(d|m|y)/g,"$1").length;f=c.match(/\%(m+)/)[1].length;if(f>2){var m=this[this.fields[a].lang].months;g=b.substr(i).toLowerCase();for(var k=0;k<m.length;k++){var l=m[k].toLowerCase();if(f==3){l=l.substr(0,3)}if(g.indexOf(l)>-1){e=k;b=b.substr(0,i+1)+b.substr(i+l.length+1);break}}}else{g=b.substr(i,3).replace(/^\D/,"").substr(0,2);e=parseInt(g,10);if(isNaN(e)||(e<1)){e=1}e=e-1;j=new RegExp("(.{"+i+"})\\d\\d?(.*)$");b=b.replace(j,"$1$2")}c=c.replace(/\%m+/,"")}if(c.indexOf("%d")>-1){i=c.substr(0,c.indexOf("%d")).replace(/\%(d|m|y)/g,"$1").length;g=b.substr(i,3).replace(/^\D/,"").substr(0,2);h=parseInt(g,10);if(isNaN(h)||(h<1)){h=1}j=new RegExp("(.{"+i+"})\\d\\d?(.*)$");b=b.replace(j,"$1$2");c=c.replace(/\%d+/,"")}if(c.indexOf("%y")>-1){i=c.substr(0,c.indexOf("%y")).replace(/\%(d|m|y)/g,"$1").length;f=c.match(/y+/)[0].length;g=b.substr(i,f+2).replace(/^.?\D/,"").substr(0,f);d=parseInt(g,10);if(isNaN(d)||(d<=0)){return null}if(f!=4){d+=(d<70)?2000:1900}j=new RegExp("(.{"+i+"})\\d{"+f+"}(.*)$");b=b.replace(j,"$1$2");c=c.replace(/\%y+/,"")}return new Date(d,e,h)},buildCalendar:function(b){var c=this.fields[b],h=c.dateActive,e=c.lang,d=this[e];var g=$('<div id="'+b+'-cal" class="pickdate'+(c.flipYears?' pickdate-yearnav':'')+'">'+(r?'<iframe class="layerfix" frameborder="0"></iframe>':'')+'<div class="pickdatewrap"><h4>'+this.getMY(h,e)+'</h4></div></div>');g[0].fieldId=b;g.bind('click',function(a){a.preventDefault();a.stopPropagation()});var f=$(g).find('div');var i=$('<ul class="month"><li class="prev"><a href="#" title="'+(d.prevMLong||d.prevM)+'">'+d.prevM+'</a></li><li class="next"><a href="#" title="'+(d.nextMLong||d.nextM)+'">'+d.nextM+'</a></li></ul>');var j=i.find("a");$(j[0]).bind('click',function(a){datePicker.flipCal(b,-1,"m");a.preventDefault()});$(j[1]).bind('click',function(a){datePicker.flipCal(b,1,"m");a.preventDefault()});f.append(i);if(c.flipYears){var m=$('<ul class="year"><li class="prev"><a href="#" title="'+(d.prevYLong||d.prevY)+'">'+d.prevY+'</a></li><li class="next"><a href="#" title="'+(d.nextYLong||d.nextY)+'">'+d.nextY+'</a></li></ul>');j=m.find("a");$(j[0]).bind('click',function(a){datePicker.flipCal(b,-1,"y")});$(j[1]).bind('click',function(a){datePicker.flipCal(b,1,"y")});f.append(m)}var k='<table cellspacing="0" summary=""><thead><tr>';for(var l=0;l<7;l++){var p=n(d.wdays[l]);k+='<th><acronym title="'+p+'">'+p.substr(0,this.wDLength)+'</acronym></th>'}k+='</tr></thead><tbody><tr><td colspan="7"></td></tr></tbody></table>';f.append(k);var q=$('<a href="#" class="close" title="'+(d.closeLong||d.close)+'">'+d.close+'</a>');f.append(q);q.bind('click',function(a){datePicker.closeCalendar(b);a.preventDefault()});return g},buildCalendarDays:function(b){var c=this.fields[b];var h=c.dateActive;var e=h.getMonth();var d=c._4;var g=new Date(h.getFullYear(),e,1);var f=$("<tbody />");var i=function(a){return datePicker.doPickDate(b,a.newDay)};while(g.getMonth()==e){var j=$("<tr />");f.append(j);for(var m=1;m<8;m++){var k=$("<td />");if(g.getMonth()==e&&!(g.getDate()==1&&m<=g.getDay())){if(g.getTime()==this._5.getTime()){k.addClass('today')}if(d&&g.getTime()==d.getTime()){k.addClass('active')}var l;if(this.isValidChoice(g,b)){l=$("<a />");l[0].href="#";l[0].fieldId=b;l[0].newDay=g.getDate();l.bind('click',function(a){i(this);a.preventDefault()})}else{l=$("<i />")}l.append(g.getDate()+'');k.append(l);g.setDate(g.getDate()+1)}else{k.addClass('o');k.append(String.fromCharCode(160))}if(m==1){k.addClass('su')}else if(m==7){k.addClass('sa')}j.append(k)}}return f},isValidChoice:function(a,b){var c=this.fields[b];var h=c.dateMin;var e=c.dateMax;var d=!h||a.getTime()>=h.getTime();var g=!e||a.getTime()<=e.getTime();return(d&&g)},openCalendar:function(a){var b=this.fields[a];b.dateMin=b.getDateBoundry("min");b.dateMax=b.getDateBoundry("max");this.updateCalendar(a);if(b.isOpen){return false}b.isOpen=true;$(b._0.parentNode).append(b._1);$('body').bind('click',this.delayedCloseAll)},closeCalendar:function(a){var b=this.fields[a];if(!b.isOpen){return false}b.isOpen=false;$(b._1).remove();$('body').unbind('click',this.delayedCloseAll);return false},toggleCalendar:function(a){this[(this.fields[a].isOpen?'close':'open')+'Calendar'](a)},flipCal:function(a,b,c){var h=this.fields[a];var e=h.dateMin;var d=h.dateMax;var g=h.dateActive;var f=new Date(g);f.setDate(1);if(c=="y"){f.setFullYear(f.getFullYear()+b)}else{f.setMonth(f.getMonth()+b)}if(b<0){f.setMonth(f.getMonth()+1);f.setDate(0)}var i=false,j=f.getTime();if((!e||j>=e.getTime())&&(!d||j<=d.getTime())){i=true}else if(e&&j<e.getTime()&&b>0){f=e;i=true}else if(d&&j>d.getTime()&&b<0){f=d;i=true}if(i){h.dateActive=new Date(f);this.updateCalendar(a);h._6.focus();return true}return false},updateCalendar:function(a){var b=this.fields[a];var c=b._1;$(c).find("h4").text(this.getMY(b.dateActive,b.lang));$(c).find("tbody").replaceWith(this.buildCalendarDays(a))},doPickDate:function(a,b){var c=$('#'+a)[0];var h=this.fields[a];var e=h.dateActive;e.setDate(b);var d=h._4;d.setTime(e.getTime());c.value=this.printDateValue(d,h.dateFormat,h.lang);this.closeCalendar(a);this.updateCalendar(a);c.focus();return false},closeAll:function(){for(var a in this.fields){if(!this.fields[a].isHovered){this.closeCalendar(a)}}return false},delayedCloseAll:function(a){setTimeout(datePicker.closeAll,10)}};var s=function(f){var i=datePicker;this._0=$('#'+f)[0];if(i.openOnFieldClick){$(this._0).bind('mouseup',function(a){if(!i.fields[this.id].isOpen){setTimeout("datePicker.openCalendar('"+this.id+"')",20);a.stopPropagation()}});$(this._0).bind('blur',function(a){var b="if (!datePicker.fields['"+this.id+"'].isHovered) { datePicker.closeCalendar('"+this.id+"'); }";setTimeout(b,20)})}this.getDateBoundry=function(a){var b=a=='min'?this.dateMinSrc:a=='max'?this.dateMaxSrc:this.dateActiveSrc;if(!b){return null}var c={},h,e,d,g;if(!b.join){h=b}else{h=b[0];if(b[1]&&(typeof(b[1])=="string")&&b[1].match(/^[-+]?\d+[dmy]$/)){d=parseInt(b[1],10);g=b[1].match(/[dmy]$/)[0]}}if(typeof(h)=="string"){if(!i.fields[h]){return null}e=i.parseDate(h)}else{e=h}if(!e){return null}c.y=e.getFullYear();c.m=e.getMonth();c.d=e.getDate();c[g]+=d||0;return new Date(c.y,c.m,c.d)};this.isOpen=false;$.extend(this,i.defaults,i.idDefaults[f]||{});var j=$(this._0).lang();if(i[j]){this.lang=j}this.dateActive=this.getDateBoundry("active");this.init=function(){var b=i.parseDate(f)||this.dateActive||o(new Date());this._4=b;this.dateActive=new Date(b);this.dateMin=this.getDateBoundry("min");this.dateMax=this.getDateBoundry("max");var c=$('<a href="#" class="pickdatelink">'+i[this.lang].popBtn+'</a>');c[0].title=(i[this.lang].popBtnLong)||i[this.lang].popBtn;c[0].fieldId=f;c.bind('click',function(a){i.toggleCalendar(this.fieldId);a.stopPropagation();return false});$(this._0).parent().append(c);this._6=c;this._1=i.buildCalendar(f);this.isHovered=false;c.bind('focus',function(a){datePicker.fields[this.fieldId].isHovered=true});c.bind('mouseout',function(a){datePicker.fields[this.fieldId].isHovered=false});$(this._1).bind('mouseover',function(a){datePicker.fields[this.fieldId].isHovered=true});$(this._1).bind('mouseout',function(a){datePicker.fields[this.fieldId].isHovered=false})}}})(jQuery);

/* $.fn.editedSeach 1.0  -- (c) 2016-2017 Hugsmiðjan ehf. @preserve */
!function(u){u.fn.editedSearch=function(e){var a={ajaxSearchUrl:"/search",useGaPing:!1,searchForText:"is"===u.lang()?"Leita að ":"Search for ",ajaxParams:{justPicPos:"pgmain"},editedSearchSelector:".curatedsearch",includeNormalSearch:!1,normalSearchSelector:".searchresults",maxResults:100,minSearchLength:1,searchDelay:200,autoFocus:!1},t=u.extend(a,e);return"editedSearchSelextor"in e&&(console.warn("Please rename option `editedSearchSelextor` to `editedSearchSelector`"),t.editedSearchSelector=e.editedSearchSelextor),u.fn.editedSeach=function(){console.warn("Please rename `editedSeach()` to `editedSearch()`"),u.fn.editedSearch.apply(this,[].call.slice(arguments))},this.each(function(){var e,s,r,a,c,h;e=u(this),s=t,a=e.find("input:text"),c=window.gaHXM&&window.gaHXM.eventPing?window.gaHXM.eventPing:function(){},h=u.debounceFn(function(e){c("sitessearch-box","ac-result",e)},800),a.autocomplete({minLength:s.minSearchLength,delay:s.searchDelay,autoFocus:s.autoFocus,appendTo:e,source:function(l,o){for(var e=this.element,a=u(e[0].form).serializeArray(),t=0;t<a.length;t++)a[t].value=a[t].value.trim().replace(/\s+/g," ");a=u.param(a),h.cancel(),r&&r.abort(),r=u.ajax({url:s.ajaxSearchUrl,data:a+"&"+u.param(s.ajaxParams)}).done(function(e){var a=u(u.imgSuppress(e)),t=[],r=[];a.find(s.editedSearchSelector+" a").each(function(e,a){t.push({label:a.innerHTML,url:a.href,pos:e+1})}),s.includeNormalSearch&&(t.forEach(function(e){e.className="curated-result"}),a.find(s.normalSearchSelector+" .item > h3 > a").each(function(e,a){r.push({className:"regular-result",label:a.innerHTML,url:a.href,pos:"regular "+(e+1)})}));var c=t.length+r.length;if((!s.includeNormalSearch||s.maxResults<c)&&(r=r.slice(Math.max(0,s.maxResults-t.length))).push({label:s.searchForText+' <strong>"'+l.term+'"</strong>',className:"search",isSearchAction:!0}),s.useGaPing){var n=" | curated:"+t.length,i=s.includeNormalSearch?" | regular:"+r.length:"";h(l.term+n+i)}o(t.concat(r))})},position:{},html:!0}).on("autocompletefocus",function(e){e.preventDefault()}).on("autocompleteselect",function(e,a){if(e.preventDefault(),a.item.isSearchAction){var t=u(this).autocomplete("widget").children().length;s.useGaPing&&c("sitessearch-box","ac-click-search",this.value+" | curated:"+t),u(this).closest("form").submit()}else s.useGaPing&&c("sitessearch-box","ac-click",this.value+" | listPos:"+a.item.pos+" | "+a.item.url),location.href=a.item.url})})}}(window.jQuery);

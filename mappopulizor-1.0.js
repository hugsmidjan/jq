// encoding: utf-8
(function(b){b.fn.mapPopulizor=function(a){a=b.extend({listCont:'<ul class="itemlist" />',activeClass:'maplist-active',mappoints:{},getXY:function(h,c){var e=h.find('h3 > a, span.more a').eq(0),i=e.length&&e.attr('href').replace(/^.*\/(\d+)(\/|$)/,'$1');return c.mappoints[i]||{x:0,y:0}},itemselector:'div.item',markerActiveClass:'marker-active',liActiveClass:'marker-active',x_flip:1000,markerFlipClass:'marker-flip',bubbleFlipClass:'bubble-flip',dotOffset:[0,0]},a);this.addClass(a.activeClass).each(function(){var j=b(this),l=b('<div class="map" />').appendTo(j),d=a.listCont;d=(typeof d=='string'&&d.indexOf('<')==-1)?b(d,j):b(d);if(!d.closest('html').length){d.appendTo(this)}b(a.itemselector,j).hide().each(function(){var c=b(this);var e=b.trim(c.find('h3').eq(0).text());var i=c.find('h3 > a, span.more a')[0];var k=b('<li><a href="'+i.href+'">'+e+'</a></li>').appendTo(d);var f=b('<a href="#" class="marker"><span /><i><b>'+e+'</b></i></a>');var m=b('<a href="#" title="Loka" class="close">x</a>');var g=a.getXY(c,a);if(g){c.find('h3').html('<span>'+e+'</span>');b([f[0],c.find('h3 span')[0],k.find('a')[0],m[0]]).bind('click',function(){if(c.is(':visible')){c.stop().fadeOut(function(){b(this).css('opacity','');k.removeClass(a.liActiveClass)});f.removeClass(a.markerActiveClass)}else{c.stop().fadeIn(function(){b(this).css('opacity','');f.addClass(a.markerActiveClass)});k.addClass(a.liActiveClass)}return false});f.css({left:g.x+a.dotOffset[0],top:g.y+a.dotOffset[1]}).bind('mouseenter mouseleave',function(h){b('i',this).stop()[h.type=='mouseenter'?'fadeIn':'fadeOut'](function(){b(this).css('opacity','')})});if(g.x>=a.x_flip){c.addClass(a.bubbleFlipClass);f.addClass(a.markerFlipClass)}c.css({left:g.x+a.dotOffset[0],top:g.y+a.dotOffset[1]}).hide().append(m);l.append(c);l.prepend(f)}})});return this}})(jQuery);

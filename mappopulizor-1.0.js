// $.fn.mapPopulizor 1.0  -- (c) 2009 Hugsmi√∞jan ehf.
(function(b){var i=function(c,d){if(d){var e=(typeof c=='string'&&c.indexOf('<')==-1)?b(c,d):b(c);if(!e.closest('html').length){e.appendTo(d)}return e}return b(c)};b.mapPopulizor={defaults:{mapElm:'<div class="map" />',listCont:'<ul class="itemlist" />',closeBtn:'<a href="#" title="Loka" class="closebtn">x</a>',activeClass:'maplist-active',mappoints:{},getXY:function(c){var d=this.getLinkUrl(c),e=d&&d.replace(/^.*\/(\d+)(\/|$)/,'$1');return this.mappoints[e]||{x:0,y:0,f:1}},markerTempl:'<a href="#" class="marker"><span /><i><b>%{label}</b></i></a>',buildMarker:function(c){return b(b.inject(this.markerTempl,{label:this.getLabel(c)}))},itemTempl:'<li><a href="%{url}">%{label}</a></li>',buildItem:function(c){var d={url:this.getLinkUrl(c)||'#',label:this.getLabel(c)};return b(b.inject(this.itemTempl,d))},labelSelector:'h3',getLabel:function(c){return b.trim(b(c).find(this.labelSelector).text())},linkSelector:'h3 > a, span.more a',getLinkUrl:function(c){return b(c).find(this.linkSelector).attr('href')},itemselector:'div.item',markerActiveClass:'marker-active',liActiveClass:'marker-active',x_flip:1000,markerFlipClass:'marker-flip',bubbleFlipClass:'bubble-flip',dotOffset:[0,0],fadeSpeed:[400,400]}};b.fn.mapPopulizor=function(a){a=b.extend({},b.mapPopulizor.defaults,a);this.addClass(a.activeClass).each(function(){var h=b(this),j=i(a.mapElm,h),l=i(a.listCont,h);b(a.itemselector,h).hide().each(function(){var d=b(this),e=a.buildItem(d).appendTo(l),f=a.buildMarker(d),k=i(a.closeBtn),g=a.getXY(d);if(g){b([f[0],d.find('h3')[0],e.find('a')[0],k[0]]).bind('click',function(c){if(d.is(':visible')){d.stop().fadeOut(a.fadeSpeed[1],function(){b(this).css('opacity','');e.removeClass(a.liActiveClass)});f.removeClass(a.markerActiveClass)}else{h.find('a.marker-active').trigger('click').trigger('mouseleave').blur();d.stop().fadeIn(a.fadeSpeed[0],function(){b(this).css('opacity','');f.addClass(a.markerActiveClass)});e.addClass(a.liActiveClass)}return false});if(g.f){f.addClass('marker-false')}f.css({left:g.x+a.dotOffset[0],top:g.y+a.dotOffset[1]}).find('i').hide().end().bind('mouseenter mouseleave',function(c){b('i',this).stop()[c.type=='mouseenter'?'fadeIn':'fadeOut'](c.type=='mouseenter'?a.fadeSpeed[0]:a.fadeSpeed[1],function(){if(8>parseInt((/(msie) ([\w.]+)/.exec(navigator.userAgent)||[])[1],10)){c.type=='mouseenter'?b('body').addClass('hovering'):b('body').removeClass('hovering')}b(this).css('opacity','')})});if(g.x>=a.x_flip){d.addClass(a.bubbleFlipClass);f.addClass(a.markerFlipClass)}d.css({left:g.x+a.dotOffset[0],top:g.y+a.dotOffset[1]}).hide().append(k);j.append(d);j.prepend(f)}})});return this}})(jQuery);

// encoding: utf-8
// jQuery.fn.fieldsetCloner v 1.0 - (c) 2011 Hugsmiðjan ehf
(function(c){c.fieldsetCloner={defaults:{buttonPlacement:'after',addBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',addBtnClass:'addrow',cloneClass:'clone',rowNameSel:'h2,h3,legend',showSpeed:'fast'},i18n:{'en':{addBtnLabel:'Add ',addBtnTitle:'Add new ',rowName:'row'},'is':{addBtnLabel:'Bæta við ',addBtnTitle:'Bæta við auka ',rowName:'röð'}},placeMethods:{before:'insertBefore',after:'insertAfter',top:'prependTo',bottom:'appendTo'},cloneFieldset:function(j,b,g){var k=c.browser.msie&&parseInt(c.browser.version,10)<8,l=k&&j.find('*'),m,f=j.clone(true),o=f.find('*'),a=0,e,d,h,i;f.find('.'+g.addBtnClass).remove();if(d=f[0].id){h=b==1?d+'-'+g.cloneClass+'-'+b:d.replace(/\d+$/,b);f.attr('id',h)}if(b==1){var n=f[0].className.split(/\s+/g);for(var a=0;a<n.length;a++){n[a]=n[a]+'-'+g.cloneClass}f.addClass(g.cloneClass+' '+n.join(' '))}while(e=o[a++]){if(d=e.id){h=b==1?d+'-'+g.cloneClass+'-'+b:d.replace(/\d+$/,b);c(e).attr('id',h)}if(d=c(e).attr('for')){h=b==1?d+'-'+g.cloneClass+'-'+b:d.replace(/\d+$/,b);c(e).attr('for',h)}if(d=e.name){i=d.match(/^(.+)(\d+)(\D*)$/);e.name=d=(i)?i[1]+(parseInt(i[2],10)+1)+i[3]:d+'-2'}if(l&&/^INPUT|SELECT|TEXTAREA|BUTTON$/.test(e.tagName)){m=c(e.outerHTML.replace(/( name=)[^ >]+/,'$1"'+d+'"'));c(e).replaceWith(m)}}return f}};c.fn.fieldsetCloner=function(m){var f=c.fieldsetCloner,o=f.i18n[c.lang()]||f.i18n.en,a=c.extend({},f.defaults,o,m),e=f.placeMethods[a.buttonPlacement];return this.each(function(){var b=c(this),g=b,k=0,l=(b.attr(a.rowNameSel)||b.find(a.rowNameSel).filter(':first').text()||a._1).replace(/:/g,'');_0=c(c.inject(a.addBtnTemplate,{className:a.addBtnClass,label:a.addBtnLabel+l,tooltip:a.addBtnTitle+l}));_0.bind('click',function(j){k++;b=c.fieldsetCloner.cloneFieldset(g,k,a);if(a.buttonPlacement=='bottom'||a.buttonPlacement=='top'){g.find('.'+a.addBtnClass)[e](b)}b.hide().insertAfter(g).slideDown(a.showSpeed);g=b;j.preventDefault()})[e](b)})}})(jQuery);

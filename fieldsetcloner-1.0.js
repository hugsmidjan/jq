// jQuery.fn.fieldsetCloner v 1.0 - (c) 2011 Hugsmiðjan ehf
(function(f){var q=8>parseInt((/(msie) ([\w.]+)/.exec(navigator.userAgent)||[])[1],10),o={before:'insertBefore',after:'insertAfter',top:'prependTo',bottom:'appendTo'},r=function(j,d,b){var c=j.clone(!!b.cloneEvents),a,h;if(b.addDelBtn){if(b.fsets.length==1){var k=f(f.inject(b.delBtnTemplate,{className:b.delBtnClass,label:b.delBtnLabel,tooltip:b.delBtnTitle+b.rowName})),s=b.delBtnAppendTo?c.find(b.delBtnAppendTo):c;k.appendTo(s)}var p='.'+b.delBtnClass;c.undelegate(p,'click.fsDelRow').delegate(p,'click.fsDelRow',function(e){var g=c.find('.'+b.addBtnClass).detach();c.slideUp(b.showSpeed,function(){c.remove()});var i=jQuery.inArray(c,b.fsets);b.fsets.splice(i,1);g[o[b.buttonPlacement]](b.fsets[0]);return false})}c.find('.'+b.addBtnClass).remove();if(a=c[0].id){h=d==1?a+'-'+b.cloneClass+'-'+d:a.replace(/\d+$/,d);c.attr('id',h)}if(d==1){var l=c[0].className.split(/\s+/g);for(var m=0;m<l.length;m++){l[m]=l[m]+'-'+b.cloneClass}c.addClass(b.cloneClass+' '+l.join(' '))}c.find('*').each(function(){var e=this;if(a=e.id){h=(d==1)?a+'-'+b.cloneClass+'-'+d:a.replace(/\d+$/,d);e.id=h}if(a=f(e).attr('for')){h=(d==1)?a+'-'+b.cloneClass+'-'+d:a.replace(/\d+$/,d);f(e).attr('for',h)}if(a=e.name){var g=a.match(/^(.+)(\d+)(\D*)$/);h=(g)?g[1]+(parseInt(g[2],10)+1)+g[3]:a+'-2';e.name=h}if(q&&/^(?:INPUT|SELECT|TEXTAREA|BUTTON)$/.test(e.tagName)){var i=f(e.outerHTML.replace(/( name=)[^ >]+/,'$1"'+a+'"'));f(e).replaceWith(i)}});return c},n=f.fieldsetCloner={defaults:{buttonPlacement:'after',addBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',addBtnClass:'addrow',cloneClass:'clone',showSpeed:'fast',delBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',delBtnClass:'delrow',afterClone:function(e){}},i18n:{'en':{addBtnLabel:'Add ',addBtnTitle:'Add new ',delBtnLabel:'Delete',delBtnTitle:'Delete this ',rowName:'row'},'is':{addBtnLabel:'Bæta við ',addBtnTitle:'Bæta við auka ',delBtnLabel:'Eyða',delBtnTitle:'Eyða þessari ',rowName:'röð'}}};f.fn.fieldsetCloner=function(a){var h=n.i18n[this.lang()]||n.i18n.en,a=f.extend({},n.defaults,h,a),k=o[a.buttonPlacement];return this.each(function(){var i=f(this),j=0,d=a.rowName=(i.attr(a.rowNameSel||'')||i.find(a.rowNameSel).eq(0).text()||a.rowName).replace(/:/g,''),b=f(f.inject(a.addBtnTemplate,{className:a.addBtnClass,label:a.addBtnLabel+d,tooltip:a.addBtnTitle+d})),c=a.fsets=[i];b.bind('click',function(e){j++;var g=r(c[0],j,a);if(/^(?:bottom|top)$/.test(a.buttonPlacement)){c[0].find('.'+a.addBtnClass)[k](g)}g.hide().insertAfter(c[0]).slideDown(a.showSpeed);c.unshift(g);a.afterClone(g);e.preventDefault()})[k](i)})}})(jQuery);

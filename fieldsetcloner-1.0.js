// encoding: utf-8
// jQuery.fn.fieldsetCloner v 1.0 - (c) 2011 Hugsmiðjan ehf
(function(d){var q=d.browser.msie&&parseInt(d.browser.version,10)<8,o={before:'insertBefore',after:'insertAfter',top:'prependTo',bottom:'appendTo'},r=function(j,e,b){var c=j.clone(!!b.cloneEvents),a,h;if(b.addDelBtn){if(b.fsets.length==1){var k=d(d.inject(b.delBtnTemplate,{className:b.delBtnClass,label:b.delBtnLabel,tooltip:b.delBtnTitle+b.rowName})),s=b.delBtnAppendTo?c.find(b.delBtnAppendTo):c;k.appendTo(s)}var p='.'+b.delBtnClass;c.undelegate(p,'click.fsDelRow').delegate(p,'click.fsDelRow',function(f){var g=c.find('.'+b.addBtnClass).detach();c.slideUp(b.showSpeed,function(){c.remove()});var i=jQuery.inArray(c,b.fsets);b.fsets.splice(i,1);g[o[b.buttonPlacement]](b.fsets[0]);return false})}c.find('.'+b.addBtnClass).remove();if(a=c[0].id){h=e==1?a+'-'+b.cloneClass+'-'+e:a.replace(/\d+$/,e);c.attr('id',h)}if(e==1){var l=c[0].className.split(/\s+/g);for(var m=0;m<l.length;m++){l[m]=l[m]+'-'+b.cloneClass}c.addClass(b.cloneClass+' '+l.join(' '))}c.find('*').each(function(){var f=this;if(a=f.id){h=(e==1)?a+'-'+b.cloneClass+'-'+e:a.replace(/\d+$/,e);f.id=h}if(a=d(f).attr('for')){h=(e==1)?a+'-'+b.cloneClass+'-'+e:a.replace(/\d+$/,e);d(f).attr('for',h)}if(a=f.name){var g=a.match(/^(.+)(\d+)(\D*)$/);h=(g)?g[1]+(parseInt(g[2],10)+1)+g[3]:a+'-2';f.name=h}if(q&&/^(?:INPUT|SELECT|TEXTAREA|BUTTON)$/.test(f.tagName)){var i=d(f.outerHTML.replace(/( name=)[^ >]+/,'$1"'+a+'"'));d(f).replaceWith(i)}});return c},n=d.fieldsetCloner={defaults:{buttonPlacement:'after',addBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',addBtnClass:'addrow',cloneClass:'clone',rowNameSel:'h2,h3,legend',showSpeed:'fast',delBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',delBtnClass:'delrow',afterClone:function(f){}},i18n:{'en':{addBtnLabel:'Add ',addBtnTitle:'Add new ',delBtnLabel:'Delete',delBtnTitle:'Delete this ',rowName:'row'},'is':{addBtnLabel:'Bæta við ',addBtnTitle:'Bæta við auka ',delBtnLabel:'Eyða',delBtnTitle:'Eyða þessari ',rowName:'röð'}}};d.fn.fieldsetCloner=function(a){var h=n.i18n[this.lang()]||n.i18n.en,a=d.extend({},n.defaults,h,a),k=o[a.buttonPlacement];return this.each(function(){var i=d(this),j=0,e=a.rowName=(i.attr(a.rowNameSel)||i.find(a.rowNameSel).eq(0).text()||a._0).replace(/:/g,''),b=d(d.inject(a.addBtnTemplate,{className:a.addBtnClass,label:a.addBtnLabel+e,tooltip:a.addBtnTitle+e})),c=a.fsets=[i];b.bind('click',function(f){j++;var g=r(c[0],j,a);if(/^(?:bottom|top)$/.test(a.buttonPlacement)){c[0].find('.'+a.addBtnClass)[k](g)}g.hide().insertAfter(c[0]).slideDown(a.showSpeed);c.unshift(g);a.afterClone(g);f.preventDefault()})[k](i)})}})(jQuery);

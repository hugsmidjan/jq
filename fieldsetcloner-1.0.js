// jQuery.fn.fieldsetCloner v 1.0 - (c) 2011 Hugsmiðjan ehf
!function(e){var t=8>parseInt((/MSIE ([\w.]+)/.exec(navigator.userAgent)||[])[1],10),a={before:"insertBefore",after:"insertAfter",top:"prependTo",bottom:"appendTo"},l=function(l,n,s){var d=n===1,o=l.clone(!!s.cloneEvents),r,i,f="-"+(s.cloneClass||"clone")+"-",c=new RegExp("("+f+"\\d+)?$");f+=n;if(s.addDelBtn){if(s.fsets.length===1){var p=e(e.inject(s.delBtnTemplate,{className:s.delBtnClass,label:s.delBtnLabel,tooltip:s.delBtnTitle+s.rowName})),B=s.delBtnAppendTo?o.find(s.delBtnAppendTo):o;p.appendTo(B)}var m="."+s.delBtnClass;o.undelegate(m,"click.fsDelRow").delegate(m,"click.fsDelRow",function(e){e.preventDefault();var t=o.find("."+s.addBtnClass).detach();o.slideUp(s.showSpeed,function(){o.remove()});var l=jQuery.inArray(o,s.fsets);s.fsets.splice(l,1);t[a[s.buttonPlacement]](s.fsets[0])})}o.find("."+s.addBtnClass).remove();if(r=o[0].id){o[0].id=r.replace(c,f)}if(d){var u=o[0].className.split(/\s+/g);for(var v=0;v<u.length;v++){u[v]=u[v]+"-"+s.cloneClass}o.addClass(s.cloneClass+" "+u.join(" "))}o.find("*").each(function(){var a=this;if(r=a.id){a.id=r.replace(c,f)}if(r=e(a).attr("for")){e(a).attr("for",r.replace(c,f))}if(r=a.name){var l=r.match(/^(.*)(\d+)(\D*)$/);a.name=l?l[1]+(parseInt(l[2],10)+1)+l[3]:r+"-2"}if(t&&/^(?:INPUT|SELECT|TEXTAREA|BUTTON)$/.test(a.tagName)){var n=e(a.outerHTML.replace(/( name=)[^ >]+/,'$1"'+r+'"'));e(a).replaceWith(n)}});return o},n=e.fieldsetCloner={defaults:{buttonPlacement:"after",addBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',addBtnClass:"addrow",cloneClass:"clone",showSpeed:"fast",delBtnTemplate:'<a class="%{className}" href="#" title="%{tooltip}">%{label}</a>',delBtnClass:"delrow"},i18n:{en:{addBtnLabel:"Add ",addBtnTitle:"Add new ",delBtnLabel:"Delete",delBtnTitle:"Delete this ",rowName:"row"},is:{addBtnLabel:"Bæta við ",addBtnTitle:"Bæta við auka ",delBtnLabel:"Eyða",delBtnTitle:"Eyða þessari ",rowName:"röð"}}};e.fn.fieldsetCloner=function(t){var s=n.i18n[this.lang()]||n.i18n.en,d=e.extend({},n.defaults,s,t),o=a[d.buttonPlacement];return this.each(function(){var t=e(this),a=0,n=d.rowName=(t.attr(d.rowNameSel||"")||t.find(d.rowNameSel).eq(0).text()||d.rowName).replace(/:/g,""),s=e(e.inject(d.addBtnTemplate,{className:d.addBtnClass,label:d.addBtnLabel+n,tooltip:d.addBtnTitle+n})),r=d.fsets=[t];s.bind("click",function(e){a++;var t=l(r[0],a,d);d.beforeClone&&d.beforeClone(t);if(/^(?:bottom|top)$/.test(d.buttonPlacement)){r[0].find("."+d.addBtnClass)[o](t)}t.hide().insertAfter(r[0]).slideDown(d.showSpeed);r.unshift(t);d.afterClone&&d.afterClone(t);e.preventDefault()})[o](t)})}}(jQuery);

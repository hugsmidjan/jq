// encoding: utf-8
// $.fn.fickle 2.0  -- (c) 2009-2012 Hugsmi√∞jan ehf. 
(function(c,p){var j=function(b,a,e){var d=c.Event(m+a);d.cfg=e;b.trigger(d);return!d.isDefaultPrevented()},k=document,m='fickle',q,n,r=function(b){clearTimeout(q)},s={open:function(a,e){var d=a.c;d.opener=(e&&e.opener)||d.opener;if(!a._0&&j(this,'open',d)){var h=c('#'+i);if(!h[0]){h=c('<i id="'+i+'" tabindex="0" style="position:fixed;_4:absolute;left:-9999px;overflow:hidden;margin-top:-1px;width:1px;height:1px;"> </i>')}c('body').append(h);var g=d.focusElm;focusTarget=g?(g.charAt?this.find(g):g):[];a._1=p;d.fickle&&c(k).on('focusin click',a._2);d.closeOnEsc&&c(k).on('keydown',a._3);a._0=!0;d.fadein&&this.fadeIn(d.fadein);this.queue(function(){var b=c(this);b.unhide();j(b,'opened',d);a._1||c(focusTarget[0]||this).focusHere();b.dequeue()})}},close:function(a){var e=a.c;if(a._0&&j(this,'close',e)){c(k).off('focusin click',a._2).off('keydown',a._3);c.focusHere(e.opener||k.body);a._0=!1;e.fadeout&&this.fadeOut(e.fadeout);this.queue(function(){var b=c(this);b.hide();j(b,'closed',e);b.dequeue()})}},toggle:function(b,a){var e=typeof a=='boolean'?a:a&&a.doOpen!==p?a.doOpen:!b._0;s[e?'open':'close'].call(this,b,a)},isOpen:function(b){return!!(b||b._0)},isFickle:function(b){return!!b},config:function(b){return b.c}},t={fickle:!0,closeOnEsc:!0,closeDelay:300},i=m+'-'+c.aquireId();c.fn.fickle=function(f,u){var l=this;if(typeof f=='string'){var o=s[f];if(o){return(/^(?:config|is(?:Open|Fickle))$/.test(f))?o(l.data(i)):l.each(function(b,a){a=c(a);var e=a.data(i);e&&o.call(a,e,u)})}}else{f=c.beget(t,f);l.each(function(){var d=c(this);if(!d.data(i)){c.each(['Open','Opened','Close','Closed'],function(b,a){f['on'+a]&&d.on(m+a.toLowerCase(),f['on'+a])});var h={c:c.beget(f),_3:function(b){return(b.which!=27)||d.fickle('close')&&false},_2:function(b){var a=d[0];n=b.target!=a&&!c.contains(a,b.target)}},g;!f.startOpen&&d.hide();d.data(i,h).on('focusin focusout',function(b){h._1=b.type=='focusin'});if(f.fickle){d.on('focusout',function(b){var a=this;r();n=false;q=setTimeout(function(){f.trapFocus?c.focusHere(g):n&&c(a).fickle('close')},f.trapFocus?0:f.closeDelay)}).on('click mousedown focusin',function(a){setTimeout(r,0);if(a.type=='click'){var e=c(this);e.one('mouseleave',function(b){c.focusHere(g)})}else if(a.type=='focusin'){g=a.target}})}if(f.startOpen){d.fickle('open')}}})}return l}})(jQuery);
